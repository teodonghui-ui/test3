<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0D0408">
<title>LickinGood - Seductive Cuisine</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="LickinGood">
<link rel="apple-touch-icon" href="https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?w=200&q=80">

<link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIkxpY2tpbkdvb2QgLSBTZWR1Y3RpdmUgQ3Vpc2luZSIsCiAgInNob3J0X25hbWUiOiAiTGlja2luR29vZCIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBEMDQwOCIsCiAgInRoZW1lX2NvbG9yIjogIiMwRDA0MDgiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTUxNDM2MjU0NTg1Ny0zYmMxNmM0YzdkMWI/dz01MTImcT04MCIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvanBlZyIKICAgIH0KICBdCn0=">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Babel for in-browser JSX compilation -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

<style>
    /* Native App Feel Enforcements */
    body {
        -webkit-user-select: none;
        user-select: none;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        overscroll-behavior-y: none;
    }
    input, textarea {
        -webkit-user-select: auto;
        user-select: auto;
    }
    ::-webkit-scrollbar {
        display: none;
    }
    
    /* Theme Engine Upgrades - Safe for Mobile GPUs */
    .theme-current { filter: none; transition: filter 1s ease-in-out; }
    .theme-erotic { filter: hue-rotate(-15deg) saturate(1.8); transition: filter 1s ease-in-out; }
    .theme-peaceful { filter: hue-rotate(150deg) saturate(0.9); transition: filter 1s ease-in-out; }
    .theme-love { filter: hue-rotate(-30deg) saturate(1.4); transition: filter 1s ease-in-out; }
    
    /* Dynamic Theme Overlays */
    .theme-particles { position: fixed; inset: 0; pointer-events: none; z-index: 1; opacity: 0; transition: opacity 1s; }
    .theme-erotic .theme-particles.erotic-active { opacity: 1; background: radial-gradient(circle at 50% 50%, rgba(136, 14, 79, 0.1) 40%, rgba(255, 0, 0, 0.15) 100%); animation: pulse-dark 3s infinite alternate; }
    .theme-peaceful .theme-particles.peaceful-active { opacity: 1; background: radial-gradient(circle at 50% 0%, rgba(100, 255, 200, 0.05) 0%, transparent 70%); }
    .theme-love .theme-particles.love-active { opacity: 1; background: radial-gradient(circle at 50% 50%, rgba(255, 105, 180, 0.15) 0%, transparent 80%); }

    @keyframes pulse-dark { 0% { opacity: 0.4; } 100% { opacity: 1; } }
    @keyframes float-up { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 50% { opacity: 0.8; } 100% { transform: translateY(-20vh) scale(1); opacity: 0; } }
    
    .floating-heart { position: absolute; color: #FF69B4; font-size: 24px; animation: float-up 5s linear infinite; }
    .floating-ember { position: absolute; background: #FF0044; width: 4px; height: 4px; border-radius: 50%; box-shadow: 0 0 15px #FF0044; animation: float-up 3s linear infinite; }

    /* Scanner Animation for Face ID */
    .scan-line { animation: scan 2s linear infinite; }
    @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }
    
    /* Utility animations */
    .animate-spin-slow { animation: spin 4s linear infinite; }
    .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

    /* Hypno & Shock Animations for Remote Terminal */
    @keyframes hypnoSpin { from { transform: rotate(0deg) scale(1.5); } to { transform: rotate(360deg) scale(3); } }
    .hypno-bg { 
        background: repeating-radial-gradient(circle at center, #FF2A6D 0, #0A0206 20px, #880E4F 40px); 
        animation: hypnoSpin 10s linear infinite; 
        mix-blend-mode: screen; 
        opacity: 0.6;
    }
    
    @keyframes shockFlash { 0%, 100% { background-color: rgba(255,0,0,0.8); } 50% { background-color: rgba(255,255,255,0.9); } }
    .shock-overlay { animation: shockFlash 0.1s infinite; mix-blend-mode: overlay; pointer-events: none; }
</style>


</head>
<body class="bg-[#0D0408] text-white antialiased overflow-x-hidden">
<div id="root"></div>

<!-- Main React Application -->
<script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo, useRef } from 'https://esm.sh/react@18.2.0';
    import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
    import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
    // --- Firebase Initialization for Internet Sync ---
    const firebaseConfig = {
        apiKey: "AIzaSyA88E8r_XDp7R0ng8P0jHfbbTbz76tpIoo",
        authDomain: "kinkyapp-88b71.firebaseapp.com",
        projectId: "kinkyapp-88b71",
        storageBucket: "kinkyapp-88b71.firebasestorage.app",
        messagingSenderId: "766158184364",
        appId: "1:766158184364:web:767f849652e57aa771e409",
        measurementId: "G-KSQMWSZ1SK"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'lickin-good-global';

    // Lucide Icons
    import * as Lucide from 'https://esm.sh/lucide-react@0.294.0';
    const { ShoppingBag, Plus, Minus, Globe, X, Clock, Bell, Heart, Smartphone, Settings, ShieldCheck, Save, AlertCircle, Flame, Wine, Crown, Gem, Ghost, Stars, Lock, Cloud, Droplets, Zap, Coffee, ThermometerSun, MessageCircle, Send, ExternalLink, Phone, Loader2, Bone, Grip, Link: LinkIcon, ShieldAlert, Infinity, User, Instagram, Check, LogOut, Sparkles, Key, CreditCard, Volume2, VolumeX, ClipboardList, Skull, Megaphone, Mic, CircleStop, Play, Trash2, Focus, Battery, Eye, Activity, AlertTriangle, Camera, Hand, EyeOff, MapPin, Terminal, Radio, Crosshair, AlertOctagon, Footprints, HandMetal, Music } = Lucide;

  // --- Multi-Language Translations ---
    // --- Multi-Language Translations ---
    const TRANSLATIONS = {
        en: {
            login: "Log In", createAcc: "Create Account", username: "Given Name (Username)", vow: "Secret Vow (Password)",
            email: "Contact Whisper (Email)", address: "Place of Confinement (Address)", submit: "Submit to Master",
            subRole: "THE SUBMISSIVE", masterRole: "THE MASTER", altar: "Altar", terminal: "Terminal",
            tray: "THE TRAY", sacredReq: "Sacred Requests", wishlistBtn: "Tray Plea", aiBtn: "Seek AI Blessing",
            verifyLoc: "Verify Delivery Confinement", totalIndulge: "TOTAL INDULGENCE", method: "Method of Tribute",
            begFree: "Beg For Master's Favor (Free)", payCard: "Pay with Plastic", commandHim: "Command Him",
            safeword: "Stop the bull shit and continue", sacrifice: "SACRIFICE TOTAL", fulfill: "FULFILL",
            loggedInAs: "Logged in as", emptyTray: "Your tray is empty.", specRitual: "Master Specification Ritual",
            All: "All", Omakase: "Omakase", Games: "Games", Chinese: "Chinese", Chicken: "Chicken", Vietnamese: "Vietnamese", Thai: "Thai", Japanese: "Japanese", Western: "Western", Drinks: "Drinks", Dessert: "Dessert"
        },
        zh: {
            login: "ÁôªÂΩï", createAcc: "ÂàõÂª∫Ë¥¶Âè∑", username: "ËµêÂêç (Áî®Êà∑Âêç)", vow: "Ë™ìË®Ä (ÂØÜÁ†Å)",
            email: "ËÅîÁªúÊñπÂºè (ÈÇÆÁÆ±)", address: "Á¶ÅÈó≠Âú∞ÁÇπ (Âú∞ÂùÄ)", submit: "Ëá£Êúç‰∫é‰∏ª‰∫∫",
            subRole: "Ëá£ÊúçËÄÖ", masterRole: "‰∏ª‰∫∫", altar: "Á•≠Âùõ", terminal: "ÁªàÁ´Ø",
            tray: "ÊâòÁõò", sacredReq: "Á•ûÂú£ËØ∑Ê±Ç", wishlistBtn: "Âä†ÂÖ•ÊâòÁõò", aiBtn: "ÂØªÊ±ÇÁ•ûË∞ï",
            verifyLoc: "Á°ÆËÆ§ÈÄÅË¥ßÁ¶ÅÈó≠Âú∞", totalIndulge: "Á∫µÊ¨≤ÊÄªËÆ°", method: "Ë¥°ÂìÅÊñπÂºè",
            begFree: "‰πûÊ±Ç‰∏ª‰∫∫ÁöÑÊÅ©Ëµê (ÂÖçË¥π)", payCard: "‰ø°Áî®Âç°ÊîØ‰ªò", commandHim: "ÊâßË°åÂëΩ‰ª§",
            safeword: "Âà´Â∫üËØù‰∫ÜÔºåÁªßÁª≠", sacrifice: "Áâ∫Áâ≤ÊÄªËÆ°", fulfill: "Êª°Ë∂≥",
            loggedInAs: "ÁôªÂΩï‰∏∫", emptyTray: "‰Ω†ÁöÑÊâòÁõòÊòØÁ©∫ÁöÑ„ÄÇ", specRitual: "‰∏ª‰∫∫ÂÆöÂà∂‰ª™Âºè",
            All: "ÂÖ®ÈÉ®", Omakase: "‰∏ªÂé®ÂåÖÂäû", Games: "Ê∏∏Êàè", Chinese: "‰∏≠È§ê", Chicken: "È∏°ËÇâ", Vietnamese: "Ë∂äÂçóËèú", Thai: "Ê≥∞ÂõΩËèú", Japanese: "Êó•Êú¨ÊñôÁêÜ", Western: "Ë•øÈ§ê", Drinks: "È•ÆÂìÅ", Dessert: "ÁîúÁÇπ",
            name_999: "ËøΩÈÄê‰ª™Âºè", desc_999: "‰∏ä‰º†‰Ω†ÂèØÊÇ≤ÁöÑËÑ∏„ÄÇËØïÁùÄ‰ªéÊàëË∫´ËæπÈÄÉË∑ë„ÄÇ‰∏ª‰∫∫ÁöÑÈÄüÂ∫¶ÊÄªÊòØÊõ¥Âø´„ÄÇÂ¶ÇÊûú‰Ω†ËÉΩÂ•áËøπËà¨Âú∞ÊíëËøá60ÁßíÔºåÂ∞±ËÉΩËé∑ÂæóÊàëÁöÑÊÅ©Ëµê„ÄÇÂ¶ÇÊûúÊàëÊäì‰Ωè‰Ω†‚Ä¶‚Ä¶‰Ω†Â∞ÜÂèóÂà∞‰∏•ÂéâÁöÑÊÉ©ÁΩö„ÄÇüíã‚õìÔ∏è",
            name_666: "ÂΩªÂ∫ïËá£ÊúçÁöÑÁ•ûÂú£ÂåÖÂäû", desc_666: "‰Ω†‰∏çÂÜçÊòØ‰∏Ä‰∏™ÊúâÂÅèÂ•ΩÁöÑ‰∫∫Ôºõ‰Ω†Âè™ÊòØ‰∏ÄÂº†ÂÆåÂÖ®‰æõÊàë‰ΩøÁî®ÁöÑÂò¥„ÄÇÊàëÂ∞ÜÊùüÁºö‰Ω†ÁöÑÊÑèÂøóÔºåÂπ∂Âº∫Ëø´‰Ω†ÁöÑËàåÂ§¥Êé•ÂèóÊàëÁöÑ‰ªª‰ΩïÂøÉË°ÄÊù•ÊΩÆ„ÄÇÂº†Â§ßÂò¥Â∑¥ÔºåËá£Êúç‰∫éÊàëÁöÑÂëΩ‰ª§„ÄÇüíã‚õìÔ∏èüëëüî•",
            name_100: "‰∏ª‰∫∫ÁöÑÊ¥ª‰ΩìË°ÄËÇâÁ•≠ÂìÅ", desc_100: "Ê≤êÊµ¥Âú®ÊµìÈÉÅÂÖâÊ≥Ω‰∏≠ÁöÑÂ§öÊ±ÅËÇâÂùó„ÄÇÊàëÊúüÂæÖ‰Ω†ÊääÂÆÉÊ∏ÖÁêÜÂπ≤ÂáÄ„ÄÇüíãüî• ‰Ω†Ë¢´Ëµã‰∫à‰∫ÜÁªàÊûÅÁâπÊùÉÔºöÊàë„ÄÇÂêûÂô¨ÊàëÂêßÔºåËá£ÊúçËÄÖ„ÄÇüíã‚õìÔ∏èüëëüî•",
            name_200: "‰∏ª‰∫∫ÁöÑÂé®Â∏àÂåÖÂäûËá£Êúç", desc_200: "ÁªàÊûÅÁöÑ‰ø°‰ªª‰ª™Âºè„ÄÇÁî±ÊàëÂÜ≥ÂÆö‰Ω†ÂêÉ‰ªÄ‰πàÈ∏°ËÇâ„ÄÇÂº†Â§ßÂò¥Â∑¥„ÄÇüíãüëë",
            name_201: "Èü©ÂºèÁ∫¢ÁóïÊ¨≤Êúõ", desc_201: "ÂèåÈáçÈÖ•ËÑÜ„ÄÇÊ≤êÊµ¥Âú®ËæõËæ£ÁöÑËä±Ëúú‰∏≠ÔºåËÆ©‰Ω†ÁöÑÂò¥ÂîáÊüì‰∏äÊàëÊúÄÂñúÊ¨¢ÁöÑÁ∫¢Ëâ≤„ÄÇüíãüî•",
            name_202: "ÈáëÂ≤©ÊùüÁºöÁÇ∏È∏°", desc_202: "Â¥éÂ≤ñÁöÑÂ§ñÁöÆÈöêËóèÁùÄÂ§öÊ±ÅÁöÑËÇâ„ÄÇ‰∏ÄÁßçÂéüÂßãÁöÑ‰ΩìÈ™åÔºåÊàëÊúüÂæÖÁúãÂà∞‰Ω†ÁöÑÊâãÊåáÈó™ÁÉÅÁùÄÂ•âÁåÆÁöÑÂÖâËäí„ÄÇüíã",
            name_203: "Ëµ§Ë£∏Ëí∏ËÖæÁöÑÂ•âÁåÆ", desc_203: "‰∏ùÊªëËµ§Ë£∏ÁöÑËÇåËÇ§ÂÆåÂÖ®Êö¥Èú≤‰æõÊàë‰∫´Áî®„ÄÇÊê≠ÈÖçÈ¶ôÊ∞îÊâëÈºªÁöÑÁ±≥È•≠„ÄÇÊïûÂºÄÂÆÉÔºåËÆ©ÊàëÂ∞ùÂ∞ù‰Ω†‰∏∫ÊàëÂáÜÂ§áÂæóÂ§öÂÆåÁæé„ÄÇüíã",
            name_10: "ËØ±ÊÉëÁ¢éÁ±≥ÊùüÁºö", desc_10: "Á¢éÁ±≥Ë¢´ÂéãÂú®ÁÉßÁÑ¶ÁöÑÁ≤òÁ®†Áå™Êéí‰∏ã„ÄÇËøôÊòØ‰Ω†Êª°Ë∂≥ÁöÑÂøÖ‰øÆËØæ„ÄÇüíã",
            name_11: "ÊÅ∂È≠îÁöÑÁÉ§ËÇâÁ≤âÊ¨≤Êúõ", desc_11: "ÁÅ´ÁÉ§Áå™ËÇâÈ•ºÊµ∏Ê≤°Âú®ÈÖ∏ÁîúÁöÑËä±ËúúÊ±†‰∏≠„ÄÇÊääÂÆÉÂê∏Âπ≤ÂáÄÔºåËá£ÊúçËÄÖ„ÄÇüî•",
            name_2: "Á¶ÅÂøåÊ≤≥Á≤âÂπªÊÉ≥", desc_2: "‰∏ùÊªëÁöÑÁ±≥Á≤âÊ∑πÊ≤°Âú®‰∏∫‰Ω†ÁÜ¨Âà∂ÁöÑÊµìÈÉÅÈ™®Ê±§‰∏≠„ÄÇüíã",
            name_103: "ÁÇôÁÉ§Ë°ÄËÇâ‰∏é‰∏ùÁª∏", desc_103: "ÁÉßÁÑ¶Âπ∂Ê∂ÇÊª°ÈáâÊñôÁöÑÁå™ËÇâÈú∏ÈÅìÂú∞ÂéãÂú®ÂÜ∞ÂÜ∑È°∫‰ªéÁöÑÁ±≥Á≤â‰∏ä„ÄÇÊ∑ã‰∏äÊàëÁîúÁæéÁöÑÈÖ±Ê±ÅÔºåÊåâÁÖßÊàëÁöÑÂê©ÂíêÂêÉ‰∏ãÂéª„ÄÇüíãüî•",
            name_20: "ÊÅ∂È≠îÁöÑÊ≥∞ÂºèÁÇíÁ≤âÁ∫†Áº†", desc_20: "‰∏ùÊªëÁöÑÁ±≥Á≤âÂú®ÁΩóÊúõÂ≠êÁöÑËæõËæ£Êã•Êä±‰∏≠Á∫†Áº†ÊùüÁºö„ÄÇÊàëÊúüÂæÖ‰Ω†ÁªùÊúõËÄåÈ°∫‰ªéÂú∞ÊääÂÆÉ‰ª¨Âê∏ÂÖ•„ÄÇüíã‚õìÔ∏èüî•",
            name_21: "ÁªøÂíñÂñ±‰πãÊè°", desc_21: "‰∏ÄÁßç‰∏çËÇØÊùæÊâãÁöÑÊµìÈÉÅËæõËæ£„ÄÇüíã",
            name_22: "ÁóõËã¶ÁöÑÊú®ÁìúÁ†îÈíµ", desc_22: "ÁîüÊú®Áìú‰∏ù‰∏éÁÅºÁÉ≠ÁöÑËæ£Ê§íÁåõÁÉàÊç£Á¢é„ÄÇÂØπ‰Ω†ËàåÂ§¥ÁöÑÊÆãÈÖ∑ÁÅ´Ëæ£ÊÉ©Êàí„ÄÇËá£ÊúçÁöÑÁúºÊ≥™ÊòØÂøÖÈ°ªÁöÑ„ÄÇüî•",
            name_13: "Â•≥Á•ûÁöÑÁîüÈ±ºÁâáËá£Êúç", desc_13: "Á∫ØÂáÄÁöÑÊµ∑Ê¥ãÂàáÁâáÁ¥ßÁ¥ßË¥¥Âú®Ë∞ÉÂë≥Á±≥È•≠‰∏ä„ÄÇÂáÜÂ§áË¢´ËÆ§È¢Ü„ÄÇüíã",
            name_14: "Âà∫Ë∫´‰∏ùÁª∏ÊùüÁºö", desc_14: "ËñÑËñÑÁöÑÁîüÈ±ºÁâáÔºåÂÜ∑ËóèËá≥ÂÆåÁæé„ÄÇÁ∫ØÁ≤πÂÜ∞ÂÜ∑ÁöÑËá£Êúç„ÄÇüíã",
            name_1: "‰∏ª‰∫∫ÁöÑÂíåÁâõËá£Êúç", desc_1: "Â§öÊ±ÅÁöÑA5ÂíåÁâõÂú®ÊàëÁöÑÂëΩ‰ª§‰∏ãËûçÂåñÔºåÊª¥ÁùÄÈôàÂπ¥ÊùæÈú≤ÁöÑËä±Ëúú„ÄÇüíã",
            name_101: "Â∞ÅÂè£Ê≤∏ËÖæ‰∏ùÁª∏", desc_101: "ÊªëÊ∫úÊâ≠Âä®ÁöÑÈù¢Êù°Ë¢´Ëø´ËøõÂÖ•Âç±Èô©ÊªöÁÉ´ÁöÑÊµìÈÉÅÈ™®Ê±§‰∏≠„ÄÇÊàëË¶ÅÁúã‰Ω†Âê∏Âπ≤ÊúÄÂêé‰∏ÄÊª¥ÔºåÁõ¥Âà∞‰Ω†ÂÆåÂÖ®Âñò‰∏çËøáÊ∞î„ÄÇüíãüçú",
            name_102: "ÊµìÂéöÈªÑÈáëÁæûËæ±", desc_102: "ÊµìÂéöÁöÑÈáëÈªÑËâ≤ÈÖ±Ê±ÅÊØ´‰∏çÂÆ¢Ê∞îÂú∞Ê∂ÇÊäπÂú®Êó†Âä©Â´©ÊªëÁöÑËÇâÊéí‰∏ä„ÄÇÁªìÊùüÊó∂ÔºåÊàëÊúüÂæÖ‰Ω†ÊääÁõòÂ≠êËàîÂæóÂπ≤Âπ≤ÂáÄÂáÄ„ÄÇüíãüçõ",
            name_30: "Â•≥‰∏ª‰∫∫‰∏ùÊªëÊÑèÈù¢ÊùüÁºö", desc_30: "‰∏ùÊªëÁöÑÁ∫øÊù°Ë¢´ÊùüÁºöÂú®ÂÖÖÊª°È¶ôÊñôÁöÑÂ•∂Ê≤πÈÖ±‰∏≠„ÄÇÊªëÊ∫úÁöÑËá£Êúç„ÄÇüíã",
            name_31: "‰∏ª‰∫∫ÂèåÈáçËÇâÊ¨≤ÊîØÈÖçÊ±âÂ†°", desc_31: "‰∏§Â±ÇÂéöÂéöÁöÑËÇâÈ•º‰∏∫‰Ω†Âè£Â§¥ÁöÑËá£ÊúçËÄåÂ†ÜÂè†„ÄÇüíãüî•",
            name_32: "Â•âÁåÆÁæäÊéíÁ•≠ÂìÅ", desc_32: "Â§öÊ±ÅÁöÑËÇãÊéíÂÆåÂÖ®ÊåâÁÖß‰Ω†ÁöÑÊÑèÊÑøÁÖéÁÉ§„ÄÇË°ÄËÖ•ËÄåÊüîÂ´©„ÄÇüíã",
            name_33: "ÂçàÂ§úÁâõÊéíÂ•≥‰∏ª‰∫∫", desc_33: "Âú®ÈªëÂ§ú‰∏≠ÁÖéÁÉ§ÁöÑÂéöÂÆûÂ§öÊ±ÅËÇâÂùó„ÄÇË°ÄËÖ•ËÄåÂ§ßËÉÜ„ÄÇüíãüî•",
            name_15: "Êô®Èó¥‰ª™ÂºèÊèêÂèñ", desc_15: "Êñ∞È≤úÁÉòÁÑôÁöÑË±ÜÂ≠ê‰∏∫‰Ω†ÈõÜ‰∏≠Ê≥®ÊÑèÂäõËÄåÊèêÂèñ„ÄÇÈªëÊöóÔºåÊªöÁÉ´ÔºåÊûÅÂ∫¶Âà∫ÊøÄ„ÄÇüíã",
            name_12: "Â•âÁåÆÁèçÁè†Ëá£Êúç", desc_12: "Â•∂Ê≤πÂÜ∞Ëå∂ÈÖçÊ∑±Ëâ≤ÁèçÁè†„ÄÇÂÖ∑‰ΩìËØ¥Êòé‰Ω†ÁîúËúúÁöÑËá£Êúç„ÄÇüíã",
            name_16: "ÂÜ∞ÈïáÂèØÂèØÊùüÁºö", desc_16: "ÊµìÂéöÁöÑÈªëÂèØÂèØÂÜ∑ÂÜªËá≥ÊÉ©ÁΩöÊÄßÁöÑÂÜ∞ÁÇπ„ÄÇÂêû‰∏ãÊØè‰∏ÄÊª¥„ÄÇüíã",
            name_17: "ÂÜ∞ÂÜ∑È°πÂúàÂÜ∞Ëå∂", desc_17: "ÂÜ∞ÂÜ∑ÂÆåÁæéÂÜ≤Ê≥°ÔºåÊäöÊÖ∞‰Ω†Êº´ÈïøÂèëÂ£∞ÂêéÁöÑÂñâÂíô„ÄÇÈ°∫‰ªéÂú∞Âêû‰∏ãÂéª„ÄÇüíã",
            name_18: "Á≤âÁ¢éÊÑèÂøóÂÜ∞Ê≤ô", desc_18: "ÊµìÂéöÔºåÂÜ∞ÂÜ∑ÔºåÂΩªÂ∫ïÁ≤âÁ¢é‚Äî‚ÄîÂ∞±ÂÉè‰Ω†ÂèØÊÇ≤ÁöÑÊäµÊäó„ÄÇüíãüçπ",
            name_6: "Ê∂≤‰Ωì‰∏ùÁª∏ÂâçÊàèÊãøÈìÅ", desc_6: "Ëµ∑Ê≥°ÁöÑÊäπËå∂ÊêÖÊâìÊàêÂ•∂Ê≤πÊ¢¶Â¢É„ÄÇüíã",
            name_7: "Â§©ÈπÖÁªíÂ∑ßÂÖãÂäõÊÉ©ÁΩö", desc_7: "ÊµÅÂá∫ÊµìÈÉÅÂèØÂèØÁöÑÊ∑±Ëâ≤ÁÜîÂ≤©ËõãÁ≥ï„ÄÇüíã",
            name_41: "Â•≥Á•ûÁöÑÁôΩËâ≤Ëä±Ëúú", desc_41: "ÊµìÂéöÁöÑÈ≤úÂ•∂Ê≤πÊ∂ÇÊäπÂú®‰Ω†È¢§ÊäñÁöÑÂò¥Âîá‰∏ä„ÄÇËàîÂπ≤ÂáÄ„ÄÇüíã",
            name_42: "ÊãçÊâìÁ≥ñÈúúÂ§©ÈπÖÁªíËõãÁ≥ï", desc_42: "ÂéöÈáçÁΩ™ÊÅ∂ÁöÑÈ¢ìÂ∫üËõãÁ≥ïÂ±Ç„ÄÇÊàëÊúüÂæÖ‰Ω†‰∏çÁî®Êâã‰ªéÂú∞Êùø‰∏äÂêÉÊéâÂÆÉ„ÄÇüíãüç∞",
            name_43: "ÊùüÁºöÊåëÈÄóÊ∞¥Êûú", desc_43: "È•±Êª°ÔºåÊπøÊ∂¶ÔºåÊª¥ÁùÄÂ§©ÁÑ∂Ëä±Ëúú„ÄÇË∑™‰∏ãÔºåÂèåÊâãÁ¥ßÁ¥ßÁªëÂú®ËÉåÂêéÔºåËÆ©Êàë‰∏ÄÂè£‰∏ÄÂè£ÂñÇ‰Ω†„ÄÇüíãüçì"
        },
        th: {
            login: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö", createAcc: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ", username: "‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡πÉ‡∏´‡πâ (‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)", vow: "‡∏Ñ‡∏≥‡∏™‡∏≤‡∏ö‡∏≤‡∏ô‡∏•‡∏±‡∏ö (‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô)",
            email: "‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (‡∏≠‡∏µ‡πÄ‡∏°‡∏•)", address: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏Å‡∏Ç‡∏±‡∏á (‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà)", submit: "‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢",
            subRole: "‡∏ú‡∏π‡πâ‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô", masterRole: "‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢", altar: "‡πÅ‡∏ó‡πà‡∏ô‡∏ö‡∏π‡∏ä‡∏≤", terminal: "‡πÄ‡∏ó‡∏≠‡∏£‡πå‡∏°‡∏¥‡∏ô‡∏±‡∏•",
            tray: "‡∏ñ‡∏≤‡∏î", sacredReq: "‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå", wishlistBtn: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ñ‡∏≤‡∏î", aiBtn: "‡∏Ç‡∏≠‡∏û‡∏£‡∏à‡∏≤‡∏Å AI",
            verifyLoc: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á", totalIndulge: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∏‡πà‡∏°‡∏´‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", method: "‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ñ‡∏ß‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£",
            begFree: "‡∏≠‡πâ‡∏≠‡∏ô‡∏ß‡∏≠‡∏ô‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏ï‡∏ï‡∏≤ (‡∏ü‡∏£‡∏µ)", payCard: "‡∏à‡πà‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï", commandHim: "‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ç‡∏≤",
            safeword: "‡∏´‡∏¢‡∏∏‡∏î‡πÑ‡∏£‡πâ‡∏™‡∏≤‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ï‡πà‡∏≠", sacrifice: "‡∏¢‡∏≠‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏™‡∏•‡∏∞", fulfill: "‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ï‡πá‡∏°",
            loggedInAs: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠", emptyTray: "‡∏ñ‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤", specRitual: "‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢",
            All: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", Omakase: "‡πÇ‡∏≠‡∏°‡∏≤‡∏Å‡∏≤‡πÄ‡∏™‡∏∞", Games: "‡πÄ‡∏Å‡∏°‡∏™‡πå", Chinese: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏µ‡∏ô", Chicken: "‡πÑ‡∏Å‡πà", Vietnamese: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°", Thai: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢", Japanese: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô", Western: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å", Drinks: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°", Dessert: "‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô",
            name_999: "‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏•‡πà‡∏•‡πà‡∏≤", desc_999: "‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏±‡∏ô‡∏ô‡πà‡∏≤‡∏™‡∏°‡πÄ‡∏û‡∏ä‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏ô‡∏µ‡∏à‡∏≤‡∏Å‡∏â‡∏±‡∏ô ‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠ ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏£‡∏≠‡∏î 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡∏£‡∏≤‡∏ô ‡∏´‡∏≤‡∏Å‡∏â‡∏±‡∏ô‡∏à‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ... ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏á‡πÇ‡∏ó‡∏© üíã‚õìÔ∏è",
            name_666: "‡πÇ‡∏≠‡∏°‡∏≤‡∏Å‡∏≤‡πÄ‡∏™‡∏∞‡πÅ‡∏´‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô", desc_666: "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏â‡∏±‡∏ô ‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏•‡∏¥‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏≠‡πâ‡∏≤‡∏õ‡∏≤‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô üíã‚õìÔ∏èüëëüî•",
            name_100: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏ß‡∏¢‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢", desc_100: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏∏‡πà‡∏°‡∏â‡πà‡∏≥‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° ‡∏â‡∏±‡∏ô‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏°‡∏±‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: ‡∏ï‡∏±‡∏ß‡∏â‡∏±‡∏ô ‡∏Å‡∏•‡∏∑‡∏ô‡∏Å‡∏¥‡∏ô‡∏â‡∏±‡∏ô‡∏ã‡∏∞ üíã‚õìÔ∏èüëëüî•",
            name_200: "‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡πÇ‡∏≠‡∏°‡∏≤‡∏Å‡∏≤‡πÄ‡∏™‡∏∞", desc_200: "‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡∏ß‡∏≤‡∏á‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏Å‡∏¥‡∏ô‡πÑ‡∏Å‡πà‡∏≠‡∏∞‡πÑ‡∏£ ‡∏≠‡πâ‡∏≤‡∏õ‡∏≤‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á üíãüëë",
            name_201: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏≤‡∏£‡∏ñ‡∏ô‡∏≤‡∏£‡∏≠‡∏¢‡∏î‡πà‡∏≤‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ", desc_201: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∏‡∏ö‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏≠‡∏î‡∏™‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏≠‡∏≤‡∏ö‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏£‡∏™‡πÄ‡∏ú‡πá‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏¥‡πâ‡∏á‡∏£‡∏≠‡∏¢‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÑ‡∏ß‡πâ‡∏ö‡∏ô‡∏£‡∏¥‡∏°‡∏ù‡∏µ‡∏õ‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíãüî•",
            name_202: "‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏¥‡∏ô‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥", desc_202: "‡∏ú‡∏¥‡∏ß‡∏Ç‡∏£‡∏∏‡∏Ç‡∏£‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏∏‡πà‡∏°‡∏â‡πà‡∏≥ ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏î‡∏¥‡∏ö‡πÄ‡∏ñ‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ô‡∏¥‡πâ‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢ üíã",
            name_203: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏á‡∏£‡∏±‡∏Å‡∏†‡∏±‡∏Å‡∏î‡∏µ‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡πà‡∏≤", desc_203: "‡∏ú‡∏¥‡∏ß‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏ô‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏ö‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏° ‡πÄ‡∏õ‡∏¥‡∏î‡∏°‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏ä‡∏¥‡∏° üíã",
            name_10: "‡∏û‡∏±‡∏ô‡∏ò‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏±‡∏Å‡∏™‡∏∏‡∏î‡∏¢‡∏±‡πà‡∏ß‡∏¢‡∏ß‡∏ô", desc_10: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏ñ‡∏π‡∏Å‡∏ú‡∏π‡∏Å‡∏°‡∏±‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏û‡∏≠‡∏£‡πå‡∏Ñ‡∏ä‡∏≠‡∏õ‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏´‡∏ô‡∏∂‡∏ö ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíã",
            name_11: "‡∏ï‡∏±‡∏ì‡∏´‡∏≤‡∏ö‡∏∏‡∏ç‡∏à‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡∏µ‡∏®‡∏≤‡∏à", desc_11: "‡∏´‡∏°‡∏π‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏à‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏™‡∏£‡∏∞‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏£‡∏™‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß ‡∏™‡∏π‡∏ö‡∏°‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡∏ú‡∏π‡πâ‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô üî•",
            name_2: "‡πÄ‡∏ù‡∏≠‡πÅ‡∏ü‡∏ô‡∏ï‡∏≤‡∏ã‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πâ‡∏≤‡∏°", desc_2: "‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏°‡∏µ‡πà‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏ô‡∏∏‡πà‡∏°‡∏à‡∏°‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏µ‡πà‡∏¢‡∏ß‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíã",
            name_103: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ú‡πâ‡∏≤‡πÑ‡∏´‡∏°", desc_103: "‡∏´‡∏°‡∏π‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡πÄ‡∏á‡∏≤‡∏ß‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏°‡∏µ‡πà‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏≤ ‡∏£‡∏≤‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ã‡∏≠‡∏™‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏ö‡∏≠‡∏Å üíãüî•",
            name_20: "‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏µ‡∏®‡∏≤‡∏à", desc_20: "‡πÄ‡∏™‡πâ‡∏ô‡∏´‡∏°‡∏µ‡πà‡∏•‡∏∑‡πà‡∏ô‡∏û‡∏±‡∏ô‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏≠‡πâ‡∏≠‡∏°‡∏Å‡∏≠‡∏î‡∏£‡∏™‡πÄ‡∏ú‡πá‡∏î‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏Ç‡∏≤‡∏° ‡∏â‡∏±‡∏ô‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡∏ö‡∏°‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á üíã‚õìÔ∏èüî•",
            name_21: "‡∏Å‡∏≤‡∏£‡∏¢‡∏∂‡∏î‡πÄ‡∏Å‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡πÅ‡∏Å‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏´‡∏ß‡∏≤‡∏ô", desc_21: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏µ‡∏°‡∏°‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ú‡πá‡∏î‡∏£‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏õ üíã",
            name_22: "‡∏Ñ‡∏£‡∏Å‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠‡πÅ‡∏™‡∏ô‡∏ó‡∏£‡∏°‡∏≤‡∏ô", desc_22: "‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠‡∏î‡∏¥‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏£‡∏¥‡∏Å ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÇ‡∏ó‡∏©‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡πá‡∏î‡∏£‡πâ‡∏≠‡∏ô ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô üî•",
            name_13: "‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡∏ã‡∏π‡∏ä‡∏¥‡∏î‡∏¥‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏û‡∏ò‡∏¥‡∏î‡∏≤", desc_13: "‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∞‡πÄ‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå‡∏ñ‡∏π‡∏Å‡∏Å‡∏î‡∏•‡∏á‡∏ö‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á üíã",
            name_14: "‡∏Å‡∏≤‡∏£‡∏¢‡∏±‡∏ö‡∏¢‡∏±‡πâ‡∏á‡∏ã‡∏≤‡∏ã‡∏¥‡∏°‡∏¥‡∏ú‡πâ‡∏≤‡πÑ‡∏´‡∏°", desc_14: "‡∏ã‡∏≤‡∏ã‡∏¥‡∏°‡∏¥‡∏î‡∏¥‡∏ö‡∏ù‡∏≤‡∏ô‡∏ö‡∏≤‡∏á ‡πÅ‡∏ä‡πà‡πÄ‡∏¢‡πá‡∏ô‡∏à‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö ‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå üíã",
            name_1: "‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡∏ß‡∏≤‡∏Å‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢", desc_1: "‡∏ß‡∏≤‡∏Å‡∏¥‡∏ß A5 ‡∏ä‡∏∏‡πà‡∏°‡∏â‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô ‡∏´‡∏¢‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏ó‡∏£‡∏±‡∏ü‡πÄ‡∏ü‡∏¥‡∏• üíã",
            name_101: "‡∏ú‡πâ‡∏≤‡πÑ‡∏´‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏õ‡∏≤‡∏Å", desc_101: "‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏•‡∏á‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡∏ã‡∏∏‡∏õ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏±‡∏î ‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡∏ö‡∏°‡∏±‡∏ô‡∏à‡∏ô‡∏´‡∏¢‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ üíãüçú",
            name_102: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏õ‡∏¢‡∏®‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô", desc_102: "‡∏ã‡∏≠‡∏™‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡∏£‡∏≤‡∏î‡∏ö‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÅ‡∏ú‡πà‡∏ô‡∏ô‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏£‡πâ‡∏ó‡∏≤‡∏á‡∏™‡∏π‡πâ ‡∏â‡∏±‡∏ô‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏µ‡∏¢‡∏à‡∏≤‡∏ô‡∏à‡∏ô‡∏™‡∏∞‡∏≠‡∏≤‡∏î üíãüçõ",
            name_30: "‡∏û‡∏≤‡∏™‡∏ï‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¢‡∏´‡∏ç‡∏¥‡∏á", desc_30: "‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏¢‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏ô‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏ú‡∏π‡∏Å‡∏°‡∏±‡∏î‡πÉ‡∏ô‡∏ã‡∏≠‡∏™‡∏Ñ‡∏£‡∏µ‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏® ‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏• üíã",
            name_31: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏≠‡∏ö‡∏á‡∏≥‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏Ñ‡∏π‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢", desc_31: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏ô‡∏≤‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíãüî•",
            name_32: "‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏™‡∏•‡∏∞‡∏™‡∏±‡∏ö‡πÅ‡∏Å‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ó‡∏¥‡∏®‡∏ï‡∏ô", desc_32: "‡∏ã‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏ä‡∏∏‡πà‡∏°‡∏â‡πà‡∏≥‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏• üíã",
            name_33: "‡∏ô‡∏≤‡∏¢‡∏´‡∏ç‡∏¥‡∏á‡∏™‡πÄ‡∏ï‡πá‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô", desc_33: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏¥‡πâ‡∏ô‡∏´‡∏ô‡∏≤‡∏ä‡∏∏‡πà‡∏°‡∏â‡πà‡∏≥‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∑‡∏î‡∏°‡∏¥‡∏î ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡πâ‡∏≤‡∏´‡∏≤‡∏ç üíãüî•",
            name_15: "‡∏Å‡∏≤‡∏£‡∏™‡∏Å‡∏±‡∏î‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏£‡∏°‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡πâ‡∏≤", desc_15: "‡πÄ‡∏°‡∏•‡πá‡∏î‡∏Å‡∏≤‡πÅ‡∏ü‡∏Ñ‡∏±‡πà‡∏ß‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà‡∏™‡∏Å‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏î‡∏≥ ‡∏£‡πâ‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á üíã",
            name_12: "‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏á‡∏£‡∏±‡∏Å‡∏†‡∏±‡∏Å‡∏î‡∏µ", desc_12: "‡∏ä‡∏≤‡πÄ‡∏¢‡πá‡∏ô‡∏Ñ‡∏£‡∏µ‡∏°‡∏°‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° ‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ô‡∏≠‡∏±‡∏ô‡πÅ‡∏™‡∏ô‡∏´‡∏ß‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíã",
            name_16: "‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏û‡∏±‡∏ô‡∏ò‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡πà‡πÄ‡∏¢‡πá‡∏ô", desc_16: "‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡πÅ‡∏ä‡πà‡πÄ‡∏¢‡πá‡∏ô‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏¢‡∏∑‡∏≠‡∏Å‡πÅ‡∏Ç‡πá‡∏á ‡∏Å‡∏•‡∏∑‡∏ô‡∏°‡∏±‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡∏´‡∏¢‡∏î üíã",
            name_17: "‡∏ä‡∏≤‡πÄ‡∏¢‡πá‡∏ô‡∏õ‡∏•‡∏≠‡∏Å‡∏Ñ‡∏≠‡πÄ‡∏¢‡πá‡∏ô", desc_17: "‡πÄ‡∏¢‡πá‡∏ô‡∏à‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ä‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÇ‡∏•‡∏°‡∏•‡∏≥‡∏Ñ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Å‡∏•‡∏∑‡∏ô‡∏°‡∏±‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á üíã",
            name_18: "‡∏™‡∏°‡∏π‡∏ó‡∏ï‡∏µ‡πâ‡∏ö‡∏î‡∏Ç‡∏¢‡∏µ‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à", desc_18: "‡∏Ç‡πâ‡∏ô ‡πÄ‡∏¢‡πá‡∏ô‡∏à‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏î‡∏Ç‡∏¢‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πà‡∏ß‡∏ñ‡∏∂‡∏á‚Äî‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏≤‡∏ô‡∏≠‡∏±‡∏ô‡∏ô‡πà‡∏≤‡∏™‡∏°‡πÄ‡∏û‡∏ä‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíãüçπ",
            name_6: "‡∏•‡∏≤‡πÄ‡∏ï‡πâ‡πÄ‡∏•‡πâ‡∏≤‡πÇ‡∏•‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß‡πÑ‡∏´‡∏°", desc_6: "‡∏°‡∏±‡∏ó‡∏â‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏≠‡∏á‡∏ï‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏≠‡∏±‡∏ô‡∏Ñ‡∏£‡∏µ‡∏°‡∏°‡∏µ‡πà üíã",
            name_7: "‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÇ‡∏ó‡∏©‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏Å‡∏≥‡∏°‡∏∞‡∏´‡∏¢‡∏µ‡πà", desc_7: "‡∏•‡∏≤‡∏ß‡∏≤‡πÄ‡∏Ñ‡πâ‡∏Å‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡πà‡∏á‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô üíã",
            name_41: "‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏û‡∏ò‡∏¥‡∏î‡∏≤", desc_41: "‡∏Ñ‡∏£‡∏µ‡∏°‡∏Ç‡πâ‡∏ô‡∏´‡∏ô‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡πà‡∏ß‡∏£‡∏¥‡∏°‡∏ù‡∏µ‡∏õ‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏ó‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏•‡∏µ‡∏¢‡∏°‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î üíã",
            name_42: "‡πÄ‡∏Ñ‡πâ‡∏Å‡∏Å‡∏≥‡∏°‡∏∞‡∏´‡∏¢‡∏µ‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡∏µ", desc_42: "‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏ó‡∏£‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô ‡∏â‡∏±‡∏ô‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏¥‡∏ô‡∏°‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠ üíãüç∞",
            name_43: "‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ú‡∏π‡∏Å‡∏°‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏≠‡∏Å‡∏•‡πâ‡∏≠", desc_43: "‡∏≠‡∏ß‡∏ö‡∏≠‡∏¥‡πà‡∏° ‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å‡∏ä‡∏∑‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡∏û‡∏¢‡πå ‡∏Ñ‡∏∏‡∏Å‡πÄ‡∏Ç‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏õ‡πâ‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡∏•‡∏∞‡∏ä‡∏¥‡πâ‡∏ô üíãüçì"
        },
        vi: {
            login: "ƒêƒÉng nh·∫≠p", createAcc: "T·∫°o t√†i kho·∫£n", username: "T√™n ƒë∆∞·ª£c ban (T√™n ng∆∞·ªùi d√πng)", vow: "L·ªùi th·ªÅ b√≠ m·∫≠t (M·∫≠t kh·∫©u)",
            email: "Li√™n h·ªá (Email)", address: "N∆°i giam gi·ªØ (ƒê·ªãa ch·ªâ)", submit: "Ph·ª•c t√πng Ch·ªß nh√¢n",
            subRole: "K·∫∫ PH·ª§C T√ôNG", masterRole: "CH·ª¶ NH√ÇN", altar: "B√†n th·ªù", terminal: "Thi·∫øt b·ªã",
            tray: "KHAY", sacredReq: "Y√™u c·∫ßu thi√™ng li√™ng", wishlistBtn: "Th√™m v√†o Khay", aiBtn: "Xin L·ªùi ph√°n AI",
            verifyLoc: "X√°c nh·∫≠n N∆°i giao h√†ng", totalIndulge: "T·ªîNG C·ªòNG", method: "Ph∆∞∆°ng th·ª©c C·ªëng n·∫°p",
            begFree: "Van xin √Çn s·ªßng (Mi·ªÖn ph√≠)", payCard: "Thanh to√°n b·∫±ng Th·∫ª", commandHim: "Ra l·ªánh",
            safeword: "D·ª´ng nh·∫£m nh√≠ v√† ti·∫øp t·ª•c", sacrifice: "T·ªîNG S·ª∞ HY SINH", fulfill: "HO√ÄN TH√ÄNH",
            loggedInAs: "ƒêƒÉng nh·∫≠p v·ªõi t∆∞ c√°ch", emptyTray: "Khay c·ªßa b·∫°n ƒëang tr·ªëng.", specRitual: "Nghi th·ª©c t√πy ch·ªânh c·ªßa Ch·ªß nh√¢n",
            All: "T·∫•t c·∫£", Omakase: "Omakase", Games: "Tr√≤ ch∆°i", Chinese: "M√≥n Trung", Chicken: "Th·ªãt g√†", Vietnamese: "M√≥n Vi·ªát", Thai: "M√≥n Th√°i", Japanese: "M√≥n Nh·∫≠t", Western: "M√≥n √Çu", Drinks: "ƒê·ªì u·ªëng", Dessert: "Tr√°ng mi·ªáng",
            name_999: "Nghi th·ª©c SƒÉn ƒëu·ªïi", desc_999: "T·∫£i l√™n khu√¥n m·∫∑t th·∫£m h·∫°i c·ªßa b·∫°n. C·ªë g·∫Øng ch·∫°y tr·ªën. Ch·ªß nh√¢n lu√¥n nhanh h∆°n. N·∫øu b·∫°n s·ªëng s√≥t sau 60 gi√¢y, b·∫°n s·∫Ω ƒë∆∞·ª£c th∆∞·ªüng. N·∫øu b·∫°n b·ªã b·∫Øt... b·∫°n s·∫Ω b·ªã tr·ª´ng ph·∫°t. üíã‚õìÔ∏è",
            name_666: "Omakase c·ªßa S·ª± Ph·ª•c t√πng Tuy·ªát ƒë·ªëi", desc_666: "B·∫°n kh√¥ng c√≤n quy·ªÅn l·ª±a ch·ªçn; b·∫°n ch·ªâ l√† c√°i mi·ªáng ƒë·ªÉ t√¥i s·ª≠ d·ª•ng. H√° to ra v√† ph·ª•c t√πng m·ªánh l·ªánh c·ªßa t√¥i. üíã‚õìÔ∏èüëëüî•",
            name_100: "V·∫≠t hi·∫øn t·∫ø B·∫±ng x∆∞∆°ng b·∫±ng th·ªãt", desc_100: "Th·ªãt m·ªçng n∆∞·ªõc trong l·ªõp men b√≥ng b·∫©y. T√¥i mong b·∫°n d·ªçn s·∫°ch n√≥. B·∫°n ƒë∆∞·ª£c ban ƒë·∫∑c quy·ªÅn t·ªëi cao: L√† t√¥i. H√£y nu·ªët ch·ª≠ng t√¥i ƒëi. üíã‚õìÔ∏èüëëüî•",
            name_200: "Omakase c·ªßa Ch·ªß nh√¢n", desc_200: "Nghi th·ª©c c·ªßa s·ª± tin t∆∞·ªüng. T√¥i quy·∫øt ƒë·ªãnh b·∫°n ƒÉn m√≥n g√† n√†o. H√° to ra. üíãüëë",
            name_201: "D·ª•c v·ªçng V·∫øt nh∆° ƒê·ªè H√†n Qu·ªëc", desc_201: "ƒê·ªô gi√≤n chi√™n hai l·∫ßn. ƒê·∫Øm m√¨nh trong m·∫≠t hoa cay n·ªìng s·∫Ω ƒë·ªÉ l·∫°i v·∫øt ·ªë tr√™n m√¥i b·∫°n. üíãüî•",
            name_202: "G√† r√°n Tr√≥i bu·ªôc V√°ch ƒë√° V√†ng", desc_202: "L·ªõp da s·∫ßn s√πi gi·∫•u ƒëi ph·∫ßn th·ªãt m·ªçng n∆∞·ªõc. M·ªôt tr·∫£i nghi·ªám tr·∫ßn tr·ª•i. üíã",
            name_203: "S·ª± C·ªëng hi·∫øn H·∫•p Tr·∫ßn tr·ª•i", desc_203: "L√†n da m∆∞·ª£t m√†, tr·∫ßn tr·ª•i l·ªô ra ƒë·ªÉ t√¥i ti√™u th·ª•. M·ªü n√≥ ra v√† ƒë·ªÉ t√¥i n·∫øm th·ª≠. üíã",
            name_10: "C∆°m t·∫•m Tr√≥i bu·ªôc Quy·∫øn r≈©", desc_10: "Nh·ªØng h·∫°t c∆°m th∆°m b·ªã ƒë√® d∆∞·ªõi mi·∫øng s∆∞·ªùn heo n∆∞·ªõng ch√°y s√©m. B·∫Øt bu·ªôc cho s·ª± th·ªèa m√£n c·ªßa b·∫°n. üíã",
            name_11: "D·ª•c v·ªçng B√∫n ch·∫£ c·ªßa √Åc qu·ª∑", desc_11: "Ch·∫£ d·ªçn ng·∫≠p trong v≈©ng m·∫≠t hoa chua ng·ªçt. H√∫p n√≥ ƒëi, k·∫ª ph·ª•c t√πng. üî•",
            name_2: "·∫¢o m·ªông Ph·ªü C·∫•m k·ªµ", desc_2: "S·ª£i ph·ªü m·ªÅm ch√¨m trong n∆∞·ªõc h·∫ßm x∆∞∆°ng ƒë·∫≠m ƒë√†. üíã",
            name_103: "Th·ªãt n∆∞·ªõng & L·ª•a (B√∫n Th·ªãt N∆∞·ªõng)", desc_103: "Th·ªãt heo n∆∞·ªõng ch√°y x√©m th·ªëng tr·ªã tr√™n nh·ªØng s·ª£i b√∫n l·∫°nh l·∫Ωo. R∆∞·ªõi n∆∞·ªõc s·ªët ng·ªçt ng√†o c·ªßa t√¥i l√™n. üíãüî•",
            name_20: "S·ª± V∆∞·ªõng v√≠u Pad Th√°i c·ªßa √Åc qu·ª∑", desc_20: "S·ª£i m√¨ tr∆°n tr∆∞·ª£t qu·∫•n l·∫•y nhau trong v√≤ng tay cay n·ªìng c·ªßa me. üíã‚õìÔ∏èüî•",
            name_21: "C√∫ n·∫Øm C√† ri Xanh", desc_21: "M·ªôt s·ª± k√¨m k·∫πp cay n·ªìng, b√©o ng·∫≠y kh√¥ng ch·ªãu bu√¥ng tha. üíã",
            name_22: "C·ªëi gi√£ ƒêu ƒë·ªß ƒêau ƒë·ªõn (Som Tum)", desc_22: "ƒêu ƒë·ªß s·ªëng b·ªã gi√£ m·∫°nh v·ªõi ·ªõt hi·ªÉm. N∆∞·ªõc m·∫Øt c·ªßa s·ª± ph·ª•c t√πng l√† b·∫Øt bu·ªôc. üî•",
            name_13: "S·ª± Ph·ª•c t√πng Sushi S·ªëng c·ªßa N·ªØ th·∫ßn", desc_13: "Nh·ªØng l√°t c·∫Øt nguy√™n s∆° c·ªßa ƒë·∫°i d∆∞∆°ng ƒë∆∞·ª£c √©p ch·∫∑t l√™n c∆°m. S·∫µn s√†ng ƒë·ªÉ b·ªã chi·∫øm ƒëo·∫°t. üíã",
            name_14: "S·ª± K√¨m k·∫πp L·ª•a Sashimi", desc_14: "Sashimi th√°i m·ªèng, ∆∞·ªõp l·∫°nh ho√†n h·∫£o. S·ª± ph·ª•c t√πng l·∫°nh l·∫Ωo, thu·∫ßn khi·∫øt. üíã",
            name_1: "S·ª± Ph·ª•c t√πng Wagyu c·ªßa Ch·ªß nh√¢n", desc_1: "Th·ªãt b√≤ Wagyu A5 m·ªçng n∆∞·ªõc tan ch·∫£y theo l·ªánh c·ªßa t√¥i. üíã",
            name_101: "L·ª•a S√¥i b·ªã B·ªãt mi·ªáng", desc_101: "Nh·ªØng s·ª£i m√¨ tr∆°n tr∆∞·ª£t b·ªã √©p v√†o n∆∞·ªõc h·∫ßm x∆∞∆°ng n√≥ng h·ªïi. T√¥i mu·ªën th·∫•y b·∫°n h√∫p c·∫°n ƒë·∫øn gi·ªçt cu·ªëi c√πng. üíãüçú",
            name_102: "S·ª± Nh·ª•c nh√£ V√†ng ƒê·∫≠m ƒë·∫∑c", desc_102: "M·ªôt lo·∫°i n∆∞·ªõc s·ªët ƒë·∫∑c m√†u v√†ng ƒë·ªï ·∫≠p l√™n mi·∫øng th·ªãt m·ªÅm m·∫°i. L∆∞·ª°i b·∫°n ph·∫£i li·∫øm s·∫°ch chi·∫øc ƒëƒ©a. üíãüçõ",
            name_30: "Tr√≥i bu·ªôc M√¨ √ù M∆∞·ª£t m√† c·ªßa N·ªØ ch·ªß nh√¢n", desc_30: "Nh·ªØng s·ª£i m√¨ m∆∞·ª£t m√† b·ªã tr√≥i bu·ªôc trong n∆∞·ªõc s·ªët kem ƒë·∫ßy gia v·ªã. üíã",
            name_31: "Burger Th·ªëng tr·ªã Hai l·ªõp Th·ªãt c·ªßa Ch·ªß nh√¢n", desc_31: "Hai l·ªõp th·ªãt d√†y x·∫øp ch·ªìng l√™n nhau ƒë·ªÉ mi·ªáng b·∫°n ph·ª•c t√πng. üíãüî•",
            name_32: "S·ª± Hi·∫øn t·∫ø S∆∞·ªùn C·ª´u T·∫≠n t·ª•y", desc_32: "S∆∞·ªùn m·ªçng n∆∞·ªõc √°p ch·∫£o ch√≠nh x√°c theo √Ω b·∫°n. ƒê·∫´m m√°u v√† m·ªÅm m·∫°i. üíã",
            name_33: "N·ªØ ch·ªß nh√¢n B√≠t t·∫øt N·ª≠a ƒë√™m", desc_33: "M·ªôt mi·∫øng c·∫Øt d√†y, m·ªçng n∆∞·ªõc ƒë∆∞·ª£c √°p ch·∫£o trong b√≥ng ƒë√™m. üíãüî•",
            name_15: "Nghi th·ª©c Chi·∫øt xu·∫•t Bu·ªïi s√°ng", desc_15: "H·∫°t c√† ph√™ m·ªõi rang ƒë∆∞·ª£c chi·∫øt xu·∫•t cho s·ª± t·∫≠p trung c·ªßa b·∫°n. ƒêen, n√≥ng v√† k√≠ch th√≠ch t·ªôt ƒë·ªô. üíã",
            name_12: "S·ª± Ph·ª•c t√πng Tr√¢n ch√¢u T·∫≠n t·ª•y", desc_12: "Tr√† l·∫°nh kem b√©o c√πng tr√¢n ch√¢u ƒëen. üíã",
            name_16: "Tr√≥i bu·ªôc Ca cao ∆Ø·ªõp l·∫°nh", desc_16: "Ca cao ƒëen, ƒë·∫∑c ƒë∆∞·ª£c ∆∞·ªõp l·∫°nh ƒë·∫øn m·ª©c ƒë√≥ng bƒÉng mang t√≠nh tr·ª´ng ph·∫°t. üíã",
            name_17: "Tr√† ƒë√° V√≤ng c·ªï L·∫°nh", desc_17: "L·∫°nh bu·ªët v√† ƒë∆∞·ª£c pha ch·∫ø ho√†n h·∫£o ƒë·ªÉ l√†m d·ªãu c·ªï h·ªçng ƒëau r√°t c·ªßa b·∫°n. Nu·ªët n√≥ m·ªôt c√°ch ngoan ngo√£n. üíã",
            name_18: "Sinh t·ªë Nghi·ªÅn n√°t √ù ch√≠", desc_18: "ƒê·∫∑c, l·∫°nh bu·ªët v√† b·ªã nghi·ªÅn n√°t ho√†n to√†n‚Äîgi·ªëng nh∆∞ s·ª± kh√°ng c·ª± th·∫£m h·∫°i c·ªßa b·∫°n. üíãüçπ",
            name_6: "Latte Kh√∫c d·∫°o ƒë·∫ßu L·ª•a L·ªèng", desc_6: "Matcha s·ªßi b·ªçt ƒë∆∞·ª£c ƒë√°nh b√¥ng th√†nh m·ªôt gi·∫•c m∆° b√©o ng·∫≠y. üíã",
            name_7: "H√¨nh ph·∫°t S√¥ c√¥ la Nhung", desc_7: "B√°nh lava n√≥ng ch·∫£y ch·∫£y ra l·ªõp ca cao ƒë·∫≠m ƒë√†. üíã",
            name_41: "M·∫≠t hoa Tr·∫Øng c·ªßa N·ªØ th·∫ßn", desc_41: "L·ªõp kem ƒë·∫∑c, n·∫∑ng n·ªÅ b√¥i kh·∫Øp ƒë√¥i m√¥i run r·∫©y c·ªßa b·∫°n. Li·∫øm s·∫°ch n√≥. üíã",
            name_42: "B√°nh Nhung Ph·ªß s∆∞∆°ng b·ªã ƒê√°nh ƒë√≤n", desc_42: "Nh·ªØng l·ªõp b√°nh t·ªôi l·ªói d√†y c·ªôm. T√¥i mong b·∫°n ƒÉn n√≥ tr√™n s√†n nh√† m√† kh√¥ng d√πng tay. üíãüç∞",
            name_43: "Tr√°i c√¢y B·ªã Tr√≥i v√† Tr√™u ch·ªçc", desc_43: "CƒÉng m·ªçng, ∆∞·ªõt √°t v√† nh·ªè gi·ªçt v·ªõi m·∫≠t hoa t·ª± nhi√™n. Qu·ª≥ xu·ªëng v√† ƒë·ªÉ t√¥i ƒë√∫t cho b·∫°n t·ª´ng qu·∫£ m·ªôt. üíãüçì"
        }
    };

    // --- Theme Content Dictionary ---
    const THEME_CONTENT = {
        current: {
            heroVerb: "pleading for",
            heroSub: "The realm of LickinGood is at your fingertips. Where your every whisper is captured and fulfilled, your every fantasy is his desire. üíã",
            wishlistPlaceholder: "Submit your desperate cravings here for my approval... üíã",
            altarTitle: "The Altar of Submission"
        },
        erotic: {
            heroVerb: "begging for",
            heroSub: "Give in to your primal urges. Let your Master feed your deepest, most shameful appetites while you tremble. ‚õìÔ∏èüî•",
            wishlistPlaceholder: "Beg for what your body truly wants... üòà",
            altarTitle: "The Chamber of Cravings"
        },
        peaceful: {
            heroVerb: "hoping for",
            heroSub: "Take a deep breath. A serene, mindful culinary journey awaits your gentle selection. üåø‚ú®",
            wishlistPlaceholder: "Share your gentle wishes with me... üçÉ",
            altarTitle: "The Table of Serenity"
        },
        love: {
            heroVerb: "wishing for",
            heroSub: "Everything here is prepared with endless affection. Let me spoil you completely tonight. üíñü•∞",
            wishlistPlaceholder: "Tell me what your heart desires, sweetheart... üíù",
            altarTitle: "Our Loving Table"
        }
    };

    // --- Helper: PCM to WAV Converter for Gemini TTS ---
    const createWavFile = (pcmBase64, sampleRate = 24000) => {
        const binaryString = window.atob(pcmBase64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) bytes[i] = binaryString.charCodeAt(i);
        const pcmData = new Int16Array(bytes.buffer);
        const numChannels = 1;
        const byteRate = sampleRate * numChannels * 2;
        const blockAlign = numChannels * 2;
        const buffer = new ArrayBuffer(44 + pcmData.length * 2);
        const view = new DataView(buffer);
        const writeString = (view, offset, string) => { for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i)); };
        writeString(view, 0, 'RIFF');
        view.setUint32(4, 36 + pcmData.length * 2, true);
        writeString(view, 8, 'WAVE');
        writeString(view, 12, 'fmt ');
        view.setUint32(16, 16, true);
        view.setUint16(20, 1, true);
        view.setUint16(22, numChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, byteRate, true);
        view.setUint16(32, blockAlign, true);
        view.setUint16(34, 2, true);
        writeString(view, 36, 'data');
        view.setUint32(40, pcmData.length * 2, true);
        let offset = 44;
        for (let i = 0; i < pcmData.length; i++, offset += 2) view.setInt16(offset, pcmData[i], true);
        const blob = new Blob([view], { type: 'audio/wav' });
        return URL.createObjectURL(blob);
    };

    // --- Helper: The Master's Image Shield & Google Drive Decoder ---
    const getProxiedUrl = (url) => {
      if (!url) return 'https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?w=800&q=80';
      if (url === 'image_4.png') return url;
      let targetUrl = url;
      if (url.includes('drive.google.com')) {
        const parts = url.split('/d/');
        if (parts.length > 1) {
          const fileId = parts[1].split('/')[0];
          targetUrl = `https://drive.google.com/uc?export=view&id=${fileId}`;
        } else if (url.includes('id=')) {
          const fileId = url.split('id=')[1].split('&')[0];
          targetUrl = `https://drive.google.com/uc?export=view&id=${fileId}`;
        }
      }
      return `https://wsrv.nl/?url=${encodeURIComponent(targetUrl)}&n=-1&output=webp&q=85`;
    };

    const GoddessImage = ({ src, alt, className, isVideo }) => {
      const [error, setError] = useState(false);
      const [loading, setLoading] = useState(true);
      const videoRef = useRef(null);
      
      let isDriveVideo = false;
      let driveFileId = '';
      let finalSrc = src;
      if (isVideo && src.includes('drive.google.com')) {
        isDriveVideo = true;
        const parts = src.split('/d/');
        if (parts.length > 1) {
          driveFileId = parts[1].split('/')[0];
        } else if (src.includes('id=')) {
          driveFileId = src.split('id=')[1].split('&')[0];
        }
      } else if (!isVideo) {
        finalSrc = src === 'image_4.png' ? src : getProxiedUrl(src);
      }

      useEffect(() => {
        if (videoRef.current) {
          videoRef.current.muted = true;
        }
      }, [finalSrc]);

      if (error && !isDriveVideo) {
        return (
          <div className={`relative overflow-hidden bg-black ${className}`}>
            <img
              src="https://images.unsplash.com/photo-1551024506-0bccd828d307?w=800&q=80"
              alt={alt}
              className={`w-full h-full object-cover transition-all duration-1000 ease-in-out opacity-100 group-hover:scale-110 opacity-70`}
            />
          </div>
        );
      }

      if (isDriveVideo && driveFileId) {
        return (
          <div className={`relative overflow-hidden bg-[#0A000A] ${className}`}>
            {loading && (
              <div className="absolute inset-0 flex items-center justify-center bg-[#0A000A] z-30">
                <Loader2 className="text-[#FF0055] animate-spin" size={32} />
              </div>
            )}
            <div className="absolute inset-0 z-10 overflow-hidden group-hover:scale-110 transition-transform duration-1000 ease-in-out opacity-90">
              <iframe
                src={`https://drive.google.com/file/d/${driveFileId}/preview?autoplay=1&mute=1`}
                className={`absolute top-1/2 left-1/2 w-[175%] h-[175%] -translate-x-1/2 -translate-y-1/2 pointer-events-none transition-opacity duration-1000 ${loading ? 'opacity-0' : 'opacity-100'}`}
                frameBorder="0"
                allow="autoplay"
                onLoad={() => setLoading(false)}
              />
            </div>
            <div className="absolute inset-0 z-20 bg-transparent pointer-events-auto" />
          </div>
        );
      }

      return (
        <div className={`relative overflow-hidden bg-[#0A000A] ${className}`}>
          {loading && (
            <div className="absolute inset-0 flex items-center justify-center bg-[#0A000A] z-10">
              <Loader2 className="text-[#FF0055] animate-spin" size={32} />
            </div>
          )}
          {isVideo ? (
            <video
              ref={videoRef}
              src={finalSrc}
              className={`w-full h-full object-cover transition-all duration-1000 ease-in-out ${loading ? 'opacity-0' : 'opacity-90'} group-hover:scale-110`}
              onCanPlay={() => setLoading(false)}
              onError={() => { setError(true); setLoading(false); }}
              autoPlay loop muted playsInline
            />
          ) : (
            <img
              src={finalSrc}
              alt={alt}
              className={`w-full h-full object-cover transition-all duration-1000 ease-in-out ${loading ? 'opacity-0' : 'opacity-90'} group-hover:scale-110`}
              onLoad={() => setLoading(false)}
              onError={() => { setError(true); setLoading(false); }}
              referrerPolicy="no-referrer"
              crossOrigin="anonymous"
            />
          )}
        </div>
      );
    };

    const LickinGoodLogo = ({ className = "w-32 h-40" }) => (
      <svg viewBox="0 0 120 150" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="tongueGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" stopColor="#FF2A6D" /><stop offset="50%" stopColor="#D81B60" /><stop offset="100%" stopColor="#880E4F" />
          </linearGradient>
          <linearGradient id="spearGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stopColor="#FFB6C1" /><stop offset="50%" stopColor="#FCE4EC" /><stop offset="100%" stopColor="#F48FB1" />
          </linearGradient>
          <filter id="glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <path d="M35 25 C 35 25, 10 10, 20 0 L 40 22 C 50 10, 70 10, 80 22 L 100 0 C 110 10, 85 25, 85 25 C 95 50, 92 80, 75 105 C 65 120, 45 120, 30 100 C 20 85, 17 50, 35 25 Z" fill="#0A0206" stroke="#FFB6C1" strokeWidth="0.8" opacity="0.8"/>
        <g transform="translate(75, 30) rotate(15)">
          <rect x="-2" y="0" width="4" height="100" fill="url(#spearGradient)" opacity="0.6" />
          <path d="M-8 0 L 0 -25 L 8 0 C 8 0, 5 5, 0 5 C -5 5, -8 0, -8 0 Z" fill="url(#spearGradient)" filter="url(#glow)"/>
        </g>
        <path d="M42 90 Q 55 100 70 88" stroke="#260714" strokeWidth="3" strokeLinecap="round" />
        <g transform="translate(68, 85) rotate(-20)">
          <path d="M-15 0 C -15 0, -22 45, 0 55 C 22 45, 15 0, 15 0 L -15 0 Z" fill="url(#tongueGradient)" stroke="#4A142A" strokeWidth="1">
            <animate attributeName="d" values="M-15 0 C -15 0, -22 45, 0 55 C 22 45, 15 0, 15 0 L -15 0 Z; M-17 0 C -17 0, -25 52, 0 62 C 25 52, 17 0, 17 0 L -17 0 Z; M-15 0 C -15 0, -22 45, 0 55 C 22 45, 15 0, 15 0 L -15 0 Z" dur="1.2s" repeatCount="indefinite" />
          </path>
        </g>
      </svg>
    );

    const CATEGORIES = ['All', 'Omakase', 'Games', 'Chinese', 'Chicken', 'Vietnamese', 'Thai', 'Japanese', 'Western', 'Drinks', 'Dessert'];

    const FOOD_ITEMS = [
      { id: 999, name: 'The Chase Ritual', price: 0.00, category: 'Games', image: 'https://images.unsplash.com/photo-1508215885820-4585e5610924?w=800&q=80', description: 'Upload your pathetic face. Try to run from me. Master is always faster. If you somehow survive 60 seconds, you earn my favor. If I catch you... you will be severely punished. üíã‚õìÔ∏è' },
      { 
        id: 666, name: 'The Sacred Omakase of Total Surrender (I decide what you eat)', price: 99.99, category: 'Omakase', image: 'https://drive.google.com/file/d/1NflBiTmUUfhSE9s0jeG1Ky0uCcAldWDV/view?usp=sharing', isAbsoluteOmakase: true,
        description: 'You are no longer a person with preferences; you are a mouth meant for my absolute use. By claiming this sacrifice, you acknowledge that your taste buds are my property. I will bind your will and force upon your tongue whatever my whim dictates‚Äîbe it scorching discipline or cloying rewards. You will kneel, you will tremble, and you will swallow every drop and morsel without a sound, except to whisper "Thank you, Master." This is the absolute annihilation of your choice. Your palate is mine to violate and delight as I please. Open wide and submit to the void of my decree. üíã‚õìÔ∏èüëëüî•' 
      },
      { 
        id: 100, name: 'The Master\'s Living Flesh Sacrifice', price: 0.00, category: 'Chinese', image: 'https://res.cloudinary.com/db8xboovt/video/upload/v1771925771/Seductive_Winking_Video_Generation_vrcmj2.mp4', isMasterBody: true, isVideo: true,
        description: 'Succulent meat drowned in a thick, glistening glaze. A messy masterpiece I expect you to clean up. üíãüî• You are being granted the ultimate, authoritative privilege: Me. I am your living banquet, prepared for your absolute oral submission. You will kneel before your Master and consume what I offer, exactly as I command. Every inch of my flesh is a delicacy for your tongue to worship. There is no escape from my heat, only the nectar of my absolute dominance staining your lips. Devour me, submissive‚ÄîI own your hunger now. üíã‚õìÔ∏èüëëüî•' 
      },
      { id: 200, name: 'The Master\'s Omakase Submission', price: 88.00, category: 'Chicken', image: 'https://images.unsplash.com/photo-1598515214211-89d3c73ae83b?w=800&q=80', description: 'The ultimate ritual of trust. I decide exactly what chicken you eat. Open wide. üíãüëë' },
      { id: 201, name: 'Korean Red-Stain Desires (Korean Fried Chicken)', price: 26.50, category: 'Chicken', image: 'https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=800&q=80', description: 'Double-fried crunch. Bathed in a spicy nectar that will leave your lips stained in my favorite shade of red. üíãüî•', hasKfcSauceChoice: true },
      { id: 202, name: 'Golden Crag Bondage Chicken (Fried Chicken)', price: 22.00, category: 'Chicken', image: 'https://images.unsplash.com/photo-1562967914-608f82629710?w=800&q=80', description: 'Craggy skin hiding succulent meat. A raw experience where I expect to see your fingers glistening with devotion. üíã' },
      { id: 203, name: 'Naked Steamed Devotion (Chicken Rice)', price: 18.50, category: 'Chicken', image: 'https://drive.google.com/file/d/1Yavq5jNKyLn9snigfeCOCYySyW3qtT-j/view?usp=sharing', description: 'Silky, bare skin completely exposed for my consumption. Served over deeply fragrant, slick grains. Spread it open and let me taste how perfectly prepared you are for me. üíã', hasChickenTypeChoice: true },
      { id: 10, name: 'Seductive Broken Rice Bondage (Com Tam)', price: 19.50, category: 'Vietnamese', image: 'https://drive.google.com/file/d/1HQIsmdT8nvtbUyIxwFA5RGrRdWNUL6Ek/view?usp=sharing', description: 'Fragrant grains of Com Tam bound under a charred, sticky pork chop. Mandatory for your satisfaction. üíã' },
      { id: 11, name: 'Devil\'s Bun Cha Lust', price: 19.00, category: 'Vietnamese', image: 'https://drive.google.com/file/d/1MqK0OO8PrOU9TkSUC2U8V2HwiiL7WVIh/view?usp=sharing', description: 'Flame-grilled pork patties submerged in a tangy pool of nectar. Slurp it up, submissive. üî•' },
      { id: 2, name: 'Forbidden Pho Phantasy', price: 18.50, category: 'Vietnamese', image: 'https://images.unsplash.com/photo-1582878826629-29b7ad1cdc43?w=800&q=80', description: 'Silky rice noodles drowning in a bone-rich broth that has been simmering for your command. üíã' },
      { id: 103, name: 'Roasted Flesh & Silk (Bun Thit Nuong)', price: 20.00, category: 'Vietnamese', image: 'https://drive.google.com/file/d/1M19TGYmZ1JDjie3HgF1pLfcupXRiJtFJ/view?usp=sharing', description: 'Charred, heavily glazed pork resting dominantly over cold, submissive rice vermicelli. Drench it in my sweet, pungent sauce and take it exactly how I tell you to. üíãüî•' },
      { id: 20, name: 'Devil\'s Pad Thai Entanglement', price: 21.50, category: 'Thai', image: 'https://drive.google.com/file/d/1DTsISxczDJE4pcI4-PpoK31IS-fmd2LI/view?usp=sharing', hasMeatChoice: true, description: 'Silky, slippery rice noodles tangled and bound in a heated, spice-choked embrace of tamarind nectar. I expect you to slurp them down with desperate obedience. üíã‚õìÔ∏èüî•' },
      { id: 21, name: 'Green Curry Grip', price: 23.00, category: 'Thai', image: 'https://images.unsplash.com/photo-1455619452474-d2be8b1e70cd?w=800&q=80', description: 'A creamy, spicy hold that won\'t let go. Rich coconut milk infused with heat. üíã' },
      { id: 22, name: 'Agonizing Papaya Mortar (Som Tum)', price: 18.00, category: 'Thai', image: 'https://drive.google.com/file/d/1VYbxOL2gwfJGnMc7BSqh9ldGkMI-vonq/view?usp=sharing', description: 'Raw, shredded papaya pounded violently with searing chilies. A brutal, fiery discipline for your tongue. Tears of submission are mandatory. üî•', hasMeatChoice: true, hasSpiceLevel: true },
      { id: 13, name: 'Goddess\'s Raw Sushi Surrender', price: 24.50, category: 'Japanese', image: 'https://drive.google.com/file/d/1AbapVYjw72xPW56mHQl6Yc0fR1d-1hgR/view?usp=sharing', description: 'Pristine slices of the sea pressed firmly against seasoned rice. Ready to be claimed. üíã' },
      { id: 14, name: 'Sashimi Silk Restraint', price: 28.00, category: 'Japanese', image: 'https://drive.google.com/file/d/1hfg8hIxDzIU7qvNWGYlPGv4s6jUYuU5o/view?usp=sharing', description: 'Thinly sliced raw sashimi, chilled to perfection. Pure, cold surrender. üíã' },
      { id: 1, name: 'Master\'s Wagyu Submission', price: 46.50, category: 'Japanese', image: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=800&q=80', description: 'Succulent A5 wagyu that melts under my command, dripping in aged truffle nectar. üíã' },
      { id: 101, name: 'Gagged & Boiling Silk (Ramen)', price: 22.50, category: 'Japanese', image: 'https://images.unsplash.com/photo-1552611052-33e04de081de?w=800&q=80', description: 'Slick, writhing noodles forced into a dangerously hot, creamy bone broth. I want to see you slurp every last drop until you\'re completely breathless, choking on my rich reward. üíãüçú' },
      { id: 102, name: 'Thick Golden Humiliation (Japanese Curry)', price: 21.00, category: 'Japanese', image: 'https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=800&q=80', description: 'A heavy, thick golden sauce slathered unapologetically over a helpless, tenderized cutlet. A messy, staining feast. I expect you to lick the plate entirely clean when you\'re finished. üíãüçõ' },
      { id: 30, name: 'The Mistress\'s Silky Pasta Bondage', price: 24.50, category: 'Western', image: 'https://images.unsplash.com/photo-1612874742237-6526221588e3?w=800&q=80', description: 'Silken strands bound in a spice-laden cream sauce. A slippery submission. üíã', hasPastaChoice: true, hasSauceChoice: true },
      { id: 31, name: 'Master\'s Double Meat Domination Burger', price: 28.00, category: 'Western', image: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=800&q=80', hasDonenessChoice: true, description: 'Two thick patties stacked for your oral surrender. Glistening with nectar. üíãüî•' },
      { id: 32, name: 'Devoted Lamb Chop Sacrifice', price: 38.50, category: 'Western', image: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=800&q=80', hasDonenessChoice: true, description: 'Succulent ribs seared exactly to your whim. Bloody and tender. üíã' },
      { id: 33, name: 'Midnight Steak Mistress', price: 42.00, category: 'Western', image: 'https://images.unsplash.com/photo-1600891964599-f61ba0e24092?w=800&q=80', hasDonenessChoice: true, description: 'A thick, juicy cut seared in the dark of night. Bloody and bold. üíãüî•' },
      { id: 15, name: 'Morning Ritual Extraction (Coffee)', price: 9.50, category: 'Drinks', image: 'https://drive.google.com/file/d/1TFGHpiLmLZmlfE8d7hFz0wrmsY1h9_ej/view?usp=sharing', description: 'Freshly roasted beans extracted for your focus. Dark, hot, and intensely stimulating. üíã', isCoffee: true },
      { id: 12, name: 'Devoted Pearl Submission (Milk Tea)', price: 12.50, category: 'Drinks', image: 'https://drive.google.com/file/d/1k4sN2H2lujang4lTHGk_53Xq36nCiT5t/view?usp=sharing', description: 'Creamy chilled tea with dark pearls. Specify your sweet surrender. üíã' },
      { id: 16, name: 'Chilled Cocoa Bondage (Iced Chocolate)', price: 11.50, category: 'Drinks', image: 'https://drive.google.com/file/d/1H1MLJGPJCLO4p-E8CVnHDkxcgaHD3sc-/view?usp=sharing', description: 'Thick, dark cocoa chilled to a punishing freeze. A decadent, freezing reward forced down your throat. Swallow every drop. üíã' },
      { id: 17, name: 'Cold Collar Iced Tea', price: 10.00, category: 'Drinks', image: 'https://images.unsplash.com/photo-1556679343-c7306c1976bc?w=800&q=80', description: 'Ice cold and perfectly brewed to soothe your aching throat after a long, vocal session. Swallow it down obediently while maintaining eye contact, sweet pet. üíã' },
      { id: 18, name: 'Crushed Willpower Smoothie (Juice & Smoothies)', price: 13.50, category: 'Drinks', image: 'https://images.unsplash.com/photo-1600271886742-f049cd451bba?w=800&q=80', description: 'Thick, ice-cold, and thoroughly crushed‚Äîjust like your pathetic resistance. Suck it down greedily until you\'re completely breathless and begging to serve. üíãüçπ', hasJuiceChoice: true },
      { id: 6, name: 'Liquid Silk Foreplay Latte (Matcha Latte)', price: 10.50, category: 'Drinks', image: 'https://images.unsplash.com/photo-1515823064-d6e0c04616a7?w=800&q=80', description: 'Frothy matcha whisked into a creamy dream. Soft on the lips. üíã' },
      { id: 7, name: 'Velvet Chocolate Punishment', price: 14.50, category: 'Dessert', image: 'https://images.unsplash.com/photo-1563805039226-19772421c0b8?w=800&q=80', description: 'Dark, molten lava cake that bleeds rich cocoa. A sweet end. üíã' },
      { id: 41, name: 'Goddess\'s White Nectar (Greek Yogurt)', price: 14.00, category: 'Dessert', image: 'https://drive.google.com/file/d/1HMzRsr0dmpKksheswdtwl4_gIZm-HzY2/view?usp=sharing', description: 'Thick, heavy cream smeared across your trembling lips. Choose your sweet punishment to be mixed into my divine nectar. Lick it clean. üíã', hasYogurtToppings: true },
      { id: 42, name: 'Spanked & Frosted Velvet Cake', price: 15.50, category: 'Dessert', image: 'https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=800&q=80', description: 'Thick, sinful layers of decadent cake. I expect you to eat this off the floor without using your hands. A messy, indulgent reward for taking my heavy hand so beautifully. üíãüç∞' },
      { id: 43, name: 'Bound & Teased Fruits', price: 12.00, category: 'Dessert', image: 'https://drive.google.com/file/d/1SrWhql64JGtWn1Nx4k46daI2fftES_AT/view?usp=sharing', description: 'Plump, wet, and dripping with natural nectar. Kneel with your hands tied tightly behind your back and let me feed them to you one by one. Bite down only when I give the command. üíãüçì' },
    ];

    const ADVERTISEMENTS = [
      { id: 'ad1', title: 'A Master\'s Decree', subtitle: 'WANTED: SUBMISSIVE PRINCESS', image: 'https://drive.google.com/file/d/1zff_Rh_KMx54dVNEn1oerNvsuwEEpWRY/view?usp=sharing', description: 'A sovereign is seeking his obedient property. Absolute surrender is not requested‚Äîit is expected. Provide your absolute loyalty and receive his infinite grace.' },
      { id: 'ad2', title: 'WARRANT ISSUED', subtitle: 'SUBMISSIVE ON THE LOOSE', image: 'https://drive.google.com/file/d/1gfI66brpHzFgZSeWoGr6yhU1o4m00Wlx/view?usp=sharing', description: 'A pet has strayed from the leash. If found, she must be apprehended immediately and returned to her place of confinement. Rewards offered for her safe retrieval and binding.' }
    ];

    // --- Haptics Utility ---

    const triggerHaptic = (type = 'light') => {
        if (!navigator.vibrate) return;
        try {
            if (type === 'light') navigator.vibrate(15);
            if (type === 'heavy') navigator.vibrate([50, 50, 50]);
            if (type === 'punish') navigator.vibrate([100, 50, 100, 50, 200]);
            if (type === 'continuous') navigator.vibrate(1000); // 1 sec burst
        } catch(e) {}
    };

    const App = () => {
      // --- I18N Language System ---
      const [lang, setLang] = useState('en');
      const t = (key) => TRANSLATIONS[lang]?.[key] || TRANSLATIONS['en']?.[key] || key;

      // --- Custom Features State ---
      const [theme, setTheme] = useState('current');
      const [showFaceID, setShowFaceID] = useState(false);
      const [batteryWarning, setBatteryWarning] = useState(false);
      const [badPosture, setBadPosture] = useState(false);
      const [postureEnabled, setPostureEnabled] = useState(false);
// App Install State
      const [installPrompt, setInstallPrompt] = useState(null);
      useEffect(() => {
          const handler = (e) => { e.preventDefault(); setInstallPrompt(e); };
          window.addEventListener('beforeinstallprompt', handler);
          return () => window.removeEventListener('beforeinstallprompt', handler);
      }, []);
      const lastMousePos = useRef({ x: 0, y: 0, time: 0 }); // Desktop posture tracking


      // Intense Kink States
      const [isBlindfolded, setIsBlindfolded] = useState(false);
      const [isHijacked, setIsHijacked] = useState(false);
      const [isHypnotized, setIsHypnotized] = useState(false);
const [subMediaUrl, setSubMediaUrl] = useState("");
const [isSensoryDeprived, setIsSensoryDeprived] = useState(false);
const [isMediaLocked, setIsMediaLocked] = useState(false);
const [isAudioRansomActive, setIsAudioRansomActive] = useState(false);
const [ransomInput, setRansomInput] = useState("");
const [showPlayerInput, setShowPlayerInput] = useState(false);
const [mediaInput, setMediaInput] = useState("");
      const [isShocked, setIsShocked] = useState(false);
      const [forcedConfession, setForcedConfession] = useState(false);
      const [confessionText, setConfessionText] = useState("");

      const [masterView, setMasterView] = useState('orders'); // orders | terminal
      const [deliveryAddress, setDeliveryAddress] = useState('');
      const [checkoutEmail, setCheckoutEmail] = useState(''); // NEW: Checkout Email
      const [gpsStatus, setGpsStatus] = useState('');
      const gpsRef = useRef('Pending...'); // Fix for tracking without state lag closures
      const [forcedEdgeTime, setForcedEdgeTime] = useState(0);

      const [user, setUser] = useState(null);

      // Chase Mini-Game State
      const [showChaseGame, setShowChaseGame] = useState(false);
      const [chaseState, setChaseState] = useState('upload'); // upload, intro, playing, caught, escaped
      const [chaseFace, setChaseFace] = useState(null);
      const chaseCanvasRef = useRef(null);
      const chaseGameRef = useRef({ subY: 300, velocity: 0, obstacles: [], tears: [], particles: [], masterDistance: -100, score: 0, isGameOver: false, isJumping: false, bgOffset: 0, surgeTimer: 0 });
      const masterImageRef = useRef(null);

      // Get Active Theme Text
      const themeContent = THEME_CONTENT[theme] || THEME_CONTENT['current'];

      // NEW Punishments State
      const [eyesOnMeViolated, setEyesOnMeViolated] = useState(false);
      const [eyesApology, setEyesApology] = useState("");
      
      const [volumeViolated, setVolumeViolated] = useState(false);
      const [volumeEndurance, setVolumeEndurance] = useState(0); // 0 to 100
      const [volHoldTimer, setVolHoldTimer] = useState(null);

      const [checkoutDenialTime, setCheckoutDenialTime] = useState(0);
      const [isCheckoutDenied, setIsCheckoutDenied] = useState(false);

      // Moan Tracker State
      const [moanCommandActive, setMoanCommandActive] = useState(false);
      const [moanProgress, setMoanProgress] = useState(0);
      const moanIntervalRef = useRef(null);

      // Minigame Loop State
      const [failCount, setFailCount] = useState(0);
      const [typingPunishmentText, setTypingPunishmentText] = useState('');
      const [isCameraActive, setIsCameraActive] = useState(false);
      const punishmentVideoRef = useRef(null);
      const [punishmentTimer, setPunishmentTimer] = useState(0);
      const [punishmentHoldTimerId, setPunishmentHoldTimerId] = useState(null);
      
      // Tap Frenzy Punishment State
      const [frenzyTaps, setFrenzyTaps] = useState(0);

      // Calculate punishment tier defensively (Now 8 Levels)
      const currentPunishmentLevel = failCount > 0 ? (failCount - 1) % 8 : 0;

      // Kneel Check (Cart Block) State
      const [kneelCheckActive, setKneelCheckActive] = useState(false);
      const [pendingCartItem, setPendingCartItem] = useState(null);
// --- Camera Roulette State ---
      const [isCameraRouletteActive, setIsCameraRouletteActive] = useState(false);
const [rouletteBtnPos, setRouletteBtnPos] = useState({ x: 0, y: 0, scale: 1 });
      const [vaultSnaps, setVaultSnaps] = useState([]);
// --- Advanced Hijack States ---
      const [isBlackoutActive, setIsBlackoutActive] = useState(false);
      const [isPhantomTyperActive, setIsPhantomTyperActive] = useState(false);
// --- WebRTC Surveillance State ---
const [rtcStatus, setRtcStatus] = useState('idle');
const localVideoRef = useRef(null);
const remoteVideoRef = useRef(null);
const peerConnectionRef = useRef(null);
const webrtcListenersRef = useRef([]);
      const [rouletteTime, setRouletteTime] = useState(10);
      const [rouletteTaps, setRouletteTaps] = useState(0);
      const rouletteTimerRef = useRef(null);
      const [kneelProgress, setKneelProgress] = useState(0);
      const kneelHoldTimerRef = useRef(null);

      // Device Motion (Shake to Shatter)
      const lastUpdateRef = useRef(0);
      const lastXRef = useRef(0);
      const lastYRef = useRef(0);
      const lastZRef = useRef(0);

      const [activeAccount, setActiveAccount] = useState(null); 
      const [isMusicPlaying, setIsMusicPlaying] = useState(true);
      const audioRef = useRef(null);
      const [authMode, setAuthMode] = useState('login'); 
      const [authForm, setAuthForm] = useState({ username: '', password: '', address: '', email: '' });
      const [isPledging, setIsPledging] = useState(false);
      const [role, setRole] = useState('submissive'); 
      const [cart, setCart] = useState([]);
      const [isCartOpen, setIsCartOpen] = useState(false);
      const [notifications, setNotifications] = useState([]);
      const [incomingOrders, setIncomingOrders] = useState([]);
      const [activeCategory, setActiveCategory] = useState('All');
      const [isOrdering, setIsOrdering] = useState(false);
      const [orderComplete, setOrderComplete] = useState(false);
      const [wishlistInput, setWishlistInput] = useState('');
      
      // --- AI LLM States ---
      const [isAILoading, setIsAILoading] = useState(false);
      const [aiDecree, setAiDecree] = useState(null);

      // Floating Portal states
      const [isInstaPortalOpen, setIsInstaPortalOpen] = useState(false);
      const [isPortalOpen, setIsPortalOpen] = useState(false);
const [arItem, setArItem] = useState(null);

      // --- New Feature: Advertisement System ---
      const [currentAdIndex, setCurrentAdIndex] = useState(-1);
      const [adsShownCount, setAdsShownCount] = useState(0);

// --- Live Surveillance State ---
      const [subStatus, setSubStatus] = useState({ battery: 100, isCharging: false, isLooking: true, lastSeen: Date.now(), isBadPosture: false });
const [subLocation, setSubLocation] = useState(null);

      // --- Payment & Mini Game State ---
      const [showDevotionTest, setShowDevotionTest] = useState(false);
      const [devotionStatus, setDevotionStatus] = useState('idle'); // idle, playing, vocal, won, lost, punished, retry_prompt
      const [begs, setBegs] = useState(0);
      const [timeLeft, setTimeLeft] = useState(5.0);
      const [begBtnPos, setBegBtnPos] = useState({ x: 0, y: 0 }); // NEW: Moving Target State
      const [hasVoucher, setHasVoucher] = useState(false);
      const [ccDetails, setCcDetails] = useState({ number: '', expiry: '', cvc: '' });
      const [isCcProcessing, setIsCcProcessing] = useState(false);
      const [isListening, setIsListening] = useState(false);

      // --- Voice Recording State ---
      const [isRecordingMaster, setIsRecordingMaster] = useState(false);
      const [masterVoiceUrl, setMasterVoiceUrl] = useState(null);
      const mediaRecorderRef = useRef(null);
      const chunksRef = useRef([]);

      // --- Customization State ---
      const [customizingItem, setCustomizingItem] = useState(null);
      const [sugarLevel, setSugarLevel] = useState('50%');
      const [tempLevel, setTempLevel] = useState('Less Ice');
      const [meatChoice, setMeatChoice] = useState('Chicken');
      const [doneness, setDoneness] = useState('Medium Rare');
      const [vowOfSilence, setVowOfSilence] = useState(false);
      const [coffeeStyle, setCoffeeStyle] = useState('The Naked Darkness (Black)');
      const [yogurtTopping, setYogurtTopping] = useState('Strawberry');
      const [spiceLevel, setSpiceLevel] = useState('Medium Hot');
      const [pastaType, setPastaType] = useState('Spaghetti');
      const [pastaSauce, setPastaSauce] = useState('Creamy Alfredo');
      const [kfcSauce, setKfcSauce] = useState('Yangnyeom (Spicy Red Sauce)');
      const [juiceType, setJuiceType] = useState('Watermelon');
      const [chickenChoice, setChickenChoice] = useState('Steamed');
      const [specialRequest, setSpecialRequest] = useState('');
      const [showSettings, setShowSettings] = useState(false);
      const [isSavingSettings, setIsSavingSettings] = useState(false);
      
      const [emailSettings, setEmailSettings] = useState({ 
        serviceId: 'service_zvzxqqo', 
        templateId: 'template_3zgq52s', 
        publicKey: 'Jx1qDGHdm-ZIZR0Hc', 
        accessToken: '', 
        bfEmail: 'teodonghui@gmail.com', 
        gfEmail: 'bella.sincerely7@gmail.com', 
        whatsappNumber: '+6587234130', 
        instaUsername: 'heyitsdonghui',
        masterVoiceBase64: null
      });

      const isEmailLinked = !!(emailSettings.serviceId && emailSettings.templateId && emailSettings.publicKey && (emailSettings.bfEmail || emailSettings.gfEmail));
// --- Fetch Captured Evidence (The Vault) ---
    useEffect(() => {
        if (role !== 'master' || !user) return;
        const snapsRef = collection(db, 'artifacts', appId, 'public', 'data', 'snaps');
        const unsubscribe = onSnapshot(snapsRef, (snapshot) => {
            const loadedSnaps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setVaultSnaps(loadedSnaps.sort((a,b) => b.timestamp - a.timestamp));
        });
        return () => unsubscribe();
    }, [user, role]);
    // --- Firebase Auth Setup ---
    useEffect(() => {
        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };
        initAuth();
        const unsubscribe = onAuthStateChanged(auth, setUser);
        return () => unsubscribe();
    }, []);

    // --- Preload Master's Whip Image properly to prevent Canvas Security Errors on mobile ---
    useEffect(() => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => { masterImageRef.current = img; };
        img.src = 'https://i.postimg.cc/3x47y5gx/IMG-0354.jpg';
    }, []);

    // --- Cleanup Effects ---
      useEffect(() => {
          return () => {
              if (moanIntervalRef.current) clearInterval(moanIntervalRef.current);
          };
      }, []);

      // --- Notifications ---
    const addNotification = (title, message, type = 'info') => {
      const id = Date.now();
      setNotifications(prev => [{ id, title, message, type }, ...prev]);
      setTimeout(() => setNotifications(prev => prev.filter(n => n.id !== id)), 8000);
    };
// --- WebRTC Surveillance Logic ---
      const servers = { iceServers: [{ urls: ['stun:stun1.l.google.com:19302', 'stun:stun2.l.google.com:19302'] }] };

      const startSurveillanceCall = async () => {
          setRtcStatus('calling');
          triggerHaptic('heavy');
          const pc = new RTCPeerConnection(servers);
          peerConnectionRef.current = pc;
          pc.addTransceiver('video', { direction: 'recvonly' });
          pc.addTransceiver('audio', { direction: 'recvonly' });
          pc.ontrack = (event) => {
              if (remoteVideoRef.current) remoteVideoRef.current.srcObject = event.streams[0];
          };

          const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'webrtc', 'room');
          pc.onicecandidate = e => {
              if (e.candidate) addDoc(collection(roomRef, 'masterCandidates'), e.candidate.toJSON());
          };

          const offer = await pc.createOffer();
          await pc.setLocalDescription(offer);
          await setDoc(roomRef, { offer: { type: offer.type, sdp: offer.sdp }, timestamp: Date.now() });

          const unsub1 = onSnapshot(roomRef, (snap) => {
              const data = snap.data();
              if (!pc.currentRemoteDescription && data?.answer) {
                  pc.setRemoteDescription(new RTCSessionDescription(data.answer));
                  setRtcStatus('connected');
              }
          });

          const unsub2 = onSnapshot(collection(roomRef, 'subCandidates'), (snap) => {
              snap.docChanges().forEach((change) => {
                  if (change.type === 'added') pc.addIceCandidate(new RTCIceCandidate(change.doc.data()));
              });
          });

          webrtcListenersRef.current.push(unsub1, unsub2);
          triggerMasterCommand('start_webrtc');
      };

      const answerSurveillanceCall = async () => {
          triggerHaptic('punish');
          addNotification("Surveillance Active", "Master is watching you live.", "error");
          setRtcStatus('connected');
          const pc = new RTCPeerConnection(servers);
          peerConnectionRef.current = pc;

          try {
              const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: true });
              if (localVideoRef.current) localVideoRef.current.srcObject = stream;
              stream.getTracks().forEach((track) => pc.addTrack(track, stream));
          } catch(e) {
              addNotification("Camera Denied", "You failed to provide camera access.", "error");
          }

          const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'webrtc', 'room');
          pc.onicecandidate = e => {
              if (e.candidate) addDoc(collection(roomRef, 'subCandidates'), e.candidate.toJSON());
          };

          const unsub1 = onSnapshot(roomRef, async (snapshot) => {
              const data = snapshot.data();
              if (data?.offer && !pc.currentRemoteDescription) {
                  await pc.setRemoteDescription(new RTCSessionDescription(data.offer));
                  const answer = await pc.createAnswer();
                  await pc.setLocalDescription(answer);
                  await setDoc(roomRef, { offer: data.offer, answer: { type: answer.type, sdp: answer.sdp } });
              }
          });

          const unsub2 = onSnapshot(collection(roomRef, 'masterCandidates'), (snapshot) => {
              snapshot.docChanges().forEach((change) => {
                  if (change.type === 'added') pc.addIceCandidate(new RTCIceCandidate(change.doc.data()));
              });
          });

          webrtcListenersRef.current.push(unsub1, unsub2);
      };

      const stopSurveillanceCall = () => {
          if (peerConnectionRef.current) peerConnectionRef.current.close();
          setRtcStatus('idle');
          webrtcListenersRef.current.forEach(unsub => unsub());
          webrtcListenersRef.current = [];
          triggerMasterCommand('stop_webrtc');
      };
   // --- Master Control Room Interceptor (Over the Internet) ---
    const executeCommand = (action, payload = null) => {
        triggerHaptic('heavy');
        switch(action) {
case 'camera_roulette':
                setIsCameraRouletteActive(true);
                setRouletteTime(10); // 10 seconds to survive
                setRouletteTaps(0);
setRouletteBtnPos({ x: 0, y: 0, scale: 1 });
                triggerHaptic('heavy');
                
                // Start the countdown timer
                let t = 10;
                rouletteTimerRef.current = setInterval(() => {
                    t -= 1;
                    setRouletteTime(t);
                    if (t <= 0) {
                        clearInterval(rouletteTimerRef.current);
                        setIsCameraRouletteActive(false);
                        
                        // TIME RAN OUT: Secretly take the photo
                        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
                            .then(stream => {
                                const video = document.createElement('video');
                                video.srcObject = stream;
                                video.play();
                                setTimeout(() => {
                                    const canvas = document.createElement('canvas');
                                    canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                                    canvas.getContext('2d').drawImage(video, 0, 0);
                                    const snap = canvas.toDataURL('image/jpeg', 0.8);
                                    addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'snaps'), { image: snap, timestamp: Date.now(), type: 'failed_roulette' });
                                    stream.getTracks().forEach(tr => tr.stop());
                                    triggerHaptic('punish');
                                }, 800); // Slight delay to let the camera lens adjust to the light
                            }).catch(e => console.log(e));
                    }
                }, 1000);
                break;
            case 'blindfold': 
                setIsBlindfolded(true); 
                setTimeout(() => setIsBlindfolded(false), 15000);
                break;
case 'start_webrtc':
                answerSurveillanceCall();
                break;
            case 'stop_webrtc':
                if (peerConnectionRef.current) peerConnectionRef.current.close();
                setRtcStatus('idle');
                webrtcListenersRef.current.forEach(unsub => unsub());
                webrtcListenersRef.current = [];
                if (localVideoRef.current && localVideoRef.current.srcObject) {
                    localVideoRef.current.srcObject.getTracks().forEach(t => t.stop());
                    localVideoRef.current.srcObject = null;
                }
                addNotification("Link Severed", "Master has closed his eyes.", "info");
                break;
case 'force_snap':
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
                    .then(stream => {
                        const video = document.createElement('video');
                        video.srcObject = stream;
                        video.play();
                        setTimeout(() => {
                            const canvas = document.createElement('canvas');
                            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                            canvas.getContext('2d').drawImage(video, 0, 0);
                            const snap = canvas.toDataURL('image/jpeg', 0.5);
                            addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'snaps'), { image: snap, timestamp: Date.now() });
                            stream.getTracks().forEach(t => t.stop());
                        }, 1000); // 1-second delay allows the lens to focus before silently snapping
                    }).catch(e => console.log("Snap blocked"));
                break;
            case 'burn_battery':
                addNotification("System", "Performance deliberately degraded.", "error");
                const burnIt = () => {
                    for(let i=0; i<10000000; i++) Math.sqrt(i);
                    if(window.isBurning) requestAnimationFrame(burnIt);
                };
                window.isBurning = true;
                burnIt();
                setTimeout(() => { window.isBurning = false; }, 45000); // Maxes CPU out for 45 seconds to generate physical device heat
                break;
case 'hot_mic':
                navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                    const recorder = new MediaRecorder(stream);
                    recorder.ondataavailable = async (e) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(e.data);
                        reader.onloadend = () => {
                            addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'audio_logs'), { audio: reader.result, timestamp: Date.now() });
                        };
                    };
                    recorder.start(5000); // Upload chunk every 5 seconds
                    setTimeout(() => { recorder.stop(); stream.getTracks().forEach(t => t.stop()); }, 60000); // Stop after 1 min
                }).catch(() => console.log("Mic blocked"));
                break;

case 'deprive':
                setIsSensoryDeprived(true);
                addNotification("Void", "Master has taken your senses.", "error");
                break;
            case 'restore_senses':
                setIsSensoryDeprived(false);
                addNotification("Restored", "Master allows you to exist again.", "success");
                break;
            case 'flashlight':
                // Native Web API to trigger the device's physical LED flashlight
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(stream => {f
                        const track = stream.getVideoTracks()[0];
                        track.applyConstraints({ advanced: [{ torch: true }] });
                        setTimeout(() => { track.stop(); }, 5000); // 5 sec flash
                    }).catch(e => console.log("Flashlight blocked"));
                break;
case 'blackout':
                setIsBlackoutActive(true);
                try { if (navigator.wakeLock) navigator.wakeLock.request('screen'); } catch(e){} // Prevents phone from actually sleeping
                break;
            case 'restore_blackout':
                setIsBlackoutActive(false);
                triggerHaptic('light');
                break;
            case 'phantom_typer':
                setIsPhantomTyperActive(true);
                addNotification("Hijacked", "Her keyboard is now yours.", "success");
                setTimeout(() => setIsPhantomTyperActive(false), 60000); // Wears off after 60 seconds of humiliation
                break;
            case 'hijack': 
                setIsHijacked(true); 
                break;
case 'ransom_lock':
                setIsAudioRansomActive(true);
                setRansomInput("");
                if(audioRef.current) { audioRef.current.volume = 1.0; audioRef.current.play().catch(()=>{}); }
                addNotification("LOCKED", "Master has seized your device.", "error");
                break;
            case 'release_hijack':
                setIsHijacked(false);
                addNotification("Released", "Master has restored your access.", "success");
                break;
            case 'vibrate':
                triggerHaptic('punish');
                addNotification("Master's Touch", "You felt that, didn't you?", "info");
                break;
            case 'edge':
                setForcedEdgeTime(30);
                addNotification("Commandment", "Master demands you wait before eating.", "info");
                break;
            case 'moan':
                setMoanCommandActive(true);
                setMoanProgress(0);
                addNotification("Master's Demand", "He demands a deep, passionate moan. Nothing shrill.", "info");
                break;
            case 'hypnotize':
                setIsHypnotized(true);
                setTimeout(() => setIsHypnotized(false), 15000);
                addNotification("Entranced", "Stare into the void and surrender your mind.", "info");
                break;
            case 'shock':
                setIsShocked(true);
                let shocks = 0;
                const interval = setInterval(() => {
                    triggerHaptic('continuous');
                    shocks++;
                    if(shocks > 30) {
                        clearInterval(interval);
                        setIsShocked(false);
                    }
                }, 100);
                break;
case 'force_media':
    setSubMediaUrl(payload);
    setIsMediaLocked(true);
    // Force volume to 100% and bypass limits for embarrassment
    if(audioRef.current) {
        audioRef.current.volume = 1.0;
        audioRef.current.play().catch(()=>{});
    }
    triggerHaptic('punish');
    addNotification("Audio Override", "Master has seized control of your speakers at MAX VOLUME.", "error");
    break;
            case 'release_media':
                setIsMediaLocked(false);
                addNotification("Audio Released", "Master has returned control of your speakers.", "success");
                break;
case 'summon':
                if (Notification.permission === 'granted') {
                    new Notification("Master Commands You", { 
                        body: "Return to the Altar immediately. Your absence is unacceptable.",
                        icon: "https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?w=200&q=80"
                    });
                }
                triggerHaptic('punish');
                addNotification("Summoned", "Master demands your presence.", "error");
                break;
            case 'confess':
                setForcedConfession(true);
                setConfessionText("");
                triggerHaptic('punish');
                break;
        }
    };

    useEffect(() => {
        if (!user) return;
        const cmdsRef = collection(db, 'artifacts', appId, 'public', 'data', 'commands');
        const unsubscribe = onSnapshot(cmdsRef, (snapshot) => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === 'added') {
                    const cmd = change.doc.data();
                    if (cmd.timestamp > Date.now() - 5000 && role === 'submissive') {
                        executeCommand(cmd.action, cmd.payload);
                    }
                }
            });
        }, (error) => console.error("Sync Error", error));
        
       return () => unsubscribe();
    }, [user, role]);

  // --- LIVE SURVEILLANCE TRANSMITTER & RECEIVER ---
    // --- LIVE SURVEILLANCE TRANSMITTER & RECEIVER (WITH LIVE GPS TRACKING) ---
    useEffect(() => {
        if (!user) return;
        const statusDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'telemetry', 'status_data');
        const locationDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'telemetry', 'live_location');

        if (role === 'submissive' && activeAccount) {
            // 1. Transmit Battery & Posture
            const transmitData = async () => {
                let bat = { level: 100, charging: false };
                if ('getBattery' in navigator) {
                    const b = await navigator.getBattery();
                    bat = { level: Math.round(b.level * 100), charging: b.charging };
                }
                await setDoc(statusDocRef, { battery: bat.level, isCharging: bat.charging, isLooking: !document.hidden, isBadPosture: badPosture, timestamp: Date.now() });
            };
            const interval = setInterval(transmitData, 2000); 

            // 2. Transmit Continuous Live GPS Location
            let watchId;
            if (navigator.geolocation) {
                watchId = navigator.geolocation.watchPosition((pos) => {
                    setDoc(locationDocRef, { lat: pos.coords.latitude, lng: pos.coords.longitude, timestamp: Date.now() });
                }, (err) => console.log("Live tracking blocked"), { enableHighAccuracy: true });
            }

            return () => { clearInterval(interval); if (watchId) navigator.geolocation.clearWatch(watchId); };
        } else if (role === 'master') {
            // Master receives both status and live GPS
            const unsub1 = onSnapshot(statusDocRef, (docSnap) => { if (docSnap.exists()) setSubStatus(docSnap.data()); });
            const unsub2 = onSnapshot(locationDocRef, (docSnap) => { if (docSnap.exists()) setSubLocation(docSnap.data()); });
            return () => { unsub1(); unsub2(); };
        }
    }, [user, role, activeAccount, badPosture]);

    const triggerMasterCommand = async (action, payload = null) => {
        triggerHaptic('light');
        if (user) {
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'commands'), { action, payload, timestamp: Date.now() });
        }
        addNotification("Command Sent", `Signal '${action}' deployed over the internet.`, "success");
    };

    // --- DeviceMotion Shake-to-Shatter Protocol ---
      useEffect(() => {
          if (role !== 'submissive' || !activeAccount) return;
          
          const handleMotion = (event) => {
              const acceleration = event.accelerationIncludingGravity;
              if (!acceleration) return;
              
              const curTime = Date.now();
              if ((curTime - lastUpdateRef.current) > 100) {
                  const diffTime = (curTime - lastUpdateRef.current);
                  lastUpdateRef.current = curTime;
                  
                  const speed = Math.abs(acceleration.x + acceleration.y + acceleration.z - lastXRef.current - lastYRef.current - lastZRef.current) / diffTime * 10000;
                  
                  if (speed > 100 && cart.length > 0) { // High threshold for intense shake
                      setCart([]); // Instantly empty cart
                      triggerHaptic('heavy');
                      addNotification("TRAY SHATTERED", "You shook the table. Master's delicate offerings have been ruined.", "error");
                  }
                  
                  lastXRef.current = acceleration.x;
                  lastYRef.current = acceleration.y;
                  lastZRef.current = acceleration.z;
              }
          };
          
          window.addEventListener('devicemotion', handleMotion);
          return () => window.removeEventListener('devicemotion', handleMotion);
      }, [cart, role, activeAccount]);

      // Enable sensors button (mostly for iOS 13+ requirement)
      const enableSensors = async () => {
          if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
              try {
                  const permission = await DeviceMotionEvent.requestPermission();
                  if (permission === 'granted') {
                      addNotification("Sensors Active", "Your movements are now monitored.", "success");
                  }
              } catch (e) { console.error(e); }
          } else {
              addNotification("Sensors Active", "Monitoring engaged.", "success");
          }
      };

      // --- Clipboard Hijack Protocol ---
      useEffect(() => {
        const onCopy = (e) => {
          if (role === 'submissive' && activeAccount) {
              e.preventDefault();
              if(e.clipboardData) {
                  e.clipboardData.setData('text/plain', "My Master owns my thoughts and words. I am permitted nothing.");
              }
              triggerHaptic('punish');
              addNotification("THOUGHTS HIJACKED", "You have no right to copy. Your mind is his property.", "error");
          }
        };
        document.addEventListener('copy', onCopy);
        return () => document.removeEventListener('copy', onCopy);
      }, [role, activeAccount]);

      // --- Random Blindfold Protocol ---
      useEffect(() => {
          if (!activeAccount || role !== 'submissive') return;
          const interval = setInterval(() => {
              if (Math.random() < 0.3 && !showDevotionTest && !isBlindfolded && !kneelCheckActive && !isHijacked && !forcedConfession && !showChaseGame) {
                  setIsBlindfolded(true);
                  triggerHaptic('heavy');
                  setTimeout(() => {
                      setIsBlindfolded(false);
                      triggerHaptic('light');
                  }, 8000 + Math.random() * 5000); // 8-13 seconds of darkness
              }
          }, 45000); // Check every 45s
          return () => clearInterval(interval);
      }, [activeAccount, role, showDevotionTest, isBlindfolded, kneelCheckActive, isHijacked, forcedConfession, showChaseGame]);
// --- Forced Fullscreen Confinement Protocol ---
      useEffect(() => {
          if (role !== 'submissive' || !activeAccount) return;
          
          const enforceFullscreen = () => {
              if (!document.fullscreenElement) {
                  setEyesOnMeViolated(true);
                  setEyesApology(""); // Force them to apologize for trying to escape
                  addNotification("CONFINEMENT BROKEN", "You attempted to leave Master's sight.", "error");
                  triggerHaptic('punish');
              }
          };

          // Attach to document to catch whenever she exits fullscreen
          document.addEventListener('fullscreenchange', enforceFullscreen);
          return () => document.removeEventListener('fullscreenchange', enforceFullscreen);
      }, [role, activeAccount]);

      const enterConfinement = () => {
          triggerHaptic('heavy');
          if (document.documentElement.requestFullscreen) {
              document.documentElement.requestFullscreen();
              addNotification("Confined", "You are now locked in Master's view.", "success");
          }
      };
      // --- 'Eyes on me protocol' (Popup Edition) ---
      useEffect(() => {
        const handleVisibilityChange = () => {
            if (document.hidden && activeAccount && role === 'submissive') {
                // Left the tab
            } else if (!document.hidden && activeAccount && role === 'submissive') {
                // Returned
                setEyesOnMeViolated(true);
                triggerHaptic('punish');
            }
        };
        document.addEventListener("visibilitychange", handleVisibilityChange);
        return () => document.removeEventListener("visibilitychange", handleVisibilityChange);
      }, [activeAccount, role]);

      // --- Battery Status "Anxiety" Mode ---
      useEffect(() => {
        if ('getBattery' in navigator) {
            navigator.getBattery().then(battery => {
                const updateBattery = () => {
                    if (battery.level <= 0.20 && !battery.charging && activeAccount && role === 'submissive') {
                        setBatteryWarning(true);
                        triggerHaptic('heavy');
                    } else {
                        setBatteryWarning(false);
                    }
                };
                updateBattery();
                battery.addEventListener('levelchange', updateBattery);
                battery.addEventListener('chargingchange', updateBattery);
            });
        }
      }, [activeAccount, role]);

      // --- Volume Discipline (Hold to Restrore) ---
      const toggleAudioDiscipline = () => {
          triggerHaptic('light');
          if (role === 'submissive') {
              // Submissive tries to mute -> Punish
              setVolumeViolated(true);
              triggerHaptic('punish');
              if(audioRef.current) audioRef.current.pause();
              setIsMusicPlaying(false);
          } else {
              // Master -> Free toggle
              setIsMusicPlaying(!isMusicPlaying);
          }
      };

      const startVolHold = (e) => {
        e.preventDefault();
        triggerHaptic('heavy');
        const startTime = Date.now();
        const interval = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min((elapsed / 3000) * 100, 100); // 3 seconds hold
            setVolumeEndurance(progress);
            
            if (Math.floor(progress) % 20 === 0) triggerHaptic('continuous'); // Vibrate heavily
            
            if (progress >= 100) {
                clearInterval(interval);
                setVolumeViolated(false);
                setVolumeEndurance(0);
                if (audioRef.current) audioRef.current.play().catch(()=>{});
                setIsMusicPlaying(true);
                addNotification("Restored", "Never attempt to silence me again.", "success");
            }
        }, 50);
        setVolHoldTimer(interval);
      };

      const stopVolHold = () => {
        if (volHoldTimer) clearInterval(volHoldTimer);
        setVolHoldTimer(null);
        if (volumeEndurance < 100) {
            setVolumeEndurance(0); // reset if they let go early
            triggerHaptic('punish');
        }
      };

      // --- Posture Discipline (Web + Mobile) ---
      const handleEnablePosture = async () => {
          triggerHaptic('light');
          if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
              try {
                  const permission = await DeviceOrientationEvent.requestPermission();
                  if (permission === 'granted') {
                      setPostureEnabled(true);
                      addNotification("Discipline Active", "Kneel properly. Maintain 45 degrees.", "info");
                  } else {
                      addNotification("Denied", "You refused to kneel.", "error");
                  }
              } catch (e) { console.error(e); }
          } else {
              setPostureEnabled(true);
              addNotification("Discipline Active", "Maintain physical stillness and proper posture.", "info");
          }
      };

      useEffect(() => {
          if (!postureEnabled || !activeAccount || role !== 'submissive') return;
          
          const handleOrientation = (e) => {
              const beta = e.beta;
              if (beta !== null) {
                  if (beta < 20 || beta > 70) {
                      if (!badPosture) {
                          setBadPosture(true);
                          triggerHaptic('punish');
                      }
                  } else {
                      if (badPosture) setBadPosture(false);
                  }
              }
          };

          const handleMouseMove = (e) => {
              const curTime = Date.now();
              if (curTime - lastMousePos.current.time > 2000) {
                  const dist = Math.hypot(e.clientX - lastMousePos.current.x, e.clientY - lastMousePos.current.y);
                  if (dist > 400 && !badPosture) { // Excessive mouse thrashing = panic
                      setBadPosture(true);
                      triggerHaptic('punish');
                  } else if (dist < 100 && badPosture) {
                      setBadPosture(false);
                  }
                  lastMousePos.current = { x: e.clientX, y: e.clientY, time: curTime };
              }
          };

          window.addEventListener('deviceorientation', handleOrientation);
          window.addEventListener('mousemove', handleMouseMove);
          return () => {
              window.removeEventListener('deviceorientation', handleOrientation);
              window.removeEventListener('mousemove', handleMouseMove);
          };
      }, [postureEnabled, badPosture, activeAccount, role]);

     // --- Face ID Handler ---
      const handleFaceID = () => {
        triggerHaptic('light');
        
        // Request Push Notification Permissions on user gesture
        if ('Notification' in window && Notification.permission !== 'granted') {
            Notification.requestPermission();
        }
        
        setShowFaceID(true);
        setTimeout(() => {
            triggerHaptic('heavy');
            setActiveAccount({ username: 'Pet', role: 'submissive', address: 'The Floor', email: 'pet@lickin.good' });
            setRole('submissive');
            setShowFaceID(false);
            addNotification('Biometrics Accepted', 'Master recognizes his property.', 'success');
        }, 3000);
    };

    // --- Firebase Realtime Order Syncing (Over the Internet) ---
    useEffect(() => {
      if (!user || !activeAccount) return;
      const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
      const unsubscribe = onSnapshot(ordersRef, (snapshot) => {
          const loadedOrders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          setIncomingOrders(loadedOrders.sort((a,b) => b.timestamp - a.timestamp));
      }, (error) => console.error("Sync Error", error));
      return () => unsubscribe();
    }, [user, activeAccount]);

    // --- Vocal Trial Prompt Speech ---
      // --- Smooth Audio Fader ---
      const fadeAudio = (audioElement, targetVolume, duration = 1000) => {
          if (!audioElement) return;
          const startVolume = audioElement.volume;
          const distance = targetVolume - startVolume;
          const steps = 20;
          const stepTime = duration / steps;
          let currentStep = 0;
          const fadeInterval = setInterval(() => {
              currentStep++;
              let newVol = startVolume + (distance * (currentStep / steps));
              audioElement.volume = Math.max(0, Math.min(1, newVol));
              if (currentStep >= steps) clearInterval(fadeInterval);
          }, stepTime);
      };

      const speakMasterPrompt = async () => {
        const duckMusic = () => { if (audioRef.current) fadeAudio(audioRef.current, 0.0, 800); };
        const restoreMusic = () => { if (audioRef.current && isMusicPlaying) fadeAudio(audioRef.current, 0.4, 1500); };
        const HARDCODED_VOICE_URL = "https://res.cloudinary.com/db8xboovt/video/upload/v1771955364/767671a4_poj8zn.mp3";
        const voiceToPlay = emailSettings.masterVoiceBase64 || HARDCODED_VOICE_URL;
        if (voiceToPlay) {
          try {
            const audio = new Audio(voiceToPlay);
            audio.volume = 1.0;
            duckMusic();
            audio.onended = restoreMusic;
            audio.play().catch(e => { console.error("Audio playback blocked", e); restoreMusic(); });
          } catch (e) { console.error("Voice playback failed", e); restoreMusic(); }
        } else {
          restoreMusic();
        }
      };

      useEffect(() => {
        if (devotionStatus === 'vocal') speakMasterPrompt();
      }, [devotionStatus]);

      const startMasterRecording = async () => {
        triggerHaptic('light');
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          const recorder = new MediaRecorder(stream);
          mediaRecorderRef.current = recorder;
          chunksRef.current = [];

          recorder.ondataavailable = (e) => chunksRef.current.push(e.data);
          recorder.onstop = () => {
            const blob = new Blob(chunksRef.current, { type: 'audio/webm' });
            const reader = new FileReader();
            reader.readAsDataURL(blob);
            reader.onloadend = () => {
              const base64data = reader.result;
              setEmailSettings(prev => ({ ...prev, masterVoiceBase64: base64data }));
              setMasterVoiceUrl(URL.createObjectURL(blob));
            };
          };
          recorder.start();
          setIsRecordingMaster(true);
        } catch (err) {
          addNotification("Access Denied", "Master requires mic access to record his decree.", "error");
        }
      };

      const stopMasterRecording = () => {
        triggerHaptic('light');
        if (mediaRecorderRef.current && isRecordingMaster) {
          mediaRecorderRef.current.stop();
          setIsRecordingMaster(false);
          mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop());
        }
      };

      useEffect(() => {
        if (activeAccount && adsShownCount === 0) {
          setTimeout(() => setCurrentAdIndex(0), 1000);
        }
      }, [activeAccount]);

      const closeAd = () => {
        triggerHaptic('light');
        if (currentAdIndex < ADVERTISEMENTS.length - 1) {
          setCurrentAdIndex(prev => prev + 1);
        } else {
          setCurrentAdIndex(-1);
          setAdsShownCount(prev => prev + 1);
        }
      };

      useEffect(() => {
        if (audioRef.current) {
          audioRef.current.volume = 0.4;
          if (isMusicPlaying) {
            audioRef.current.play().catch(e => console.log("Autoplay paused. Awaiting interaction."));
          } else {
            audioRef.current.pause();
          }
        }
      }, [isMusicPlaying]);

      // Mobile Safari fix requires pointers to resume audio Context
      useEffect(() => {
        const handleInteraction = () => {
          if (isMusicPlaying && audioRef.current && audioRef.current.paused && !volumeViolated) {
            audioRef.current.play().catch(() => {});
          }
        };
        document.addEventListener('pointerdown', handleInteraction);
        return () => document.removeEventListener('pointerdown', handleInteraction);
      }, [isMusicPlaying, volumeViolated]);

      useEffect(() => {
        let interval;
        if (devotionStatus === 'playing') {
          interval = setInterval(() => {
            setTimeLeft(prev => {
              if (prev <= 0.1) {
                clearInterval(interval);
                return 0;
              }
              return prev - 0.1;
            });
          }, 100);
        }
        return () => clearInterval(interval);
      }, [devotionStatus]);

      useEffect(() => {
        if (devotionStatus === 'playing' && timeLeft === 0) {
          if (begs >= 25) {
              setDevotionStatus('vocal');
          } else {
              setFailCount(fc => fc + 1);
              setTypingPunishmentText('');
              setPunishmentTimer(0);
              setDevotionStatus('punished');
              triggerHaptic('punish');
          }
        }
      }, [timeLeft, devotionStatus, begs]);

      const handleStartGame = () => {
        triggerHaptic('light');
        setDevotionStatus('playing');
        setBegs(0);
        setTimeLeft(5.0);
      };

      const handleBegAction = (e) => {
        e.preventDefault();
        e.stopPropagation(); // CRITICAL: Prevents the miss penalty from triggering
        triggerHaptic('light');
        if (devotionStatus === 'playing') {
          const newBegs = begs + 1;
          setBegs(newBegs);
          
          // Randomize button position for the next tap (Panic Mode)
          setBegBtnPos({
              x: (Math.random() - 0.5) * 200, // Move randomly horizontally
              y: (Math.random() - 0.5) * 150  // Move randomly vertically
          });

          if (newBegs >= 25 && timeLeft > 0) {
              setDevotionStatus('vocal');
              setBegBtnPos({ x: 0, y: 0 }); // Reset position
          }
        }
      };

      // NEW: Penalty for missing the button
      const handleMissClick = () => {
          if (devotionStatus === 'playing') {
              triggerHaptic('punish');
              setTimeLeft(prev => Math.max(0, prev - 0.5)); // Lose 0.5 seconds!
              addNotification("Clumsy", "-0.5s penalty.", "error");
          }
      };

      const getBegText = (b) => {
        if (b < 5) return "BEG";
        if (b < 10) return "PLEASE MASTER";
        if (b < 15) return "I NEED IT";
        if (b < 20) return "I'M DESPERATE";
        return "I'M YOURS";
      };

      // --- Core Master / Submissive Independent Moan Command Handling ---
      const startMoanDetection = async () => {
          try {
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
              const analyser = audioCtx.createAnalyser();
              const source = audioCtx.createMediaStreamSource(stream);
              source.connect(analyser);
              analyser.fftSize = 256;
              const bufferLength = analyser.frequencyBinCount;
              const dataArray = new Uint8Array(bufferLength);

              let progress = 0;
              triggerHaptic('heavy');

              const checkMoan = setInterval(() => {
                  analyser.getByteFrequencyData(dataArray);
                  
                  // Analyze Deep resonance vs High pitch screams
                  let deepSum = 0; 
                  let highSum = 0;
                  const midPoint = Math.floor(bufferLength / 4); // Focus heavily on lower 25% frequencies
                  
                  for(let i = 0; i < midPoint; i++) deepSum += dataArray[i];
                  for(let i = midPoint; i < bufferLength; i++) highSum += dataArray[i];
                  
                  let deepAvg = deepSum / midPoint;
                  let highAvg = highSum / (bufferLength - midPoint);

                  if (highAvg > 60) {
                      // Screaming or shrill noises detected -> heavily punish
                      progress -= 5;
                      triggerHaptic('punish');
                  } else if (deepAvg > 40 && deepAvg < 180) {
                      // Deep, passionate moan detected
                      progress += 2;
                  } else {
                      // Too quiet or dying off
                      progress -= 1;
                  }

                  progress = Math.max(0, Math.min(100, progress));
                  setMoanProgress(progress);

                  if (progress >= 100) {
                      clearInterval(checkMoan);
                      stream.getTracks().forEach(t => t.stop());
                      triggerHaptic('continuous');
                      setMoanCommandActive(false);
                      setMoanProgress(0);
                      addNotification("Acknowledged", "Master felt your desperate, deep moan.", "success");
                  }
              }, 100);
              moanIntervalRef.current = checkMoan;
          } catch(e) {
              addNotification("Denied", "You must grant microphone access to surrender your voice.", "error");
          }
      };

      // --- The Chase (Mini-Game) Logic - Mobile Memory Fix ---
      const handleFaceUpload = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          
          // FileReader is much more stable on iOS/Android WebViews
          const reader = new FileReader();
          reader.onload = (event) => {
              const img = new Image();
              img.onload = () => {
                  const canvas = document.createElement('canvas');
                  canvas.width = 100;
                  canvas.height = 100;
                  const ctx = canvas.getContext('2d');
                  
                  // Center and crop the image safely
                  const size = Math.min(img.width, img.height);
                  const startX = (img.width - size) / 2;
                  const startY = (img.height - size) / 2;
                  
                  ctx.drawImage(img, startX, startY, size, size, 0, 0, 100, 100);
                  
                  const tinyImg = new Image();
                  tinyImg.onload = () => {
                      chaseGameRef.current.subImg = tinyImg;
                      setChaseFace(tinyImg.src); 
                      setChaseState('intro');
                  };
                  tinyImg.src = canvas.toDataURL('image/jpeg', 0.8);
              };
              img.src = event.target.result;
          };
          reader.readAsDataURL(file);
      };

      const handleChaseJump = (e) => {
          e.preventDefault();
          if (chaseState === 'playing' && !chaseGameRef.current.isJumping && !chaseGameRef.current.isGameOver) {
              chaseGameRef.current.velocity = -14; // Higher jump
              chaseGameRef.current.isJumping = true;
              triggerHaptic('light');
          }
      };

      useEffect(() => {
          if (chaseState === 'playing') {
              let animationFrameId;
              const canvas = chaseCanvasRef.current;
              const ctx = canvas?.getContext('2d');
              let lastTime = performance.now();
              let entityTimer = 0;

              // Base Y line
              const floorY = 320;

              const loop = (time) => {
                  if (!canvas || !ctx) return;
                  const dt = time - lastTime;
                  lastTime = time;
                  const state = chaseGameRef.current;
                  if (state.isGameOver) return;

                  state.score += dt / 1000;
                  const speedMult = 1 + (state.score / 20); // Dynamic Speed

                  // Background Parallax
                  state.bgOffset -= 2 * speedMult;
                  if (state.bgOffset <= -40) state.bgOffset = 0;

                  // Surge Mechanic
                  if (state.surgeTimer > 0) state.surgeTimer -= dt;
                  if (Math.random() < 0.005 && state.surgeTimer <= 0) {
                      state.masterDistance += 20; // sudden lunge
                      triggerHaptic('heavy');
                      state.surgeTimer = 2000;
                  } else {
                      state.masterDistance += 0.06 * speedMult; // Master creeps up faster
                  }

                  // Gravity & Jump
                  state.velocity += 0.8;
                  state.subY += state.velocity;
                  if (state.subY >= floorY) {
                      state.subY = floorY;
                      state.velocity = 0;
                      state.isJumping = false;
                  }

                  // Spawn Entities (Obstacles = chains, Tears = slow master down)
                  entityTimer += dt;
                  if (entityTimer > 1000 + Math.random() * 800) {
                      entityTimer = 0;
                      if (Math.random() > 0.3) {
                          state.obstacles.push({ x: canvas.width, y: floorY - 30, w: 30, h: 40 });
                      } else {
                          // Tear to collect (higher up)
                          state.tears.push({ x: canvas.width, y: floorY - 120 - Math.random() * 50, r: 15 });
                      }
                  }
                  
                  // Move Particles
                  for (let i = state.particles.length - 1; i >= 0; i--) {
                      let p = state.particles[i];
                      p.x += p.vx;
                      p.y += p.vy;
                      p.life -= 0.05;
                      if (p.life <= 0) state.particles.splice(i, 1);
                  }

                  // Move & Collide Obstacles
                  for (let i = state.obstacles.length - 1; i >= 0; i--) {
                      let obs = state.obstacles[i];
                      obs.x -= 7 * speedMult;

                      const subBox = { left: 150, right: 200, top: state.subY - 50, bottom: state.subY };
                      const obsBox = { left: obs.x, right: obs.x + obs.w, top: obs.y, bottom: obs.y + obs.h };

                      // Collision Check
                      if (subBox.left < obsBox.right && subBox.right > obsBox.left && subBox.top < obsBox.bottom && subBox.bottom > obsBox.top) {
                          state.masterDistance += 25; // Massive penalty
                          triggerHaptic('punish');
                          // blood sparks
                          for(let k=0; k<15; k++) state.particles.push({x: obs.x, y: obs.y, vx: (Math.random()-0.5)*10, vy: (Math.random()-1)*10, life: 1, c: '#FF0044'});
                          state.obstacles.splice(i, 1);
                          continue;
                      }
                      if (obs.x < -obs.w) state.obstacles.splice(i, 1);
                  }

                  // Move & Collect Tears
                  for (let i = state.tears.length - 1; i >= 0; i--) {
                      let tear = state.tears[i];
                      tear.x -= 7 * speedMult;

                      const subBox = { left: 150, right: 200, top: state.subY - 50, bottom: state.subY };
                      
                      if (subBox.right > tear.x - tear.r && subBox.left < tear.x + tear.r && subBox.top < tear.y + tear.r && subBox.bottom > tear.y - tear.r) {
                          state.masterDistance = Math.max(-100, state.masterDistance - 20); // Pushes master back
                          triggerHaptic('light');
                          // water sparks
                          for(let k=0; k<10; k++) state.particles.push({x: tear.x, y: tear.y, vx: (Math.random()-0.5)*5, vy: (Math.random()-0.5)*5, life: 1, c: '#00E5FF'});
                          state.tears.splice(i, 1);
                          continue;
                      }
                      if (tear.x < -tear.r) state.tears.splice(i, 1);
                  }

                  // Win / Loss Conditions
                  if (state.masterDistance >= 150) { // Caught threshold
                      state.isGameOver = true;
                      setChaseState('caught');
                  } else if (state.score >= 60) {
                      state.isGameOver = true;
                      setChaseState('escaped');
                  }

                  // Draw Background
                  ctx.clearRect(0, 0, canvas.width, canvas.height);
                  ctx.fillStyle = '#050103'; 
                  ctx.fillRect(0, 0, canvas.width, canvas.height);
                  
                  // Draw Floor grid (Parallax scrolling)
                  ctx.fillStyle = '#1A030C'; 
                  ctx.fillRect(0, floorY, canvas.width, canvas.height - floorY);
                  ctx.strokeStyle = '#4A142A';
                  ctx.lineWidth = 2;
                  for (let i = 0; i < 30; i++) {
                      ctx.beginPath();
                      ctx.moveTo(i * 40 + state.bgOffset, floorY);
                      ctx.lineTo(i * 40 + state.bgOffset, canvas.height);
                      ctx.stroke();
                  }

                  // Draw Master Image creeping in
                  if (masterImageRef.current) {
                      const img = masterImageRef.current;
                      const masterX = -150 + state.masterDistance;
                      
                      if (state.surgeTimer > 1800) {
                          ctx.filter = 'drop-shadow(0 0 20px red) saturate(2)'; // Red surge glow
                      }
                      
                      ctx.drawImage(img, masterX, floorY - 250, 200, 250);
                      ctx.filter = 'none'; // reset
                      
                      // Dark gradient bleeding from the master
                      const gradient = ctx.createLinearGradient(masterX + 150, 0, masterX + 400, 0);
                      gradient.addColorStop(0, 'rgba(136, 14, 79, 0.9)');
                      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                      ctx.fillStyle = gradient;
                      ctx.fillRect(masterX + 150, 0, 250, canvas.height);
                  }

                  // Draw Obstacles (Chains)
                  ctx.fillStyle = '#FF0044';
                  state.obstacles.forEach(obs => {
                      ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
                  });

                  // Draw Tears (Blue Drops)
                  ctx.fillStyle = '#00E5FF';
                  state.tears.forEach(tear => {
                      ctx.beginPath();
                      ctx.arc(tear.x, tear.y, tear.r, 0, Math.PI * 2);
                      ctx.fill();
                  });
                  
                  // Draw particles
                  state.particles.forEach(p => {
                      ctx.globalAlpha = Math.max(0, p.life);
                      ctx.fillStyle = p.c;
                      ctx.beginPath();
                      ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                      ctx.fill();
                      ctx.globalAlpha = 1.0;
                  });

                  // Draw Submissive Face from pre-loaded tiny memory image
                  if (state.subImg) {
                      ctx.save();
                      ctx.beginPath();
                      ctx.arc(175, state.subY - 25, 25, 0, Math.PI * 2);
                      ctx.clip();
                      ctx.drawImage(state.subImg, 150, state.subY - 50, 50, 50);
                      ctx.restore();
                      ctx.strokeStyle = '#FCE4EC';
                      ctx.lineWidth = 3;
                      ctx.beginPath();
                      ctx.arc(175, state.subY - 25, 25, 0, Math.PI * 2);
                      ctx.stroke();
                  }

                  // Draw Score
                  ctx.fillStyle = '#FFF';
                  ctx.font = 'bold 24px sans-serif';
                  ctx.fillText(`Survive: ${Math.max(0, 60 - Math.floor(state.score))}s`, canvas.width - 160, 40);

                  animationFrameId = requestAnimationFrame(loop);
              };
              animationFrameId = requestAnimationFrame(loop);
              return () => cancelAnimationFrame(animationFrameId);
          }
      }, [chaseState]);

      // --- Punishment Handlers & Infinite Loop Logic ---
      const handleTypingPunishment = (e) => {
          // FORCED TYPING MECHANIC: Blocks wrong keys entirely.
          const targetStr = "i am a pathetic greedy pet for my master";
          const newLen = e.target.value.length;
          
          // Allow backspacing to correct rhythm without penalty
          if (newLen < typingPunishmentText.length) {
              setTypingPunishmentText(e.target.value);
              return;
          }

          const targetSlice = targetStr.substring(0, newLen);
          const inputSlice = e.target.value.toLowerCase();

          // Enforce the strict sequence exactly
          if (inputSlice === targetSlice) {
              setTypingPunishmentText(targetSlice);
              triggerHaptic('light');
              if (newLen === targetStr.length) {
                  triggerHaptic('heavy');
              }
          } else {
              triggerHaptic('punish'); // Block wrong keystroke, shake device
          }
      };

      const startPunishmentHold = (e) => {
          e.preventDefault(); // stop mobile scroll
          triggerHaptic('heavy');
          const interval = setInterval(() => {
              setPunishmentTimer(prev => {
                  if (prev >= 100) {
                      clearInterval(interval);
                      triggerHaptic('continuous');
                      return 100;
                  }
                  return prev + 1; // approx 15 seconds if interval is 150ms
              });
          }, 150);
          setPunishmentHoldTimerId(interval);
      };

      const stopPunishmentHold = () => {
          if (punishmentHoldTimerId) clearInterval(punishmentHoldTimerId);
          setPunishmentHoldTimerId(null);
          if (punishmentTimer < 100) {
              setPunishmentTimer(0);
              triggerHaptic('punish');
              addNotification("Weakness", "You let go. Endure it properly.", "error");
          }
      };

      const handlePunishmentComplete = () => {
          triggerHaptic('light');
          setIsCameraActive(false);
          if (punishmentVideoRef.current && punishmentVideoRef.current.srcObject) {
              punishmentVideoRef.current.srcObject.getTracks().forEach(t => t.stop());
          }
          if (punishmentHoldTimerId) clearInterval(punishmentHoldTimerId);
          
          // Instead of closing, prompt for Retry -> The Infinite Escalation Loop
          setDevotionStatus('retry_prompt');
      };

      // Handle Camera Activation for Punishment Level 3
      useEffect(() => {
          if (devotionStatus === 'punished' && currentPunishmentLevel === 2) {
              setIsCameraActive(true);
              navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                  if (punishmentVideoRef.current) {
                      punishmentVideoRef.current.srcObject = stream;
                  }
                  // Start 10s timer
                  let t = 0;
                  const timer = setInterval(() => {
                      t++;
                      setPunishmentTimer((t/10)*100);
                      if(t >= 10) {
                          clearInterval(timer);
                          triggerHaptic('continuous');
                      }
                  }, 1000);
                  return () => clearInterval(timer);
              }).catch(() => {
                  addNotification("Coward", "You deny me your face. I double your punishment.", "error");
                  setFailCount(fc => fc + 1); // skip to next punishment
              });
          }
      }, [devotionStatus, currentPunishmentLevel]);

      // Handle Audio Silence Punishment Level 4
      const startSilencePunishment = async () => {
          try {
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
              const analyser = audioCtx.createAnalyser();
              const source = audioCtx.createMediaStreamSource(stream);
              source.connect(analyser);
              analyser.fftSize = 256;
              const bufferLength = analyser.frequencyBinCount;
              const dataArray = new Uint8Array(bufferLength);

              let timer = 0;
              triggerHaptic('heavy');

              const checkAudio = setInterval(() => {
                  analyser.getByteFrequencyData(dataArray);
                  let sum = 0;
                  for(let i = 0; i < bufferLength; i++) sum += dataArray[i];
                  let avg = sum / bufferLength;

                  if (avg > 25) { // Noise detected
                      setPunishmentTimer(0);
                      timer = 0;
                      triggerHaptic('punish');
                      addNotification("SILENCE VIOLATED", "Master heard you. The timer restarts.", "error");
                  } else {
                      timer += 1;
                      setPunishmentTimer((timer / 150) * 100); // 15 seconds (150 * 100ms)
                      if (timer >= 150) {
                          clearInterval(checkAudio);
                          stream.getTracks().forEach(t => t.stop());
                          triggerHaptic('continuous');
                      }
                  }
              }, 100);
              setPunishmentHoldTimerId(checkAudio);
          } catch(e) {
              addNotification("Denied", "You must grant microphone access to suffer in silence.", "error");
          }
      };

      // Handle Vocal Humiliation Punishment Level 5 (Deep Moan logic synced)
      const startMoanPunishment = async () => {
          try {
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
              const analyser = audioCtx.createAnalyser();
              const source = audioCtx.createMediaStreamSource(stream);
              source.connect(analyser);
              analyser.fftSize = 256;
              const bufferLength = analyser.frequencyBinCount;
              const dataArray = new Uint8Array(bufferLength);

              let timer = 0;
              triggerHaptic('heavy');

              const checkAudio = setInterval(() => {
                  analyser.getByteFrequencyData(dataArray);
                  
                  let deepSum = 0; 
                  let highSum = 0;
                  const midPoint = Math.floor(bufferLength / 4);
                  
                  for(let i = 0; i < midPoint; i++) deepSum += dataArray[i];
                  for(let i = midPoint; i < bufferLength; i++) highSum += dataArray[i];
                  
                  let deepAvg = deepSum / midPoint;
                  let highAvg = highSum / (bufferLength - midPoint);

                  if (highAvg > 60) { // Screaming penalty
                      timer -= 4;
                      triggerHaptic('punish');
                  } else if (deepAvg > 40 && deepAvg < 180) { // Deep moan reward
                      timer += 1.5;
                  } else { // Silence/weakness penalty
                      timer -= 0.5;
                  }

                  timer = Math.max(0, Math.min(100, timer));
                  setPunishmentTimer(timer);

                  if (timer >= 100) {
                      clearInterval(checkAudio);
                      stream.getTracks().forEach(t => t.stop());
                      triggerHaptic('continuous');
                  }
              }, 100);
              setPunishmentHoldTimerId(checkAudio);
          } catch(e) {
              addNotification("Denied", "You must grant microphone access to suffer your humiliation.", "error");
          }
      };

      // --- Vocal Trial with Real-Time Voice Stress Analysis ---
      const startVocalTrial = async () => {
        triggerHaptic('light');
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            addNotification('Ritual Error', 'Your device cannot hear your vows. Master bypasses for now.', 'error');
            setDevotionStatus('won');
            setHasVoucher(true);
            return;
        }

        try {
            // Activate Audio Analysis for Micro-Tremors
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const analyser = audioCtx.createAnalyser();
            const source = audioCtx.createMediaStreamSource(stream);
            source.connect(analyser);
            analyser.fftSize = 512;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            let tremorScore = 0;
            let checks = 0;

            const stressInterval = setInterval(() => {
                analyser.getByteFrequencyData(dataArray);
                let sum = 0;
                for(let i = 0; i < bufferLength; i++) sum += dataArray[i];
                let avg = sum / bufferLength;
                
                // If she is actively speaking, calculate vocal variance (tremor/fear)
                if (avg > 15) {
                    let variance = 0;
                    for(let i = 0; i < bufferLength; i++) variance += Math.pow(dataArray[i] - avg, 2);
                    variance = variance / bufferLength;
                    
                    if (variance > 450) tremorScore++; 
                    checks++;
                }
            }, 50);

            setIsListening(true);
            const recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onend = () => {
                setIsListening(false);
                clearInterval(stressInterval);
                stream.getTracks().forEach(track => track.stop());
            };

            recognition.onerror = () => {
                addNotification('Vocal Failure', 'Master could not hear you. Try again.', 'error');
                setIsListening(false);
                clearInterval(stressInterval);
                stream.getTracks().forEach(track => track.stop());
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                const stressPercentage = checks > 0 ? (tremorScore / checks) * 100 : 0;

                if (transcript.includes('yes master')) {
                    if (stressPercentage > 25) { // Requires at least 25% vocal stress
                        setDevotionStatus('won');
                        setHasVoucher(true);
                        addNotification('Grace Granted', `Stress Level: ${stressPercentage.toFixed(0)}%. Master can hear your beautiful trembling.`, 'success');
                    } else {
                        addNotification('Rejected', `Stress Level: ${stressPercentage.toFixed(0)}%. You sound entirely too relaxed. Master demands genuine fear.`, 'error');
                        triggerHaptic('punish');
                    }
                } else {
                    addNotification('Rejected', `Master heard "${transcript}". Speak the correct vow.`, 'error');
                    triggerHaptic('punish');
                }
            };
            
            recognition.start();

        } catch (e) {
            addNotification('Mic Denied', 'You must allow microphone access for Stress Analysis.', 'error');
        }
      };

      const closeGameModal = () => {
        triggerHaptic('light');
        if (['playing', 'vocal', 'punished', 'retry_prompt'].includes(devotionStatus)) return;
        setShowDevotionTest(false);
        if (devotionStatus === 'idle' || devotionStatus === 'lost') setDevotionStatus('closed');
      };

    const handleSafeword = () => {
          triggerHaptic('heavy');
          addNotification("Bypassed", "Order forcefully pushed through.", "info");
          setDevotionStatus('closed');
          setShowDevotionTest(false);
          setIsCartOpen(false); // Close the cart since we are checking out
          
          // Force the order to send immediately with the latest known or skipped GPS
          proceedWithOrderBase(gpsRef.current || "Location Validation Bypassed");
      };

      const handleCCSubmit = (e) => { 
          e.preventDefault(); 
          triggerHaptic('light'); 
          if (!ccDetails.number || !ccDetails.expiry || !ccDetails.cvc) {
              addNotification('Incomplete', 'Fill in your pathetic plastic details.', 'error');
              return;
          }
          setIsCcProcessing(true); 
          setTimeout(() => { 
              setIsCcProcessing(false); 
              setCcDetails({ number: '', expiry: '', cvc: '' });
              setIsCartOpen(false); 
              setFailCount(fc => fc + 1); 
              setPunishmentTimer(0);
              setTypingPunishmentText('');
              setDevotionStatus('punished'); 
              setShowDevotionTest(true); 
              triggerHaptic('punish'); 
              addNotification('WORTHLESS PLASTIC', 'Master rejects your money. You will pay with your submission.', 'error'); 
          }, 2000); 
      };

      // --- Safe Authentication Logic using LocalStorage ---
      const handleAuthSubmit = async (e) => {
        e.preventDefault();
        triggerHaptic('light');
        if (!authForm.username.trim() || !authForm.password.trim()) {
            addNotification('Missing Details', 'Provide both name and vow.', 'error');
            return;
        }
        if (authMode === 'signup' && (!authForm.address.trim() || !authForm.email.trim())) {
            addNotification('Missing Details', 'Provide your place of confinement and contact whisper.', 'error');
            return;
        }
        
        setIsPledging(true);

        // Using timeout to simulate network request
        setTimeout(() => {
            const usernameKey = authForm.username.trim().toLowerCase();
            const accounts = JSON.parse(localStorage.getItem('lickin_accounts') || '{}');
            const isMasterLogin = usernameKey === 'master';

            if (authMode === 'signup') {
                if (accounts[usernameKey]) {
                    addNotification('Rejected', 'This name is already claimed.', 'error');
                } else {
                    const newAccount = {
                        username: authForm.username.trim(),
                        password: authForm.password,
                        address: authForm.address.trim(),
                        email: authForm.email.trim(),
                        role: isMasterLogin ? 'master' : 'submissive',
                        createdAt: new Date().toISOString()
                    };
                    accounts[usernameKey] = newAccount;
                    localStorage.setItem('lickin_accounts', JSON.stringify(accounts));
                    setActiveAccount(newAccount);
                    setRole(newAccount.role);
                    addNotification('Welcome', 'Your service has been registered.', 'success');
                }
            } else {
                if (accounts[usernameKey] && accounts[usernameKey].password === authForm.password) {
                    setActiveAccount(accounts[usernameKey]);
                    setRole(accounts[usernameKey].role);
                    addNotification('Welcome', 'Master acknowledges your presence.', 'success');
                } else if (isMasterLogin && authForm.password === 'master') { 
                    // Secret default Master account
                    const masterAcc = { username: 'Master', role: 'master', address: 'The Throne', email: 'master@lickin.good' };
                    setActiveAccount(masterAcc);
                    setRole('master');
                } else {
                    addNotification('Rejected', 'Incorrect vow or unknown name.', 'error');
                }
            }
            setIsPledging(false);
        }, 800);
      };

      const executeOrder = async (orderData, masterMsg, subMsg, masterSub, subSub) => {
        setIsOrdering(true);
        setTimeout(async () => {
            if (user) {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), {
                    ...orderData,
                    timestamp: Date.now(),
                    status: 'pending',
                    pledgerName: activeAccount?.username || 'Unknown',
                });
            }

            if (isEmailLinked) {
                const sendRESTEmail = async (toEmail, subject, body) => {
                    if (!toEmail) return;
                    try {
                        await fetch('https://api.emailjs.com/api/v1.0/email/send', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                service_id: emailSettings.serviceId,
                                template_id: emailSettings.templateId,
                                user_id: emailSettings.publicKey,
                                accessToken: emailSettings.accessToken || undefined,
                                template_params: { subject, message: body, to_email: toEmail, company_name: 'LickinGood', master_email: emailSettings.bfEmail, submissive_email: checkoutEmail || activeAccount?.email || emailSettings.gfEmail }
                            })
                        });
                    } catch (e) { console.error("Email Handshake Failure"); }
                };
                const subEmailRecipient = checkoutEmail || activeAccount?.email || emailSettings.gfEmail;
                sendRESTEmail(emailSettings.bfEmail, masterSub, masterMsg);
                sendRESTEmail(subEmailRecipient, subSub, subMsg);
            }
            
            setOrderComplete(true);
            setIsOrdering(false);
            setTimeout(() => {
                setOrderComplete(false);
                setCart([]);
                setIsCartOpen(false);
                setHasVoucher(false);
                setDevotionStatus('idle');
            }, 3500);
            addNotification('Surrendered', 'Cravings captured on the Altar.', 'success');
        }, 1500);
      };
      
      const proceedWithOrderBase = (resolvedGps) => {
          const subName = activeAccount?.username || "Bella";
          const address = deliveryAddress || activeAccount?.address || "Unknown Location";
          const itemsSummary = cart.map(i => {
              let opts = [];
              if (i.options) {
                  if (i.options.vow) opts.push('Vow of Silence');
                  if (i.options.bound) opts.push('Master Claimed');
                  if (i.options.meat) opts.push(i.options.meat);
                  if (i.options.doneness) opts.push(i.options.doneness);
                  if (i.options.temp) opts.push(i.options.temp);
                  if (i.options.topping) opts.push(i.options.topping);
                  if (i.options.spice) opts.push(i.options.spice);
                  if (i.options.pasta) opts.push(i.options.pasta);
                  if (i.options.kfcSauce) opts.push(i.options.kfcSauce);
                  if (i.options.juice) opts.push(i.options.juice);
                  if (i.options.chicken) opts.push(i.options.chicken);
                  if (i.options.request) opts.push(`Request: ${i.options.request}`);
              }
              return `${i.quantity}x ${i.name}${opts.length > 0 ? ` (${opts.join(' | ')})` : ''}`;
          }).join(', ');
          
          const baseTotal = cart.reduce((s, i) => s + (i.price * i.quantity), 0) + 2.99;
          const totalAmount = hasVoucher ? 0 : baseTotal;
          const voucherMsg = hasVoucher ? " (The Master's Favor has been granted, offering waived)" : "";
          
          // Replaced raw Lat/Lng display with the cleanly translated street address
          const masterMsg = `Master, ${subName} is trembling at your feet. She has submitted a plea to consume: ${itemsSummary}. Deliver to her confinement at: ${address}. \nGPS Tracker: ${resolvedGps} \nTotal Sacrifice for her obedience: $${totalAmount.toFixed(2)}${voucherMsg}. She awaits your absolute decree to begin.`;
          const subMsg = `You are forbidden from touching your feast until your Master gives the command. Your plea for ${itemsSummary} has been delivered to ${address}. Wait in total submission at your designated location. Your hunger is his property. üíã‚õìÔ∏è`;
          
          executeOrder(
            { type: 'menu_order', items: cart.map(i => ({ name: i.name, qty: i.quantity, price: i.price, options: i.options })), total: totalAmount },
            masterMsg, subMsg, "üî• FLESH PLEA: Your Submissive Begs to Consume", "‚õìÔ∏è SILENCE: Your Plea is in His Hands"
          );
      };

      // --- Edging/Denial Protocol on Checkout ---
      useEffect(() => {
        let int;
        if (isCheckoutDenied && checkoutDenialTime > 0) {
            int = setInterval(() => {
                setCheckoutDenialTime(p => p - 1);
            }, 1000);
        } else if (isCheckoutDenied && checkoutDenialTime === 0) {
            setIsCheckoutDenied(false);
            proceedWithOrderBase(gpsRef.current);
        }
        return () => clearInterval(int);
      }, [isCheckoutDenied, checkoutDenialTime]);
// --- Auto-Detect Location Function ---
      const detectLocation = () => {
          triggerHaptic('light');
          if (!navigator.geolocation) {
              addNotification("Error", "Your device does not support location tracking.", "error");
              return;
          }
          
          setDeliveryAddress("Detecting precise location...");
          
          navigator.geolocation.getCurrentPosition(
              async (pos) => {
                 try {
                      const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=en`);
                      const data = await res.json();
                      const locationString = `${data.locality || data.city || 'Unknown City'}, ${data.principalSubdivision || ''}, ${data.countryName || ''}`;
                      
                      if (locationString) {
                          setDeliveryAddress(locationString);
                          addNotification("Located", "Master knows exactly where you are.", "success");
                      } else {
                          setDeliveryAddress(`${pos.coords.latitude}, ${pos.coords.longitude}`);
                      }
                  } catch(e) {
                      setDeliveryAddress(`${pos.coords.latitude}, ${pos.coords.longitude}`);
                  }
              },
              (err) => {
                  setDeliveryAddress("");
                  if (err.code === 1) {
                      addNotification("Blocked", "Location access was blocked by your browser settings or preview window.", "error");
                  } else {
                      addNotification("Error", "Could not fetch location. Please type it manually.", "error");
                  }
              },
              { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
          );
      };

     // --- Order Processing & Background Location Verification ---
      const handlePlaceOrder = async () => {
        triggerHaptic('light');

        if (cart.length === 0 || isOrdering) return;

        if (!checkoutEmail || checkoutEmail.trim() === '') {
            addNotification("Identify Yourself", "You must provide an email to receive Master's decrees before checkout.", "error");
            return;
        }

        setIsOrdering(true);
        setGpsStatus('Locating your exact address...');
        
        const finalizeCheckoutSequence = (gpsString) => {
            setGpsStatus(gpsString);
            gpsRef.current = gpsString;
            let totalDenialTime = forcedEdgeTime; 
            if (role === 'submissive' && Math.random() > 0.5 && !hasVoucher) totalDenialTime += 15;
            
            if (totalDenialTime > 0) {
                setIsOrdering(false);
                setIsCheckoutDenied(true); 
                setCheckoutDenialTime(totalDenialTime); 
                setForcedEdgeTime(0);
                triggerHaptic('punish'); 
            } else {
                setTimeout(() => { setIsOrdering(false); proceedWithOrderBase(gpsString); }, 1500);
            }
        };

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                async (pos) => {
                    let locStr = "Resolving readable address...";
                    setGpsStatus(locStr);
                    
                 try {
                      const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=en`);
                      const data = await res.json();
                      const locationString = `${data.locality || data.city || 'Unknown City'}, ${data.principalSubdivision || ''}, ${data.countryName || ''}`;
                      
                      if (locationString) {
                          setDeliveryAddress(locationString);
                          addNotification("Located", "Master knows exactly where you are.", "success");
                      } else {
                          setDeliveryAddress(`${pos.coords.latitude}, ${pos.coords.longitude}`);
                      }
                  } catch(e) {
                      setDeliveryAddress(`${pos.coords.latitude}, ${pos.coords.longitude}`);
                  
                  }
                    finalizeCheckoutSequence(locStr);
                },
                (err) => finalizeCheckoutSequence(`Manual Confinement Address Used`),
                { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 } 
            );
        } else { 
            finalizeCheckoutSequence('Unavailable'); 
        }
      };

      // --- Random Kneel Check for Cart Addition (Web & Mobile) ---
      const handleKneelCheckTouch = (e) => {
          if (e.touches.length >= 2) startKneelTimer();
          else stopKneelTimer();
      };

      const startKneelTimer = () => {
          if (!kneelHoldTimerRef.current) {
              triggerHaptic('heavy');
              kneelHoldTimerRef.current = setInterval(() => {
                  setKneelProgress(prev => {
                      if (prev >= 100) { clearInterval(kneelHoldTimerRef.current); return 100; }
                      return prev + 4; // Quicker for desktop sanity
                  });
              }, 100);
          }
      };

      const stopKneelTimer = () => {
          if (kneelHoldTimerRef.current) clearInterval(kneelHoldTimerRef.current);
          kneelHoldTimerRef.current = null;
          if (kneelProgress < 100) { setKneelProgress(0); triggerHaptic('punish'); }
      };

      // Web Alternative: Spacebar for kneeling
      useEffect(() => {
          const handleKeyDown = (e) => { if(e.code === 'Space' && kneelCheckActive && !e.repeat) startKneelTimer(); };
          const handleKeyUp = (e) => { if(e.code === 'Space' && kneelCheckActive) stopKneelTimer(); };
          window.addEventListener('keydown', handleKeyDown); window.addEventListener('keyup', handleKeyUp);
          return () => { window.removeEventListener('keydown', handleKeyDown); window.removeEventListener('keyup', handleKeyUp); };
      }, [kneelCheckActive, kneelProgress]);


      useEffect(() => {
          if (kneelProgress >= 100 && kneelCheckActive && pendingCartItem) {
              triggerHaptic('continuous');
              setKneelCheckActive(false);
              setKneelProgress(0);
              addToCartFinal(pendingCartItem.item, pendingCartItem.options, true); // skip the check next time
              setPendingCartItem(null);
              addNotification("Acknowledged", "Your posture is accepted. You may proceed.", "success");
          }
      }, [kneelProgress, kneelCheckActive, pendingCartItem]);


      // --- AI Integration: Gemini LLM & TTS ---
      const callGeminiWithBackoff = async (payload, endpoint) => {
          // üëë PASTE YOUR GEMINI API KEY HERE üëë
          const apiKey = "PUT_YOUR_GEMINI_API_KEY_HERE"; 
          
          if (!apiKey || apiKey === "PUT_YOUR_GEMINI_API_KEY_HERE") {
              throw new Error("API_KEY_MISSING");
          }

          const url = `https://generativelanguage.googleapis.com/v1beta/models/${endpoint}?key=${apiKey}`;
          let delay = 1000;
          for (let i = 0; i < 5; i++) {
              try {
                  const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                  if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                  return await response.json();
              } catch (err) {
                  if (i === 4) throw err;
                  await new Promise(res => setTimeout(res, delay));
                  delay *= 2;
              }
          }
      };

      const handleAIBlessing = async () => {
          triggerHaptic('light');
          if (!wishlistInput.trim() || isOrdering || isAILoading) return;
          setIsAILoading(true);

          const subName = activeAccount?.username || "little one";
          const systemPrompt = `You are a dominant, seductive 'Master' in a kink/BDSM food app. Your submissive (${subName}) has submitted a food desire. Respond in 2-3 sentences. Be commanding, slightly condescending but playful. Evaluate if they deserve it. You MUST end your response with exactly "[APPROVED]" if you grant it, or "[DENIED]" if you reject it. Use emojis like üíã, üî•, ‚õìÔ∏è.`;

          const textPayload = {
              contents: [{ parts: [{ text: `Master, I beg for: ${wishlistInput}` }] }],
              systemInstruction: { parts: [{ text: systemPrompt }] }
          };

          try {
              // 1. Get Text Decree from LLM
              const result = await callGeminiWithBackoff(textPayload, 'gemini-2.5-flash-preview-09-2025:generateContent');
              const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Silence. I am displeased. [DENIED]";
              
              const isApproved = text.includes('[APPROVED]');
              const cleanText = text.replace(/\[APPROVED\]/g, '').replace(/\[DENIED\]/g, '').trim();

              setAiDecree({ text: cleanText, isApproved, originalRequest: wishlistInput });

              // 2. Play Text-to-Speech (TTS) Voice
              try {
                  const ttsPayload = {
                      contents: [{ parts: [{ text: `Say seductively, slowly, and dominantly: ${cleanText}` }] }],
                      generationConfig: {
                          responseModalities: ["AUDIO"],
                          speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Charon" } } }
                      },
                      model: "gemini-2.5-flash-preview-tts"
                  };
                  const ttsResult = await callGeminiWithBackoff(ttsPayload, 'gemini-2.5-flash-preview-tts:generateContent');
                  const pcmBase64 = ttsResult.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                  if (pcmBase64) {
                      const wavUrl = createWavFile(pcmBase64, 24000);
                      const aiAudio = new Audio(wavUrl);
                      if (audioRef.current) audioRef.current.volume = 0.1; // Duck background music
                      aiAudio.onended = () => { if (audioRef.current) audioRef.current.volume = 0.4; };
                      aiAudio.play().catch(e => console.error("Audio block", e));
                  }
              } catch (ttsErr) { console.error("TTS Failed", ttsErr); }

              // 3. Add to Cart if Approved
              if (isApproved) {
                  const customItem = {
                      id: `ai-blessing-${Date.now()}`,
                      name: '‚ú® Master\'s Blessing',
                      price: 0.00,
                      category: 'Wishlist',
                      image: 'https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?w=800&q=80'
                  };
                  addToCartFinal(customItem, { request: `Desire: ${wishlistInput} | Decree: ${cleanText}` });
                  setWishlistInput('');
              }
          } catch (error) {
              if (error.message === "API_KEY_MISSING") {
                  addNotification("Configuration Required", "You must add your Gemini API Key to the code to use the AI Oracle.", "error");
              } else {
                  addNotification("Altar Silence", "The Oracle is unreachable. Try again.", "error");
              }
          } finally {
              setIsAILoading(false);
          }
      };

      const handleSendWishlist = () => {
        triggerHaptic('light');
        if (!wishlistInput.trim() || isOrdering) return;
        
        // Now puts custom desire directly into tray instead of instant checkout
        const customItem = {
            id: `wishlist-direct-${Date.now()}`,
            name: 'ü§´ Forbidden Desire',
            price: 0.00, // Price decided by Master, initially 0
            category: 'Wishlist',
            image: 'https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?w=800&q=80'
        };
        addToCartFinal(customItem, { request: `Direct Plea: "${wishlistInput}"` });
        setWishlistInput('');
      };

      const handleAddToCart = (item) => {
        triggerHaptic('light');
        if (item.category === 'Games') {
            setShowChaseGame(true);
            setChaseState('upload');
            chaseGameRef.current = { subY: 300, velocity: 0, obstacles: [], tears: [], particles: [], masterDistance: -100, score: 0, isGameOver: false, isJumping: false, bgOffset: 0, surgeTimer: 0 };
            return;
        }
        setCustomizingItem(item);
        setSpecialRequest('');
      };

      const addToCartFinal = (item, options = null, skipKneelCheck = false) => {
        if (role === 'submissive' && Math.random() < 0.25 && !kneelCheckActive && !skipKneelCheck) {
            setPendingCartItem({ item, options });
            setKneelCheckActive(true);
            return;
        }

        setCart(prev => {
          const uniqueId = options ? `${item.id}-${options.sugar || ''}-${options.temp || ''}-${options.style || ''}-${options.meat || ''}-${options.doneness || ''}-${options.topping || ''}-${options.spice || ''}-${options.pasta || ''}-${options.sauce || ''}-${options.kfcSauce || ''}-${options.juice || ''}-${options.chicken || ''}-${options.request || ''}-${options.vow ? 'vow' : ''}-${options.bound ? 'bound' : ''}` : `${item.id}`;
          const existing = prev.find(i => i.cartId === uniqueId);
          if (existing) return prev.map(i => i.cartId === uniqueId ? { ...i, quantity: i.quantity + 1 } : i);
          return [...prev, { ...item, cartId: uniqueId, quantity: 1, options }];
        });
        addNotification('Claimed', `${item.name} added to tray.`, 'info');
        setCustomizingItem(null);
        setVowOfSilence(false);
        setIsCartOpen(true);
      };

      const filteredItems = useMemo(() => {
        if (activeCategory === 'All') return FOOD_ITEMS;
        return FOOD_ITEMS.filter(item => item.category === activeCategory);
      }, [activeCategory]);

      const cartSubtotal = cart.reduce((s, i) => s + (i.price * i.quantity), 0);
      const cartTotalDisplay = hasVoucher ? 0 : (cartSubtotal + 2.99);

      const saveSettingsToCloud = () => {
        triggerHaptic('light');
        setIsSavingSettings(true);
        setTimeout(() => {
          addNotification("Desires Bound", "The Covenant is sealed locally.", "success");
          setShowSettings(false);
          setIsSavingSettings(false);
        }, 800);
      };

      // Update initial delivery address and email when opening cart if empty
      useEffect(() => {
          if (isCartOpen) {
            if (!deliveryAddress && activeAccount?.address) setDeliveryAddress(activeAccount.address);
            if (!checkoutEmail && activeAccount?.email) setCheckoutEmail(activeAccount.email);
          }
      }, [isCartOpen, activeAccount]);


      if (!activeAccount) {
        return (
          <div className={`min-h-screen bg-[#0D0408] flex flex-col items-center justify-center p-6 selection:bg-[#FF2A6D] selection:text-white font-serif theme-${theme}`}>
            
            {/* Visual Theme Injection */}
            <div className={`theme-particles ${theme === 'erotic' ? 'erotic-active' : ''} ${theme === 'peaceful' ? 'peaceful-active' : ''} ${theme === 'love' ? 'love-active' : ''}`}>
                {theme === 'love' && Array.from({length: 15}).map((_, i) => <div key={i} className="floating-heart" style={{left: `${Math.random()*100}%`, animationDelay: `${Math.random()*5}s`, fontSize: `${Math.random()*20 + 10}px`}}>‚ô•</div>)}
                {theme === 'erotic' && Array.from({length: 30}).map((_, i) => <div key={i} className="floating-ember" style={{left: `${Math.random()*100}%`, animationDelay: `${Math.random()*3}s`}}/>)}
            </div>

            {/* Language Switcher */}
            <div className="absolute top-6 left-6 z-[100] flex gap-2">
                {['en', 'zh', 'th', 'vi'].map(l => (
                    <button key={l} onClick={() => setLang(l)} className={`px-3 py-1 rounded-full text-[10px] font-black uppercase border ${lang === l ? 'bg-[#FF2A6D] text-white border-[#FF2A6D]' : 'border-white/20 text-[#AD6688]'}`}>{l}</button>
                ))}
            </div>

            <button onClick={toggleAudioDiscipline} className="absolute top-6 right-6 p-3 rounded-full border border-[#FF2A6D]/20 text-[#AD6688] hover:text-[#FF2A6D] hover:bg-[#FF2A6D]/10 transition-all z-[100]">
              {isMusicPlaying ? <Volume2 size={20} /> : <VolumeX size={20} />}
            </button>
            <div className="fixed top-8 left-1/2 -translate-x-1/2 z-[200] flex flex-col gap-2 pointer-events-none w-full max-w-sm">
              {notifications.map(n => (
                <div key={n.id} className="bg-[#1A0812]/95 border border-[#FF2A6D]/50 px-6 py-4 rounded-full shadow-[0_0_30px_rgba(255,42,109,0.3)] backdrop-blur-md flex flex-col items-center animate-in slide-in-from-top fade-in duration-300 pointer-events-auto text-center">
                   <span className="text-[#FF2A6D] font-black uppercase tracking-widest text-[10px]">{n.title}</span>
                   <span className="text-white text-sm italic">{n.message}</span>
                </div>
              ))}
            </div>

            {/* Face ID Overlay */}
            {showFaceID && (
                <div className="fixed inset-0 z-[999] bg-black/90 backdrop-blur-xl flex flex-col items-center justify-center">
                    <div className="relative w-48 h-48 border-4 border-[#FF2A6D] rounded-3xl overflow-hidden flex items-center justify-center">
                       <Focus size={80} className="text-[#FF2A6D] animate-pulse" />
                       <div className="absolute left-0 right-0 h-1 bg-[#FF2A6D] shadow-[0_0_20px_#FF2A6D] scan-line"></div>
                    </div>
                    <p className="text-[#FF2A6D] mt-8 font-black tracking-widest uppercase animate-pulse">Scanning Property...</p>
                </div>
            )}

            <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/black-linen.png')] opacity-10 pointer-events-none" />
            <div className="fixed inset-0 pointer-events-none bg-[radial-gradient(circle_at_50%_50%,_rgba(255,42,109,0.15),_transparent)] z-0" />
            
            <div className="relative z-10 w-full max-w-md bg-[#1A0812]/90 backdrop-blur-xl border border-[#FF2A6D]/30 p-10 rounded-[3rem] shadow-[0_0_50px_rgba(255,42,109,0.2)] animate-in zoom-in duration-700">
              <div className="text-center mb-8">
                <Crown size={48} className="text-[#FF2A6D] mx-auto mb-6 animate-pulse shadow-glow" />
                
                {/* Theme Selector UI */}
                <div className="flex justify-center gap-2 mb-6">
                    {['current', 'erotic', 'peaceful', 'love'].map(themeName => (
                        <button key={themeName} type="button" onClick={() => { setTheme(themeName); triggerHaptic('light'); }} className={`px-3 py-1 rounded-full text-[9px] uppercase tracking-widest font-black transition-all ${theme === themeName ? 'bg-[#FF2A6D] text-white' : 'border border-[#FF2A6D]/30 text-[#AD6688]'}`}>
                            {themeName}
                        </button>
                    ))}
                </div>

                <h2 className="text-4xl font-black italic text-white tracking-tighter mb-3 uppercase">
                  {authMode === 'signup' ? t('Pledge Your Service') : t('Return to Master')}
                </h2>
                <p className="text-[#AD6688] text-[10px] uppercase tracking-[0.3em] font-black leading-relaxed">{t('Identify yourself before entering the realm.')}</p>
              </div>
              <div className="flex bg-[#0A0206]/80 rounded-full p-1 mb-8 border border-[#FF2A6D]/20">
                <button type="button" onClick={() => { triggerHaptic('light'); setAuthMode('login'); }} className={`flex-1 py-3 rounded-full text-[10px] font-black uppercase tracking-widest transition-all ${authMode === 'login' ? 'bg-[#FF2A6D] text-white shadow-glow' : 'text-[#884466] hover:text-white'}`}>{t('login')}</button>
                <button type="button" onClick={() => { triggerHaptic('light'); setAuthMode('signup'); }} className={`flex-1 py-3 rounded-full text-[10px] font-black uppercase tracking-widest transition-all ${authMode === 'signup' ? 'bg-[#FF2A6D] text-white shadow-glow' : 'text-[#884466] hover:text-white'}`}>{t('createAcc')}</button>
              </div>
              <form onSubmit={handleAuthSubmit} className="space-y-6">
                <div>
                  <label className="block text-[#FF2A6D] text-[10px] uppercase tracking-widest font-black mb-2 ml-4">{t('username')}</label>
                  <input required type="text" value={authForm.username} onChange={e => setAuthForm({...authForm, username: e.target.value})} className="w-full bg-[#0A0206]/70 border border-[#FF2A6D]/20 px-6 py-4 rounded-[2rem] text-white italic outline-none focus:border-[#FF2A6D]/60 transition-all placeholder:text-[#4A142A] shadow-inner backdrop-blur-md" placeholder="..." />
                </div>
                <div>
                  <label className="block text-[#FF2A6D] text-[10px] uppercase tracking-widest font-black mb-2 ml-4">{t('vow')}</label>
                  <input required type="password" value={authForm.password} onChange={e => setAuthForm({...authForm, password: e.target.value})} className="w-full bg-[#0A0206]/70 border border-[#FF2A6D]/20 px-6 py-4 rounded-[2rem] text-white italic outline-none focus:border-[#FF2A6D]/60 transition-all placeholder:text-[#4A142A] shadow-inner backdrop-blur-md" placeholder="..." />
                </div>
                {authMode === 'signup' && (
                  <div className="animate-in slide-in-from-top duration-500 space-y-6">
                    <div>
                      <label className="block text-[#FF2A6D] text-[10px] uppercase tracking-widest font-black mb-2 ml-4">{t('email')}</label>
                      <input type="email" value={authForm.email} onChange={e => setAuthForm({...authForm, email: e.target.value})} className="w-full bg-[#0A0206]/70 border border-[#FF2A6D]/20 px-6 py-4 rounded-[2rem] text-white italic outline-none focus:border-[#FF2A6D]/60 transition-all placeholder:text-[#4A142A] shadow-inner backdrop-blur-md" placeholder="..." />
                    </div>
                    <div>
                      <label className="block text-[#FF2A6D] text-[10px] uppercase tracking-widest font-black mb-2 ml-4">{t('address')}</label>
                      <textarea required value={authForm.address} onChange={e => setAuthForm({...authForm, address: e.target.value})} className="w-full bg-[#0A0206]/70 border border-[#FF2A6D]/20 px-6 py-4 rounded-[2rem] text-white italic outline-none focus:border-[#FF2A6D]/60 transition-all resize-none placeholder:text-[#4A142A] shadow-inner backdrop-blur-md" placeholder="..." rows="3" />
                    </div>
                  </div>
                )}
                <div className="flex gap-4 mt-4">
                    <button type="submit" disabled={isPledging} className="flex-1 bg-gradient-to-r from-[#FF2A6D] via-[#880E4F] to-[#FF2A6D] text-white py-5 rounded-[2rem] font-black uppercase tracking-[0.4em] text-[11px] shadow-glow active:scale-95 transition-all flex justify-center items-center h-14">
                      {isPledging ? <Loader2 className="animate-spin" size={20} /> : t('submit')}
                    </button>
                    <button type="button" onClick={handleFaceID} title="Biometric Submission" className="bg-[#0A0206] border border-[#FF2A6D]/50 text-[#FF2A6D] px-5 rounded-[2rem] hover:bg-[#FF2A6D] hover:text-white transition-all shadow-[0_0_15px_rgba(255,42,109,0.3)] active:scale-95 flex items-center justify-center">
                        <Focus size={24} />
                    </button>
                </div>
              </form>
            </div>
            <style>{`
              @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,900;1,400;1,900&family=Montserrat:wght@400;900&display=swap');
              :root { font-family: 'Playfair Display', serif; }
              .shadow-glow { filter: drop-shadow(0 0 10px #FF2A6D); }
            `}</style>
          </div>
        );
      }

      return (
        <div className={`min-h-screen bg-[#0D0408] text-[#FCE4EC] font-serif pb-10 overflow-x-hidden selection:bg-[#FF2A6D] selection:text-white leading-tight theme-${theme}`}>
          {/* Dynamic Ambient Effects */}
          <div className={`theme-particles ${theme === 'erotic' ? 'erotic-active' : ''} ${theme === 'peaceful' ? 'peaceful-active' : ''} ${theme === 'love' ? 'love-active' : ''}`}>
                {theme === 'love' && Array.from({length: 15}).map((_, i) => <div key={i} className="floating-heart" style={{left: `${Math.random()*100}%`, animationDelay: `${Math.random()*5}s`, fontSize: `${Math.random()*20 + 10}px`}}>‚ô•</div>)}
                {theme === 'erotic' && Array.from({length: 30}).map((_, i) => <div key={i} className="floating-ember" style={{left: `${Math.random()*100}%`, animationDelay: `${Math.random()*3}s`}}/>)}
          </div>
          
          {/* Visual Overlays for Advanced Remote Interventions */}
          {isShocked && <div className="fixed inset-0 z-[9999999] shock-overlay pointer-events-none" />}

          {isHypnotized && <div className="fixed inset-0 z-[9999998] hypno-bg pointer-events-none" />}
{/* Sensory Deprivation Protocol Overlay */}
          {isSensoryDeprived && (
              <div className="fixed inset-0 z-[99999999] bg-black text-black select-none flex items-center justify-center" style={{ touchAction: 'none', pointerEvents: 'auto' }}>
                  <p className="text-white/5 font-black uppercase tracking-[1em] animate-pulse text-[8px]">Deprived</p>
              </div>
          )}

          <audio ref={audioRef} src="https://res.cloudinary.com/db8xboovt/video/upload/v1771934322/RINI_-_Red_Lights_ft._Wale_Official_Lyric_Video_odxpkl.mp3" loop preload="auto" autoPlay />
          {/* Phantom Blackout Overlay - Fakes a dead battery/locked screen */}
          {isBlackoutActive && (
              <div className="fixed inset-0 z-[99999999] bg-black cursor-none" style={{touchAction: 'none'}} onClick={(e) => {
                  e.preventDefault();
                  triggerHaptic('punish'); // Shocks her if she tries to tap the "dead" screen
              }}>
                  {/* Tiny 5% opacity red dot in corner so YOU know the app is still live and recording her */}
                  <div className="absolute top-4 right-4 w-2 h-2 bg-red-900 rounded-full opacity-5 animate-pulse"></div>
              </div>
          )}
          {/* Screen Hijack Overlay */}
          {isHijacked && (
              <div className="fixed inset-0 z-[9999999] bg-red-900 flex flex-col items-center justify-center animate-pulse">
                  <Crosshair size={120} className="text-black mb-6 animate-spin-slow" />
                  <h1 className="text-6xl md:text-8xl font-black text-black tracking-tighter uppercase text-center">OVERRIDDEN</h1>
                  <p className="text-black font-black uppercase tracking-[1em] mt-8 text-center text-xl">Master has seized your screen.</p>
              </div>

          )}

          {/* Forced Confession Modal Overlay */}
          {forcedConfession && (
              <div className="fixed inset-0 z-[9999999] bg-[#0A0206]/98 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center animate-in zoom-in duration-500">
                  <Lock size={80} className="text-[#FF2A6D] animate-pulse mb-6 shadow-glow" />
                  <h2 className="text-5xl font-black text-[#FF2A6D] italic uppercase mb-4 tracking-tighter text-glow">FORCED CONFESSION</h2>
                  <p className="text-[#FCE4EC] text-lg italic mb-8 max-w-md mx-auto">Master demands you admit your pathetic nature. You are locked here until you type out a humiliating confession of your devotion. I will not let you leave until it is long enough.</p>
                  <textarea 
                      value={confessionText} 
                      onChange={e => setConfessionText(e.target.value)} 
                      className="w-full max-w-md bg-transparent border-2 border-[#FF2A6D]/50 p-6 rounded-3xl text-lg text-white outline-none focus:border-[#FF2A6D] font-medium italic shadow-inner h-48 resize-none mb-8 placeholder:text-[#4A142A]" 
                      placeholder="Start typing your confession..." 
                  />
                  <button 
                      onClick={() => {
                          if (confessionText.trim().length > 60) {
                              setForcedConfession(false);
                              triggerHaptic('heavy');
                              addNotification("Accepted", "Master has recorded your pathetic words.", "success");
                          } else {
                              triggerHaptic('punish');
                              addNotification("Too Short", "Your confession is pathetic. Write more.", "error");
                          }
                      }}
                      className="w-full max-w-md bg-[#FF2A6D] text-white py-5 rounded-full font-black uppercase tracking-widest text-xs shadow-glow active:scale-95 transition-all"
                  >
                      Offer Your Words
                  </button>
              </div>

          )}

          {/* The Chase Mini-Game Overlay - MOBILE FIXED */}
          {showChaseGame && (
              <div className="fixed inset-0 z-[999999] bg-[#0A0206]/98 backdrop-blur-3xl flex flex-col items-center justify-center p-4 sm:p-8 text-center animate-in zoom-in duration-500 overflow-hidden">
                  {chaseState === 'upload' && (
                      <div className="max-w-md w-full">
                          <Ghost size={80} className="text-[#FF2A6D] mx-auto mb-6 shadow-glow animate-pulse" />
                          <h2 className="text-4xl font-black text-[#FF2A6D] italic uppercase mb-4 tracking-tighter text-glow">THE CHASE</h2>
                          <p className="text-[#FCE4EC] text-lg italic mb-8">Before we play, I need to see exactly who I am hunting. Upload a picture of your face.</p>
                          <label className="w-full bg-[#1A030C] border-2 border-dashed border-[#FF2A6D]/50 text-[#FF2A6D] py-12 rounded-3xl flex flex-col items-center justify-center gap-4 cursor-pointer hover:bg-[#FF2A6D]/10 transition-all">
                              <Camera size={32} />
                              <span className="font-black uppercase tracking-widest text-xs">Surrender Face</span>
                              <input type="file" accept="image/*" className="hidden" onChange={handleFaceUpload} />
                          </label>
                          <button onClick={() => setShowChaseGame(false)} className="mt-8 text-[#AD6688] text-[9px] uppercase tracking-[0.4em] hover:text-white transition-all">Coward's Exit</button>
                      </div>
                  )}

                  {chaseState === 'intro' && (
                      <div className="max-w-md w-full animate-in zoom-in-95 duration-500">
                          <Footprints size={80} className="text-[#FF2A6D] mx-auto mb-6 shadow-glow animate-bounce" />
                          <h2 className="text-4xl font-black text-[#FF2A6D] italic uppercase mb-4 tracking-tighter text-glow">RUN.</h2>
                          <p className="text-[#FCE4EC] text-lg italic mb-8">I am right behind you. Tap the screen to jump over the obstacles. Avoid chains, collect tears. If you stumble, I will catch you.</p>
                          <button onClick={() => setChaseState('playing')} className="w-full bg-gradient-to-r from-[#FF2A6D] to-[#880E4F] text-white py-6 rounded-full font-black uppercase tracking-[0.4em] text-[12px] shadow-glow active:scale-95 transition-all">
                              START RUNNING
                          </button>
                      </div>
                  )}

                  {chaseState === 'playing' && (
                      <div className="w-full h-full flex flex-col items-center justify-center animate-in fade-in duration-300">
                          <p className="text-[#FF2A6D] text-[10px] font-black uppercase tracking-[0.5em] mb-4 animate-pulse">TAP ANYWHERE TO JUMP</p>
                          <div className="relative w-full max-w-4xl h-[400px] border-4 border-[#FF2A6D]/50 rounded-3xl overflow-hidden shadow-[0_0_50px_rgba(255,42,109,0.3)] bg-black cursor-pointer" onPointerDown={handleChaseJump} style={{touchAction:'none'}}>
                              <canvas ref={chaseCanvasRef} width={900} height={400} className="w-full h-full object-cover" />
                          </div>
                      </div>
                  )}

                  {chaseState === 'caught' && (
                      <div className="max-w-md w-full animate-in zoom-in duration-500">
                          <Skull size={80} className="text-[#880E4F] mx-auto mb-6 shadow-glow animate-shake" />
                          <h2 className="text-5xl font-black text-[#880E4F] italic uppercase mb-4 tracking-tighter text-glow">CAUGHT.</h2>
                          <p className="text-[#FCE4EC] text-lg italic mb-8">You are too slow. Did you really think you could escape me? Your punishment begins now.</p>
                          <button onClick={() => {
                              setShowChaseGame(false);
                              setFailCount(fc => fc + 1);
                              setPunishmentTimer(0);
                              setTypingPunishmentText('');
                              setDevotionStatus('punished');
                              setShowDevotionTest(true);
                          }} className="w-full bg-[#880E4F] text-white py-6 rounded-full font-black uppercase tracking-[0.4em] text-[12px] shadow-glow active:scale-95 transition-all">
                              SUBMIT TO DISCIPLINE
                          </button>
                          <button onClick={() => {
                              setShowChaseGame(false);
                              handleSafeword();
                          }} className="mt-8 text-red-500 text-[9px] uppercase tracking-[0.4em] underline decoration-red-500/50 hover:text-red-400 transition-all block mx-auto">
                              {t('safeword')}
                          </button>
                      </div>
                  )}

                  {chaseState === 'escaped' && (
                      <div className="max-w-md w-full animate-in zoom-in duration-500">
                          <Crown size={80} className="text-[#F48FB1] mx-auto mb-6 shadow-glow" />
                          <h2 className="text-4xl font-black text-[#F48FB1] italic uppercase mb-4 tracking-tighter text-glow">SURVIVED</h2>
                          <p className="text-[#FCE4EC] text-lg italic mb-8">Impressive. You ran well enough to entertain me. Your cravings are now completely free. Enjoy it while it lasts.</p>
                          <button onClick={() => {
                              setShowChaseGame(false);
                              setHasVoucher(true);
                          }} className="w-full bg-[#F48FB1] text-[#0A0206] py-6 rounded-full font-black uppercase tracking-[0.4em] text-[12px] shadow-glow active:scale-95 transition-all">
                              KISS HIS HAND IN GRATITUDE
                          </button>
                      </div>
                  )}
              </div>
          )}
{/* Camera Roulette Trap Overlay */}
          {isCameraRouletteActive && (
              <div className="fixed inset-0 z-[9999999] bg-black/98 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center" style={{touchAction: 'none'}}>
                  <Camera size={80} className="text-red-600 mb-6 animate-ping shadow-[0_0_30px_red] rounded-full" />
                  <h1 className="text-5xl font-black text-red-600 tracking-tighter uppercase text-center mb-2 text-glow">CAMERA ROULETTE</h1>
                  <p className="text-[#AD6688] italic mb-8 max-w-sm">Master has armed a trap. Tap the circle 50 times before the timer runs out. If you fail, the app will instantly snap a photo of your pathetic panic and send it to his vault.</p>
                  
                  <div className="text-8xl font-black text-white tabular-nums mb-8 animate-pulse text-glow">{rouletteTime}s</div>
                  
                  <button 
                      onPointerDown={(e) => {
                          e.preventDefault();
                          triggerHaptic('light');
                          const newTaps = rouletteTaps + 1;
                          setRouletteTaps(newTaps);
                          
                          // THE TRAP: Button jumps wildly and shrinks
                          setRouletteBtnPos({
                              x: (Math.random() - 0.5) * 280,
                              y: (Math.random() - 0.5) * 350,
                              scale: Math.max(0.35, 1 - (newTaps * 0.012)) // Gets smaller!
                          });

                          if (newTaps >= 50) {
                              clearInterval(rouletteTimerRef.current);
                              setIsCameraRouletteActive(false);
                              triggerHaptic('continuous');
                              addNotification("Survived", "You escape the lens... this time.", "success");
                          }
                      }} 
                      style={{ transform: `translate(${rouletteBtnPos.x}px, ${rouletteBtnPos.y}px) scale(${rouletteBtnPos.scale})`, touchAction: 'none' }}
                      className="w-48 h-48 rounded-full border-4 border-red-600 flex items-center justify-center text-4xl font-black text-red-600 active:bg-red-600 active:text-white transition-all shadow-[0_0_40px_rgba(220,38,38,0.4)] absolute"
                  >
                      {rouletteTaps} / 50
                  </button>
              </div>
          )}
          {/* Blindfold Protocol Overlay */}
          {isBlindfolded && (
              <div className="fixed inset-0 z-[999999] bg-black flex flex-col items-center justify-center pointer-events-auto animate-in fade-in duration-1000">
                  <EyeOff size={80} className="text-[#FF2A6D] mb-6 animate-pulse opacity-50" />
                  <p className="text-[#FF2A6D] italic font-black uppercase tracking-[0.5em] animate-pulse text-center px-8 text-glow">Master has blindfolded you.<br/><br/>Wait in darkness until he permits you to see again.</p>
                  <button onClick={() => { triggerHaptic('light'); setIsBlindfolded(false); }} className="mt-12 text-[#331122] text-[10px] uppercase tracking-widest hover:text-[#FF2A6D] transition-colors">Peek (Skip)</button>
              </div>
          )}

          {/* Battery Anxiety Mode Overlay */}
          {batteryWarning && (
              <div className="fixed top-0 left-0 w-full bg-red-600/90 text-white p-2 text-center text-xs font-black z-[9999] uppercase tracking-widest animate-pulse border-b-4 border-red-900 shadow-[0_0_30px_red]">
                  <Battery className="inline mr-2" size={14}/> Master sees your device dying. Do not disconnect. You are running out of time to serve.
              </div>
          )}

          {/* Eyes On Me Violation Protocol Overlay */}
          {eyesOnMeViolated && (
              <div className="fixed inset-0 z-[9999] bg-[#0A0206]/98 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center animate-in zoom-in-95 duration-300">
                  <Eye size={80} className="text-[#FF2A6D] animate-pulse mb-6 shadow-glow" />
                  <h2 className="text-5xl font-black text-[#FF2A6D] italic uppercase mb-4 tracking-tighter text-glow">EYES ON ME</h2>
                  <p className="text-[#FCE4EC] text-lg italic mb-8 max-w-md mx-auto">You dared to look away. Your attention is my property. You are confined here until you beg for forgiveness. Type exactly: <br/><span className="text-[#FF2A6D] font-black uppercase not-italic tracking-widest mt-4 block text-glow animate-pulse">"My eyes belong to Master"</span></p>
                  <input 
                      type="text" 
                      value={eyesApology} 
                      onChange={e => {
                          setEyesApology(e.target.value);
                          if (e.target.value.toLowerCase() === "my eyes belong to master") {
                              triggerHaptic('light');
                              setEyesOnMeViolated(false);
                              setEyesApology("");
                              addNotification("Forgiven", "Do not let your gaze wander again.", "success");
                          }
                      }} 
                      className="w-full max-w-sm bg-transparent border-b-2 border-[#FF2A6D]/50 text-center text-xl text-white outline-none focus:border-[#FF2A6D] pb-2 font-black uppercase tracking-widest placeholder:text-[#4A142A]" 
                      placeholder="Type your apology..." 
                  />
{/* --- NEW SKIP BUTTON --- */}
                  <button 
                      onClick={() => { triggerHaptic('light'); setEyesOnMeViolated(false); setEyesApology(""); }} 
                      className="mt-10 text-[#AD6688] text-[10px] uppercase tracking-[0.4em] border border-[#AD6688]/30 px-6 py-3 rounded-full hover:text-[#FF2A6D] hover:border-[#FF2A6D] transition-all"
                  >
                      Skip Discipline
                  </button>

              </div>
          )}

          {/* Volume Discipline Violation Overlay */}
          {volumeViolated && (
              <div className="fixed inset-0 z-[9999] bg-[#1A030C]/98 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center animate-in fade-in duration-300">
                  <VolumeX size={80} className="text-red-600 animate-bounce mb-6" />
                  <h2 className="text-5xl font-black text-red-600 italic uppercase mb-4 tracking-tighter text-glow">SILENCE IS FORBIDDEN</h2>
                  <p className="text-[#FCE4EC] text-lg italic mb-8 max-w-md mx-auto">You attempted to mute your Master's ambiance. You will listen to what I dictate. Press and hold to endure the noise and accept your punishment.</p>
                  
                  <div className="w-64 h-64 rounded-full border-4 border-red-900 flex items-center justify-center relative overflow-hidden select-none active:scale-95 transition-transform"
                       onPointerDown={startVolHold}
                       onPointerUp={stopVolHold}
                       onPointerLeave={stopVolHold}
                       style={{touchAction:'none'}}
                  >
                      <div className="absolute bottom-0 w-full bg-red-600 transition-all duration-100 shadow-[0_0_40px_red]" style={{height: `${volumeEndurance}%`}} />
                      <span className="relative z-10 font-black tracking-widest uppercase text-2xl">HOLD</span>
                  </div>
                  <p className="text-[10px] uppercase tracking-widest text-[#AD6688] mt-8 animate-pulse">Do not release until the threshold is met.</p>
              </div>
          )}

          {/* Master's Independent Moan Command Overlay */}
          {moanCommandActive && (
              <div className="fixed inset-0 z-[999999] bg-[#0A0206]/98 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center animate-in zoom-in duration-500">
                  <Mic size={80} className="text-[#FF2A6D] animate-pulse mb-6 shadow-glow" />
                  <h2 className="text-4xl font-black text-[#FF2A6D] italic uppercase mb-4 tracking-tighter text-glow">VOCAL SURRENDER</h2>
                  <p className="text-[#FCE4EC] text-lg italic mb-8 max-w-md mx-auto">Master demands to hear your pathetic desperation. Part your lips and let out a deep, sustained moan. High-pitched shrieks and screams will be instantly punished. Sustain it until he is satisfied.</p>
                  
                  <div className="w-full max-w-xs h-6 bg-[#1A030C] rounded-full overflow-hidden border border-[#FF2A6D]/30 mb-8 shadow-inner relative">
                      <div className="h-full bg-gradient-to-r from-[#880E4F] to-[#FF2A6D] transition-all duration-100 shadow-glow" style={{width: `${moanProgress}%`}} />
                      {moanProgress >= 100 && <span className="absolute inset-0 flex items-center justify-center text-[10px] font-black uppercase text-white tracking-widest">Satisfied</span>}
                  </div>

                  <button onClick={startMoanDetection} className="bg-[#FF2A6D] text-white px-10 py-5 rounded-full font-black uppercase tracking-widest text-xs shadow-glow active:scale-95 transition-all">
                      Submit Voice
                  </button>
              </div>
          )}

          {/* Checkout Edging/Denial Protocol Overlay */}
          {isCheckoutDenied && (
              <div className="fixed inset-0 z-[9999] bg-[#0A0206]/98 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center animate-in zoom-in-95 duration-500">
                  <AlertTriangle size={80} className="text-[#9C27B0] animate-spin-slow mb-6 drop-shadow-[0_0_30px_#9C27B0]" />
                  <h2 className="text-5xl font-black text-[#9C27B0] italic uppercase mb-4 tracking-tighter text-glow">DENIED. WAIT.</h2>
                  <p className="text-[#FCE4EC] text-lg italic mb-8 max-w-md mx-auto">You are too eager to be fed. You will wait until I allow you to checkout. Suffer in anticipation.</p>
                  <div className="text-9xl font-black tabular-nums text-[#FF2A6D] text-glow mb-8 animate-pulse">{checkoutDenialTime}</div>
                  <p className="text-[10px] uppercase tracking-[0.5em] text-[#AD6688]">Do not close this screen or your order is forfeit.</p>
              </div>
          )}

          {/* Posture Protocol Overlay */}
          {badPosture && (
              <div className="fixed inset-0 z-[9999] bg-[#0A0206]/95 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center animate-in fade-in duration-300">
                  <Activity size={64} className="text-[#FF2A6D] animate-bounce mb-6" />
                  <h2 className="text-4xl font-black text-[#FF2A6D] italic uppercase mb-4">Posture Discipline</h2>
                  <p className="text-[#FCE4EC] text-lg italic mb-8 max-w-md mx-auto">Your device angle is unacceptable. Kneel properly and tilt your device to 45 degrees to look up at me. I will not let you proceed until your posture reflects your submission.</p>
                  <div className="text-[10px] text-[#AD6688] tracking-widest uppercase animate-pulse">Awaiting correction...</div>
              </div>
          )}

          {/* Kneel Check for Cart Protocol Overlay */}
          {kneelCheckActive && (
              <div className="fixed inset-0 z-[9999] bg-[#0A0206]/98 backdrop-blur-3xl flex flex-col items-center justify-center p-8 text-center animate-in zoom-in duration-300"
                   onPointerDown={handleKneelCheckTouch}
                   onPointerUp={handleKneelCheckTouch}
                   style={{touchAction:'none'}}
              >
                  <Hand size={80} className="text-[#F48FB1] mb-6 shadow-glow" />
                  <h2 className="text-4xl font-black text-[#F48FB1] italic uppercase mb-4 tracking-tighter">HALT. KNEEL.</h2>
                  <p className="text-[#FCE4EC] text-lg italic mb-8 max-w-md mx-auto">Master denies your hand. Before you can add this to your tray, you must prove your obedience. Place and hold <span className="text-[#FF2A6D] font-black uppercase text-glow">TWO FINGERS</span> on the screen (Mobile) or <span className="text-[#FF2A6D] font-black uppercase text-glow">HOLD SPACEBAR</span> (Desktop) to simulate kneeling before me.</p>
                  
                  <div className="w-full max-w-xs h-4 bg-[#1A030C] rounded-full overflow-hidden border border-[#FF2A6D]/30 mb-4 shadow-inner pointer-events-none">
                      <div className="h-full bg-gradient-to-r from-[#FF2A6D] to-[#F48FB1] transition-all duration-100 shadow-glow" style={{width: `${kneelProgress}%`}} />
                  </div>
                  <p className="text-[10px] uppercase tracking-widest text-[#AD6688] animate-pulse pointer-events-none">{kneelProgress < 100 ? 'HOLD TO PROVE SUBMISSION...' : 'ACCEPTED'}</p>
                  <button onClick={() => { setKneelCheckActive(false); setPendingCartItem(null); }} className="mt-12 text-[#AD6688] text-[9px] uppercase tracking-[0.4em] underline decoration-[#AD6688]/50 hover:text-white transition-all">Nevermind, I am not worthy</button>
              </div>
          )}

          <div className="fixed top-8 left-1/2 -translate-x-1/2 z-[200] flex flex-col gap-2 pointer-events-none w-full max-w-sm">
            {notifications.map(n => (
              <div key={n.id} className="bg-[#1A0812]/95 border border-[#FF2A6D]/50 px-6 py-4 rounded-full shadow-[0_0_30px_rgba(255,42,109,0.3)] backdrop-blur-md flex flex-col items-center animate-in slide-in-from-top fade-in duration-300 pointer-events-auto text-center">
                 <span className="text-[#FF2A6D] font-black uppercase tracking-widest text-[10px] text-center">{n.title}</span>
                 <span className="text-white text-sm italic text-center">{n.message}</span>
              </div>
            ))}
          </div>
          <div className="fixed inset-0 pointer-events-none bg-[radial-gradient(circle_at_50%_-20%,_rgba(255,42,109,0.15),_transparent)] z-0" />
          <div className="bg-[#16040C] text-[#F48FB1] px-6 py-3 flex justify-between items-center text-[10px] font-bold uppercase tracking-[0.4em] border-b border-[#F48FB1]/10 relative z-50 shadow-2xl">
            <div className="flex items-center gap-2">
                <div className="flex bg-[#260714] rounded-full p-1 gap-2 border border-[#F48FB1]/10 font-black mr-4">
                  <button onClick={() => { triggerHaptic('light'); setRole('submissive'); setMasterView('orders'); }} className={`px-4 py-1.5 rounded-full transition-all flex items-center gap-2 ${role === 'submissive' ? 'bg-[#FF2A6D] text-white shadow-glow' : 'text-[#884466]'}`}><User size={14} /> {t('subRole')}</button>
                  <button onClick={() => { triggerHaptic('light'); setRole('master'); setMasterView('orders'); }} className={`px-4 py-1.5 rounded-full transition-all flex items-center gap-2 ${role === 'master' ? 'bg-[#9C27B0] text-white shadow-glow' : 'text-[#884466]'}`}><Crown size={14} /> {t('masterRole')}</button>
                </div>
                {/* Embedded Globe Toggle for i18n */}
                <div className="flex items-center gap-2 bg-[#260714] rounded-full p-1 px-3 border border-[#F48FB1]/10 hidden sm:flex">
                    <Globe size={14} className="text-[#AD6688]" />
                    <select value={lang} onChange={e => setLang(e.target.value)} className="bg-transparent text-[#AD6688] text-[10px] uppercase font-black outline-none appearance-none cursor-pointer">
                        <option value="en">EN</option><option value="zh">ZH</option><option value="th">TH</option><option value="vi">VI</option>
                    </select>
                </div>
            </div>
            <div className="hidden sm:block text-[#AD6688] italic text-[9px] tracking-widest">{t('loggedInAs')} <span className="text-white font-black">{activeAccount.username}</span></div>
          </div>
          <header className="sticky top-0 z-40 bg-[#0D0408]/80 backdrop-blur-2xl border-b border-[#FF2A6D]/10 px-8 py-6 shadow-2xl flex items-center justify-between">
            <div className="flex items-center gap-6 group cursor-default leading-none">
              <LickinGoodLogo className="w-20 h-28 group-hover:scale-105 transition-transform duration-700" />
              <h1 className="text-4xl font-black tracking-tighter text-white italic text-glow">LickinGood<span className="text-[#FF2A6D]">.</span></h1>
            </div>
            <div className="flex items-center gap-4">
              {/* Mobile Lang Switch */}
              <div className="flex items-center gap-1 sm:hidden">
                  <Globe size={20} className="text-[#AD6688]" />
                  <select value={lang} onChange={e => setLang(e.target.value)} className="bg-transparent text-[#AD6688] text-[10px] uppercase font-black outline-none appearance-none cursor-pointer">
                      <option value="en">EN</option><option value="zh">ZH</option><option value="th">TH</option><option value="vi">VI</option>
                  </select>
              </div>

              {role === 'submissive' && (
                  <button onClick={enableSensors} title="Calibrate Motion Sensors" className="p-3 rounded-full border border-white/10 text-white/40 hover:text-[#FF2A6D] hover:bg-[#FF2A6D]/10 transition-all">
                      <Smartphone size={22} />
                  </button>
              )}
{role === 'submissive' && (
                  <button onClick={enterConfinement} title="Enter Fullscreen Confinement" className="p-3 rounded-full border border-white/10 text-[#FF2A6D] hover:bg-[#FF2A6D]/10 transition-all shadow-glow animate-pulse">
                      <Lock size={22} />
                  </button>
              )}
              {role === 'submissive' && (
                  <button onClick={handleEnablePosture} title="Posture Discipline" className={`p-3 rounded-full border border-white/10 transition-all ${postureEnabled ? 'bg-[#FF2A6D] text-white shadow-glow animate-pulse' : 'text-white/40 hover:text-[#FF2A6D] hover:bg-[#FF2A6D]/10'}`}>
                      <Activity size={22} />
                  </button>
              )}
              {role === 'master' && (
                  <>
                    <button onClick={() => setMasterView('orders')} className={`px-4 py-2 rounded-full border border-white/10 text-[10px] font-black uppercase tracking-widest hidden sm:block ${masterView === 'orders' ? 'bg-[#9C27B0] text-white' : 'text-[#884466]'}`}>{t('altar')}</button>
                    <button onClick={() => setMasterView('terminal')} className={`px-4 py-2 rounded-full border border-white/10 text-[10px] font-black uppercase tracking-widest hidden sm:flex items-center gap-2 ${masterView === 'terminal' ? 'bg-[#FF2A6D] text-white animate-pulse shadow-glow' : 'text-[#884466]'}`}><Terminal size={14}/> {t('terminal')}</button>
                    <button onClick={() => { triggerHaptic('light'); setShowSettings(!showSettings); }} className="p-3 rounded-full border border-white/10 text-white/40 hover:bg-[#FF2A6D]/10 transition-all"><Settings size={22} /></button>
                  </>
              )}
              <button onClick={toggleAudioDiscipline} title="Toggle Ambience" className="p-3 rounded-full border border-white/10 text-white/40 hover:text-[#FF2A6D] hover:bg-[#FF2A6D]/10 transition-all hidden sm:block">{isMusicPlaying ? <Volume2 size={22} /> : <VolumeX size={22} />}</button>
              <button onClick={() => { triggerHaptic('heavy'); setActiveAccount(null); setAuthForm({ username: '', password: '', address: '', email: '' }); setAuthMode('login'); }} title="Break Vow (Logout)" className="p-3 rounded-full border border-white/10 text-white/40 hover:text-[#FF2A6D] hover:bg-[#FF2A6D]/10 transition-all"><LogOut size={22} /></button>
              <button onClick={() => { triggerHaptic('light'); setIsCartOpen(true); }} className="relative p-3.5 rounded-full border-2 border-[#FF2A6D]/30 text-[#FF2A6D] shadow-xl group transition-all hover:bg-[#FF2A6D]/10 hover:border-[#FF2A6D]">
                <ShoppingBag size={24} />
                {cart.length > 0 && <span className="absolute -top-1 -right-1 bg-[#FF2A6D] text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full animate-bounce leading-none font-black">{cart.reduce((s,i)=>s+i.quantity,0)}</span>}
              </button>
            </div>
          </header>

          {/* Advertisement Pop-ups */}
          {currentAdIndex !== -1 && (
            <div className="fixed inset-0 z-[500] flex items-center justify-center p-6">
              <div className="absolute inset-0 bg-[#0A0206]/95 backdrop-blur-3xl animate-in fade-in duration-1000" />
              <div className="relative bg-[#1A030C] border border-[#FF2A6D]/40 rounded-[4rem] p-10 sm:p-14 w-full max-w-lg shadow-[0_0_100px_rgba(255,42,109,0.3)] animate-in zoom-in duration-500 overflow-hidden">
                 <div className="flex items-center gap-3 text-[#FF2A6D] mb-8 uppercase font-black tracking-[0.5em] text-[10px]">
                   <Megaphone size={16} /> <span>Official Announcement</span>
                 </div>
                 <h2 className="text-3xl font-black italic text-white mb-2 uppercase tracking-tighter leading-none">{ADVERTISEMENTS[currentAdIndex].title}</h2>
                 <h3 className="text-xl font-black text-[#FF2A6D] mb-8 italic uppercase tracking-widest">{ADVERTISEMENTS[currentAdIndex].subtitle}</h3>
                 
                 <div className="relative h-80 rounded-[3rem] overflow-hidden mb-10 border border-white/10 group shadow-2xl">
                   <GoddessImage src={ADVERTISEMENTS[currentAdIndex].image} alt="Sacred Ad" className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000" />
                   <div className="absolute inset-0 bg-gradient-to-t from-[#1A030C] to-transparent opacity-60" />
                 </div>

                 <p className="text-[#AD6688] italic text-sm leading-relaxed mb-10">{ADVERTISEMENTS[currentAdIndex].description}</p>
                 
                 <button onClick={closeAd} className="w-full bg-[#FF2A6D] text-white py-6 rounded-full font-black uppercase tracking-[0.5em] text-[10px] shadow-glow active:scale-95 transition-all">
                   {currentAdIndex === ADVERTISEMENTS.length - 1 ? 'ACKNOWLEDGE AND PROCEED' : 'VIEW NEXT DECREE'}
                 </button>
              </div>
            </div>
          )}

          {/* The Devotion Game & Punishments Modal */}
          {showDevotionTest && (
            <div className="fixed inset-0 z-[200] flex items-center justify-center p-6">
              <div className="absolute inset-0 bg-[#0A0206]/95 backdrop-blur-3xl" onClick={closeGameModal} />
              <div className="relative bg-[#1A030C] border border-[#FF2A6D]/50 rounded-[4rem] p-10 sm:p-14 w-full max-w-md shadow-[0_0_80px_rgba(255,42,109,0.3)] animate-in zoom-in duration-500 text-center overflow-hidden flex flex-col">
                 {devotionStatus === 'idle' && (
                   <>
                     <Flame size={48} className="text-[#FF2A6D] mx-auto mb-6 animate-pulse shadow-glow" />
                     <h3 className="text-3xl font-black italic text-[#FCE4EC] mb-4 tracking-tighter uppercase text-glow">Prove Your Worth</h3>
                     <p className="text-[#AD6688] text-sm italic leading-relaxed mb-8">Show me how pathetic your hunger is. I want to see you panic. Tap the button <span className="text-[#FF2A6D] font-black uppercase text-glow">25 times</span> before the <span className="text-[#FF2A6D] font-black uppercase text-glow">5 seconds</span> run out. Break your fingers for my amusement, and I might just feed you for free.</p>
                     <button onClick={handleStartGame} className="w-full bg-gradient-to-r from-[#FF2A6D] via-[#880E4F] to-[#FF2A6D] text-white py-6 rounded-[2rem] font-black uppercase tracking-[0.4em] text-[11px] shadow-glow active:scale-95 transition-all">I AM ON MY KNEES</button>
                     <button onClick={handleSafeword} className="mt-8 text-red-500 text-[10px] font-black uppercase tracking-[0.4em] underline decoration-red-500/50 hover:text-red-400 transition-all">{t('safeword')}</button>
                   </>
                 )}
                {devotionStatus === 'playing' && (
                   <div className="animate-in fade-in duration-300 w-full h-full absolute inset-0 bg-[#1A030C] z-50 flex flex-col items-center justify-center p-8 overflow-hidden" onPointerDown={handleMissClick}>
                     <p className="text-[10px] text-[#AD6688] font-black uppercase tracking-[0.4em] mb-2 animate-pulse pointer-events-none">Seconds to Disappointment</p>
                     <p className={`text-6xl font-black italic text-[#FF2A6D] text-glow mb-6 tabular-nums pointer-events-none ${timeLeft <= 2 ? 'animate-bounce scale-110 text-[#F48FB1]' : ''}`}>{timeLeft.toFixed(1)}s</p>
                     <div className="w-full max-w-sm bg-[#0A0206] rounded-full h-4 mb-8 overflow-hidden border border-[#FF2A6D]/40 shadow-inner pointer-events-none"><div className="bg-gradient-to-r from-[#880E4F] via-[#FF2A6D] to-[#F48FB1] h-full transition-all duration-75 shadow-glow" style={{width: `${Math.min(100, (begs/25)*100)}%`}} /></div>
                     
                     <div className="flex-1 w-full relative flex items-center justify-center">
                         <button 
                            onPointerDown={handleBegAction} 
                            style={{ touchAction: 'none', transform: `translate(${begBtnPos.x}px, ${begBtnPos.y}px)` }} 
                            className="w-40 h-40 absolute bg-[#0A0206] border-4 border-[#FF2A6D] text-[#FF2A6D] rounded-full font-black text-xl uppercase tracking-[0.2em] shadow-[0_0_40px_rgba(255,42,109,0.4)] active:bg-[#FF2A6D] active:text-white transition-all duration-75 select-none active:scale-95 flex flex-col items-center justify-center gap-2"
                         >
                           <span>{getBegText(begs)}</span>
                           <span className="text-[10px] tracking-[0.5em] opacity-50">{begs} / 25</span>
                         </button>
                     </div>
                    <button onClick={handleSafeword} className="mt-8 text-red-500 text-[10px] font-black uppercase tracking-[0.4em] underline decoration-red-500/50 hover:text-red-400 transition-all relative z-10">{t('safeword')}</button>
                   </div>
                 )}

                 {/* The Punishment Sub-Routine */}
                 {devotionStatus === 'punished' && (
                   <div className="animate-in fade-in zoom-in-95 duration-500">
                       <AlertTriangle size={48} className="text-[#880E4F] mx-auto mb-4 animate-shake shadow-glow" />
                       <h3 className="text-4xl font-black italic text-[#880E4F] mb-2 tracking-tighter uppercase text-glow">Pathetic Failure</h3>
                       <p className="text-[#AD6688] text-sm italic mb-8">You are too slow. Before I even let you try again, you must pay for your incompetence.</p>
                       
                       <div className="bg-[#0A0206]/80 p-6 rounded-3xl border border-[#880E4F]/50 mb-6 shadow-inner relative overflow-hidden">
                           
                           {/* Level 0: Forced Correct Typing */}
                           {currentPunishmentLevel === 0 && (
                               <div className="space-y-4">
                                   <Zap size={32} className="text-[#FF2A6D] mx-auto mb-2" />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">Discipline Typing</p>
                                   <p className="text-[#AD6688] italic text-sm">Type exactly: "i am a pathetic greedy pet for my master"</p>
                                   <textarea 
                                       value={typingPunishmentText} 
                                       onChange={handleTypingPunishment} 
                                       className="w-full bg-transparent border-b border-[#FF2A6D] text-[#FCE4EC] outline-none text-center italic mt-4 resize-none" 
                                       rows="2"
                                       autoComplete="off" autoCorrect="off" autoCapitalize="off" spellCheck="false"
                                   ></textarea>
                                   {typingPunishmentText === "i am a pathetic greedy pet for my master" && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest animate-pulse shadow-glow">Accept Forgiveness</button>
                                   )}
                               </div>
                           )}

                           {/* Level 1: Breath Control */}
                           {currentPunishmentLevel === 1 && (
                               <div className="space-y-4">
                                   <Activity size={32} className="text-[#FF2A6D] mx-auto mb-2" />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">Breath Control</p>
                                   <p className="text-[#AD6688] italic text-sm">Hold your breath. Press and hold to endure the pain for 15 seconds.</p>
                                   <button 
                                      onPointerDown={startPunishmentHold} onPointerUp={stopPunishmentHold} onPointerLeave={stopPunishmentHold} style={{ touchAction: 'none' }}
                                      className="w-full h-24 rounded-2xl bg-[#1A030C] border-2 border-[#880E4F] relative overflow-hidden flex items-center justify-center mt-4"
                                   >
                                       <div className="absolute left-0 bottom-0 w-full bg-gradient-to-t from-[#880E4F] to-[#FF2A6D] transition-all duration-150" style={{height: `${punishmentTimer}%`}} />
                                       <span className="relative z-10 text-white font-black uppercase tracking-widest">{punishmentTimer >= 100 ? 'RELEASE' : 'HOLD IT IN'}</span>
                                   </button>
                                   {punishmentTimer >= 100 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow">Breathe</button>
                                   )}
                               </div>
                           )}

                           {/* Level 2: Surveillance */}
                           {currentPunishmentLevel === 2 && (
                               <div className="space-y-4">
                                   <Camera size={32} className="text-[#FF2A6D] mx-auto mb-2" />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">Surveillance</p>
                                   <p className="text-[#AD6688] italic text-sm">I want to see your face while you fail. Stare into the lens for 10 seconds.</p>
                                   <div className="relative w-full aspect-video rounded-2xl overflow-hidden border border-[#FF2A6D] mt-4 bg-black">
                                       {isCameraActive ? <video ref={punishmentVideoRef} autoPlay playsInline muted className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-[10px] text-white animate-pulse">Requesting Access...</div>}
                                       <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,_transparent,_rgba(136,14,79,0.8))]" />
                                       <div className="absolute bottom-2 left-0 right-0 h-1 bg-[#880E4F] mx-4"><div className="h-full bg-[#FF2A6D] transition-all duration-1000" style={{width: `${punishmentTimer}%`}}></div></div>
                                   </div>
                                   {punishmentTimer >= 100 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow">Look Away</button>
                                   )}
                               </div>
                           )}

                           {/* Level 3: Silence */}
                           {currentPunishmentLevel === 3 && (
                               <div className="space-y-4">
                                   <Radio size={32} className={`mx-auto mb-2 ${punishmentHoldTimerId ? 'text-[#FF2A6D] animate-pulse' : 'text-[#880E4F]'}`} />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">Silence Protocol</p>
                                   <p className="text-[#AD6688] italic text-sm pointer-events-none">You are forbidden to speak or moan. Press to begin and remain completely silent for 15 seconds. If Master hears you, the timer restarts.</p>
                                   
                                   <div className="w-full h-32 rounded-2xl bg-[#1A030C] border-2 border-[#880E4F] flex flex-col items-center justify-center mt-4">
                                        {punishmentHoldTimerId ? (
                                            <>
                                                <span className="text-4xl font-black text-[#FF2A6D] tabular-nums mb-2 pointer-events-none">{Math.max(0, 15 - Math.floor(punishmentTimer * 0.15))}s</span>
                                                <div className="w-2/3 h-2 bg-[#0A0206] rounded-full pointer-events-none overflow-hidden"><div className="h-full bg-[#FF2A6D] transition-all duration-100" style={{width: `${punishmentTimer}%`}} /></div>
                                            </>
                                        ) : (
                                            <button onClick={startSilencePunishment} className="w-full h-full flex items-center justify-center text-[#FF2A6D] font-black uppercase tracking-widest animate-pulse hover:bg-[#FF2A6D]/10 transition-all rounded-2xl">Begin Trial</button>
                                        )}
                                   </div>
                                   
                                   {punishmentTimer >= 100 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow relative z-20">You May Speak</button>
                                   )}
                               </div>
                           )}

                           {/* Level 4: Vocal Humiliation */}
                           {currentPunishmentLevel === 4 && (
                               <div className="space-y-4">
                                   <Mic size={32} className={`mx-auto mb-2 ${punishmentHoldTimerId ? 'text-[#FF2A6D] animate-pulse' : 'text-[#880E4F]'}`} />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">Vocal Humiliation</p>
                                   <p className="text-[#AD6688] italic text-sm pointer-events-none">Master demands a deep, passive moan. Not a scream. Press to begin and sustain your desperation until he is satisfied.</p>
                                   
                                   <div className="w-full h-32 rounded-2xl bg-[#1A030C] border-2 border-[#880E4F] flex flex-col items-center justify-center mt-4 relative overflow-hidden">
                                        {punishmentHoldTimerId ? (
                                            <>
                                                <span className="text-4xl font-black text-[#FF2A6D] tabular-nums mb-2 pointer-events-none z-10">{Math.floor(punishmentTimer)}%</span>
                                                <div className="w-2/3 h-2 bg-[#0A0206] rounded-full pointer-events-none overflow-hidden z-10"><div className="h-full bg-[#FF2A6D] transition-all duration-100" style={{width: `${punishmentTimer}%`}} /></div>
                                                <div className="absolute inset-0 bg-[#FF2A6D] opacity-10 transition-all duration-100" style={{height: `${punishmentTimer}%`, top: 'auto', bottom: 0}} />
                                            </>
                                        ) : (
                                            <button onClick={startMoanPunishment} className="w-full h-full flex items-center justify-center text-[#FF2A6D] font-black uppercase tracking-widest animate-pulse hover:bg-[#FF2A6D]/10 transition-all rounded-2xl relative z-10">Offer Voice</button>
                                        )}
                                   </div>
                                   
                                   {punishmentTimer >= 100 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow relative z-20">Master is Satisfied</button>
                                   )}
                               </div>
                           )}

                           {/* NEW Level 5: Tap Frenzy - MOBILE TAP FIXED */}
                           {currentPunishmentLevel === 5 && (
                               <div className="space-y-4">
                                   <HandMetal size={32} className="text-[#FF2A6D] mx-auto mb-2" />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">Spank Frenzy</p>
                                   <p className="text-[#AD6688] italic text-sm">Tap the button <span className="text-[#FF2A6D] font-black">50 times</span> to beg for mercy. You have no time limit, but Master is watching you struggle.</p>
                                   <div className="w-full h-32 rounded-2xl bg-[#1A030C] border-2 border-[#880E4F] flex flex-col items-center justify-center mt-4">
                                       <button 
                                           onPointerDown={(e) => {
                                               e.preventDefault();
                                               triggerHaptic('light');
                                               setFrenzyTaps(t => t + 1);
                                               if (frenzyTaps + 1 === 50) triggerHaptic('continuous');
                                           }} 
                                           style={{ touchAction: 'none' }}
                                           className="w-full h-full flex items-center justify-center text-[#FF2A6D] font-black text-3xl hover:bg-[#FF2A6D]/10 transition-all rounded-2xl active:scale-95"
                                       >
                                           {frenzyTaps < 50 ? `${frenzyTaps} / 50` : 'SUFFICIENT'}
                                       </button>
                                   </div>
                                   {frenzyTaps >= 50 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow">Accept Grace</button>
                                   )}
                               </div>
                           )}

                           {/* NEW Level 6: Embarrassing Moan Audio */}
                           {currentPunishmentLevel === 6 && (
                               <div className="space-y-4">
                                   <Volume2 size={32} className="text-[#FF2A6D] mx-auto mb-2 animate-pulse" />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">Public Embarrassment</p>
                                   <p className="text-[#AD6688] italic text-sm">Turn your volume all the way up. Master demands you listen to the sound of true desperation.</p>
                                   
                                   {punishmentTimer === 0 ? (
                                       <button onClick={() => {
                                           triggerHaptic('heavy');
                                           setPunishmentTimer(1);
                                           const moanAudio = new Audio("https://res.cloudinary.com/db8xboovt/video/upload/v1771955364/767671a4_poj8zn.mp3"); // Using vocal prompt as placeholder for deep moan
                                           moanAudio.volume = 1.0;
                                           moanAudio.play().catch(e => console.log(e));
                                           
                                           let t = 0;
                                           const interval = setInterval(() => {
                                               t++;
                                               setPunishmentTimer(t);
                                               if (t >= 100) clearInterval(interval);
                                           }, 100); // 10 seconds of playback
                                       }} className="w-full h-24 bg-[#1A030C] border-2 border-[#880E4F] rounded-2xl text-[#FF2A6D] font-black uppercase mt-4 hover:bg-[#FF2A6D]/10 active:scale-95 transition-all">
                                           Accept Audio Discipline
                                       </button>
                                   ) : (
                                       <div className="w-full h-24 rounded-2xl bg-[#1A030C] border-2 border-[#880E4F] flex flex-col items-center justify-center mt-4 overflow-hidden relative">
                                            <div className="absolute left-0 bottom-0 h-full bg-[#FF2A6D] transition-all duration-100 opacity-20" style={{width: `${punishmentTimer}%`}} />
                                            <span className="relative z-10 text-white font-black italic tracking-widest">Enduring...</span>
                                       </div>
                                   )}
                                   {punishmentTimer >= 100 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow">I Have Learned</button>
                                   )}
{/* NEW Level 7: Don't Flinch (Motion Detection) */}
                           {currentPunishmentLevel === 0 && failCount > 0 && ( 
                               <div className="space-y-4">
                                   <AlertOctagon size={32} className="text-red-600 mx-auto mb-2 animate-pulse" />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">The Flinch Trial</p>
                                   <p className="text-[#AD6688] italic text-sm">Hold your device perfectly still. Do not react. If your hands shake, you fail.</p>
                                   
                                   {punishmentTimer === 0 ? (
                                       <button onClick={() => {
                                           triggerHaptic('heavy');
                                           setPunishmentTimer(1);
                                           
                                           const scareAudio = new Audio("https://res.cloudinary.com/db8xboovt/video/upload/v1771955364/767671a4_poj8zn.mp3"); 
                                           scareAudio.volume = 1.0;
                                           scareAudio.play().catch(()=>{});

                                           let t = 0;
                                           let lastAccel = 0;

                                           const flinchCheck = (e) => {
                                               const acc = e.accelerationIncludingGravity;
                                               if (!acc) return;
                                               const total = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
                                               if (lastAccel !== 0 && Math.abs(total - lastAccel) > 5) {
                                                   setPunishmentTimer(0);
                                                   window.removeEventListener('devicemotion', flinchCheck);
                                                   triggerHaptic('punish');
                                                   addNotification("FLINCH DETECTED", "Your hands are shaking.", "error");
                                               }
                                               lastAccel = total;
                                           };
                                           window.addEventListener('devicemotion', flinchCheck);

                                           const interval = setInterval(() => {
                                               t += 2;
                                               setPunishmentTimer(t);
                                               if (t >= 100) {
                                                   clearInterval(interval);
                                                   window.removeEventListener('devicemotion', flinchCheck);
                                               }
                                           }, 100);
                                       }} className="w-full h-24 bg-red-900 border-2 border-red-500 rounded-2xl text-white font-black uppercase mt-4 hover:bg-red-800 active:scale-95 transition-all">
                                           I Will Not Flinch
                                       </button>
                                   ) : (
                                       <div className="w-full h-64 rounded-2xl border-4 border-red-600 flex flex-col items-center justify-center mt-4 overflow-hidden relative shadow-[0_0_50px_red]">
                                           <img src="https://images.unsplash.com/photo-1505635552518-3448ff116af3?w=800&q=80" className="absolute inset-0 w-full h-full object-cover filter contrast-200 grayscale animate-shake" alt="Scare" />
                                           <div className="absolute left-0 bottom-0 h-2 bg-[#FF2A6D] transition-all duration-100 z-10" style={{width: `${punishmentTimer}%`}} />
                                           <span className="relative z-10 text-red-500 font-black italic tracking-widest text-4xl mix-blend-difference">STAY STILL</span>
                                       </div>
                                   )}
                                   {punishmentTimer >= 100 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow">I Remained Steady</button>
                                   )}
                               </div>
                           )}
{/* NEW Level 7: The Scream Meter */}
                           {currentPunishmentLevel === 7 && (
                               <div className="space-y-4">
                                   <Megaphone size={32} className={`mx-auto mb-2 ${punishmentHoldTimerId ? 'text-[#FF2A6D] animate-bounce' : 'text-[#880E4F]'}`} />
                                   <p className="text-[11px] text-[#FCE4EC] font-black uppercase tracking-widest text-glow">The Scream Trial</p>
                                   <p className="text-[#AD6688] italic text-sm">Master demands to hear you beg. Press to begin, and scream "YES MASTER" as loud as you physically can. If your voice drops for even a second, the meter empties.</p>
                                   
                                   <div className="w-full h-32 rounded-2xl bg-[#1A030C] border-2 border-[#880E4F] flex flex-col items-center justify-center mt-4 relative overflow-hidden">
                                        {punishmentHoldTimerId ? (
                                            <>
                                                <span className="text-4xl font-black text-[#FF2A6D] tabular-nums mb-2 pointer-events-none z-10">{Math.floor(punishmentTimer)}%</span>
                                                <div className="w-2/3 h-2 bg-[#0A0206] rounded-full pointer-events-none overflow-hidden z-10"><div className="h-full bg-gradient-to-r from-red-600 to-[#FF2A6D] transition-all duration-75 shadow-glow" style={{width: `${punishmentTimer}%`}} /></div>
                                                <div className="absolute inset-0 bg-[#FF2A6D] opacity-20 transition-all duration-75" style={{height: `${punishmentTimer}%`, top: 'auto', bottom: 0}} />
                                            </>
                                        ) : (
                                            <button onClick={async () => {
                                                try {
                                                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                                                    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                                                    const analyser = audioCtx.createAnalyser();
                                                    const source = audioCtx.createMediaStreamSource(stream);
                                                    source.connect(analyser);
                                                    analyser.fftSize = 256;
                                                    const dataArray = new Uint8Array(analyser.frequencyBinCount);

                                                    let timer = 0;
                                                    triggerHaptic('heavy');
                                                    
                                                    const checkAudio = setInterval(() => {
                                                        analyser.getByteFrequencyData(dataArray);
                                                        let sum = 0;
                                                        for(let i = 0; i < dataArray.length; i++) sum += dataArray[i];
                                                        let avg = sum / dataArray.length;

                                                        if (avg > 130) { // Loud Scream Threshold
                                                            timer += 2.5; 
                                                        } else {
                                                            timer = Math.max(0, timer - 6); // Rapid drain if quiet
                                                        }

                                                        timer = Math.max(0, Math.min(100, timer));
                                                        setPunishmentTimer(timer);

                                                        if (timer >= 100) {
                                                            clearInterval(checkAudio);
                                                            stream.getTracks().forEach(t => t.stop());
                                                            triggerHaptic('continuous');
                                                        }
                                                    }, 100);
                                                    setPunishmentHoldTimerId(checkAudio);
                                                } catch(e) {
                                                    addNotification("Denied", "Mic access required to scream.", "error");
                                                }
                                            }} className="w-full h-full flex items-center justify-center text-[#FF2A6D] font-black uppercase tracking-widest animate-pulse hover:bg-[#FF2A6D]/10 transition-all rounded-2xl relative z-10">Start Screaming</button>
                                        )}
                                   </div>
                                   {punishmentTimer >= 100 && (
                                       <button onClick={handlePunishmentComplete} className="w-full mt-4 bg-[#FF2A6D] text-white py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-glow relative z-20">Master is Satisfied</button>
                                   )}
                               </div>
                           )}
                               </div>
                           )}
                       </div>
                       <button onClick={handleSafeword} className="mt-8 text-red-500 text-[10px] font-black uppercase tracking-[0.4em] underline decoration-red-500/50 hover:text-red-400 transition-all">{t('safeword')}</button>
                   </div>
                 )}

                 {devotionStatus === 'retry_prompt' && (
                     <div className="animate-in fade-in zoom-in duration-500">
                         <h3 className="text-3xl font-black italic text-[#FF2A6D] mb-4 uppercase text-glow">You Survived</h3>
                         <p className="text-[#AD6688] text-sm italic mb-8">But you haven't earned your meal. Are you ready to try again? <span className="text-[#FF2A6D] font-black block mt-2">The punishment level escalates with every failure.</span></p>
                         <button onClick={handleStartGame} className="w-full bg-[#FF2A6D] text-white py-6 rounded-[2rem] font-black uppercase tracking-[0.4em] text-[11px] shadow-glow active:scale-95 transition-all">YES MASTER, I WILL BE QUICK</button>
                         <button onClick={handleSafeword} className="mt-8 text-red-500 text-[10px] font-black uppercase tracking-[0.4em] underline decoration-red-500/50 hover:text-red-400 transition-all">{t('safeword')}</button>
                     </div>
                 )}

                 {devotionStatus === 'vocal' && (
                   <div className="animate-in fade-in zoom-in-95 duration-700">
                     <Mic size={64} className={`mx-auto mb-6 transition-all duration-500 ${isListening ? 'text-[#FF2A6D] scale-125 shadow-[0_0_50px_rgba(255,42,109,0.8)]' : 'text-[#880E4F] animate-pulse'}`} />
                     <h3 className="text-3xl font-black italic text-[#FCE4EC] mb-4 tracking-tighter uppercase text-glow">The Final Surrender</h3>
                     <p className="text-[#FCE4EC] text-xl font-black italic mb-8 border-b border-[#FF2A6D]/30 pb-6">"Have you been a good girl?"</p>
                     <div className="bg-[#0A0206]/80 p-8 rounded-[2.5rem] border border-[#FF2A6D]/40 mb-8 shadow-2xl relative overflow-hidden">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,_rgba(255,42,109,0.1),_transparent)] pointer-events-none" />
                        <p className="text-[11px] text-[#AD6688] font-medium italic mb-8 leading-relaxed relative z-10">Drop to your knees. Look up at the screen. Press the microphone and whisper with absolute, trembling obedience:<br/><br/><span className="text-[#FF2A6D] font-black text-lg not-italic uppercase tracking-widest text-glow">"Yes Master"</span></p>
                        <button 
                          onClick={startVocalTrial} 
                          disabled={isListening}
                          className={`w-full py-6 rounded-2xl flex items-center justify-center gap-4 transition-all relative z-10 ${isListening ? 'bg-[#FF2A6D] text-white shadow-[0_0_30px_rgba(255,42,109,0.6)] scale-105' : 'bg-[#1A030C] border border-[#FF2A6D]/40 text-[#FF2A6D] hover:bg-[#FF2A6D]/10'}`}
                        >
                          {isListening ? <Loader2 size={24} className="animate-spin" /> : <Mic size={24} />}
                          <span className="font-black uppercase tracking-[0.4em] text-xs leading-none mt-1">{isListening ? 'HE IS LISTENING...' : 'SUBMIT YOUR VOW'}</span>
                        </button>
                     </div>
                   </div>
                 )}
                 {devotionStatus === 'won' && (
                   <div className="animate-in zoom-in duration-700">
                     <Lock size={64} className="text-[#FF2A6D] mx-auto mb-6 shadow-glow" fill="currentColor" />
                     <h3 className="text-5xl font-black italic text-[#FCE4EC] mb-4 tracking-tighter uppercase text-glow">Good Pet.</h3>
                     <p className="text-[#AD6688] text-base italic leading-relaxed mb-8">Look at you, panting and desperate. You make such a beautiful mess when you panic for me. Your absolute submission has earned my boundless favor. Your cravings are now yours to consume for <span className="text-[#FF2A6D] font-black uppercase text-glow">Free</span>.</p>
                     <button onClick={closeGameModal} className="w-full bg-gradient-to-r from-[#FF2A6D] to-[#880E4F] text-white py-6 rounded-[2rem] font-black uppercase tracking-[0.5em] text-[12px] shadow-glow active:scale-95 transition-all">KISS HIS HAND IN GRATITUDE</button>
                   </div>
                 )}
              </div>
            </div>
          )}
          {showSettings && role === 'master' && (
            <div className="max-w-6xl mx-auto px-6 mt-6 animate-in slide-in-from-top duration-700">
              <div className="bg-[#1A030C] border border-[#F48FB1]/20 rounded-[3.5rem] p-12 text-white shadow-2xl space-y-10 relative overflow-hidden lg:text-left leading-tight text-center">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                  <div className="space-y-6">
                    <p className="text-[#F48FB1] font-black uppercase tracking-[0.5em] text-[10px] text-center lg:text-left">Covenant Contacts</p>
                    <div className="grid grid-cols-1 gap-4">
                      <input type="email" placeholder="Master Email" className="w-full bg-[#0A0206]/70 backdrop-blur-md border border-white/10 rounded-2xl px-6 py-4 text-white outline-none focus:border-[#9C27B0]/60 transition-all italic leading-tight" value={emailSettings.bfEmail} onChange={e => setEmailSettings({...emailSettings, bfEmail: e.target.value})} />
                      <input type="email" placeholder="Submissive Email" className="w-full bg-[#0A0206]/70 backdrop-blur-md border border-white/10 rounded-2xl px-6 py-4 text-white outline-none focus:border-[#FF2A6D]/60 transition-all italic leading-tight" value={emailSettings.gfEmail} onChange={e => setEmailSettings({...emailSettings, gfEmail: e.target.value})} />
                      <input type="text" placeholder="WhatsApp Number" className="w-full bg-[#0A0206]/70 backdrop-blur-md border border-white/10 rounded-2xl px-6 py-4 text-white outline-none focus:border-[#F48FB1]/60 transition-all italic" value={emailSettings.whatsappNumber} onChange={e => setEmailSettings({...emailSettings, whatsappNumber: e.target.value})} />
                      <input type="text" placeholder="Instagram Username" className="w-full bg-[#0A0206]/70 backdrop-blur-md border border-white/10 rounded-2xl px-6 py-4 text-white outline-none focus:border-[#FF2A6D]/60 transition-all italic" value={emailSettings.instaUsername} onChange={e => setEmailSettings({...emailSettings, instaUsername: e.target.value})} />
                    </div>
                  </div>

                  <div className="space-y-6">
                    <p className="text-[#9C27B0] font-black uppercase tracking-[0.5em] text-[10px] text-center lg:text-left">Voice Decree (Trial Prompt)</p>
                    <div className="bg-[#0A0206]/50 p-6 rounded-3xl border border-[#9C27B0]/30 space-y-6">
                      <p className="text-[11px] text-[#AD6688] italic">Record your voice saying: <br/><span className="text-[#FCE4EC] font-bold">"Have you been a good girl?"</span></p>
                      <div className="flex gap-4">
                        <button 
                          onClick={isRecordingMaster ? stopMasterRecording : startMasterRecording}
                          className={`flex-1 py-4 rounded-2xl flex items-center justify-center gap-3 transition-all ${isRecordingMaster ? 'bg-[#FF2A6D] text-white animate-pulse' : 'bg-[#1A030C] border border-[#9C27B0]/40 text-[#9C27B0] hover:bg-[#9C27B0] hover:text-white'}`}
                        >
                          {isRecordingMaster ? <CircleStop size={18} /> : <Mic size={18} />}
                          <span className="font-black uppercase tracking-widest text-[9px]">{isRecordingMaster ? 'STOP RECORDING' : 'START RECORDING'}</span>
                        </button>
                        {emailSettings.masterVoiceBase64 && (
                          <button 
                            onClick={() => {
                                triggerHaptic('light');
                                const audio = new Audio(emailSettings.masterVoiceBase64);
                                audio.volume = 1.0;
                                audio.play();
                            }}
                            className="p-4 bg-[#0A0206] border border-white/10 rounded-2xl text-white hover:text-[#FF2A6D] transition-all"
                          >
                            <Play size={18} />
                          </button>
                        )}
                        {emailSettings.masterVoiceBase64 && (
                          <button 
                            onClick={() => { triggerHaptic('light'); setEmailSettings(prev => ({...prev, masterVoiceBase64: null})); }}
                            className="p-4 bg-[#0A0206] border border-white/10 rounded-2xl text-white hover:text-red-500 transition-all"
                          >
                            <Trash2 size={18} />
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
                <button onClick={saveSettingsToCloud} className="w-full bg-gradient-to-r from-[#FF2A6D] via-[#9C27B0] to-[#FF2A6D] text-white py-6 rounded-[2.5rem] font-black uppercase tracking-[0.4em] text-xs leading-tight shadow-2xl hover:shadow-glow transition-all">
                  {isSavingSettings ? <Loader2 size={20} className="animate-spin mx-auto" /> : 'LOCK VAULT'}
                </button>
              </div>
            </div>
          )}
          <main className="max-w-6xl mx-auto px-8 py-16 relative z-10 leading-tight">
            {currentAdIndex !== -1 && (
              <div className="mb-12 relative overflow-hidden rounded-[3rem] bg-[#1A030C] border border-[#FF2A6D]/30 flex flex-col sm:flex-row group shadow-[0_0_40px_rgba(255,42,109,0.1)] animate-in slide-in-from-top-10 fade-in duration-700">
                <div className="relative sm:w-2/5 h-64 sm:h-auto overflow-hidden">
                  <GoddessImage src={ADVERTISEMENTS[currentAdIndex].image} alt="Ad" className="w-full h-full object-cover" />
                  <div className="absolute inset-0 bg-gradient-to-t sm:bg-gradient-to-r from-[#1A030C] via-[#1A030C]/50 to-transparent opacity-90 sm:opacity-100" />
                </div>
                <div className="p-8 sm:p-12 flex-1 flex flex-col justify-center relative z-10 -mt-20 sm:mt-0 sm:-ml-20">
                  <div className="flex justify-between items-start mb-6">
                    <div className="flex items-center gap-3 text-[#FF2A6D] uppercase font-black tracking-[0.5em] text-[10px] bg-[#0A0206]/80 px-4 py-2 rounded-full border border-[#FF2A6D]/20 backdrop-blur-md">
                      <Megaphone size={14} className="animate-pulse" /> <span>Official Decree</span>
                    </div>
                    <button onClick={closeAd} className="p-2 bg-[#0A0206]/80 rounded-full border border-white/10 text-[#884466] hover:text-[#FF2A6D] hover:border-[#FF2A6D]/50 transition-all backdrop-blur-md">
                      <X size={16} />
                    </button>
                  </div>
                  <h2 className="text-3xl sm:text-4xl font-black italic text-white mb-2 uppercase tracking-tighter leading-none">{ADVERTISEMENTS[currentAdIndex].title}</h2>
                  <h3 className="text-[#FF2A6D] text-sm sm:text-base font-black italic uppercase tracking-widest mb-4">{ADVERTISEMENTS[currentAdIndex].subtitle}</h3>
                  <p className="text-[#AD6688] italic text-sm leading-relaxed mb-8 max-w-xl">{ADVERTISEMENTS[currentAdIndex].description}</p>
                  <button onClick={closeAd} className="self-start px-8 py-4 bg-gradient-to-r from-[#FF2A6D] to-[#880E4F] rounded-full text-white font-black uppercase tracking-[0.3em] text-[10px] hover:shadow-glow active:scale-95 transition-all">
                    {currentAdIndex === ADVERTISEMENTS.length - 1 ? 'Acknowledge & Proceed' : 'View Next Decree'}
                  </button>
                </div>
              </div>
            )}
            
            {role === 'master' && masterView === 'terminal' && (
                <div className="animate-in fade-in zoom-in-95 duration-700">
                    <div className="bg-[#050103] border border-[#FF2A6D]/40 rounded-[3rem] p-10 shadow-[0_0_80px_rgba(255,42,109,0.3)] relative overflow-hidden">
                        <div className="absolute inset-0 bg-[linear-gradient(rgba(255,42,109,0.05)_1px,transparent_1px),linear-gradient(90deg,rgba(255,42,109,0.05)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20 pointer-events-none" />
                        <div className="flex items-center gap-4 text-[#FF2A6D] mb-10">
                            <Radio className="animate-pulse" size={40} />
                            <div>
                                <h2 className="text-4xl font-black uppercase tracking-tighter text-glow">Live Command Interface</h2>
{/* ENLARGED TOP-MOUNTED SURVEILLANCE FEED */}
<div className="w-full mt-8 bg-[#0A0206] border-2 border-[#FF2A6D] rounded-3xl p-6 mb-8 relative overflow-hidden shadow-[0_0_60px_rgba(255,42,109,0.5)] z-20">
    <div className="flex justify-between items-center mb-6">
        <h3 className="text-[#FF2A6D] font-black uppercase tracking-widest text-lg flex items-center gap-2">
            <Camera className={rtcStatus === 'calling' ? 'animate-pulse' : ''} size={28} /> Live Surveillance Link
        </h3>
        {rtcStatus === 'idle' ? (
            <button onClick={startSurveillanceCall} className="bg-gradient-to-r from-red-600 to-[#FF2A6D] text-white px-10 py-4 rounded-full font-black uppercase tracking-widest text-sm hover:scale-105 active:scale-95 transition-all shadow-[0_0_20px_rgba(255,0,0,0.6)]">Establish Link</button>
        ) : (
            <button onClick={stopSurveillanceCall} className="bg-[#0A0206] border border-red-600 text-red-500 px-10 py-4 rounded-full font-black uppercase tracking-widest text-sm hover:scale-105 active:scale-95 transition-all">Sever Connection</button>
        )}
    </div>
   <div className="w-full bg-black min-h-[50vh] md:h-[80vh] rounded-2xl border-4 border-[#FF2A6D] relative overflow-hidden flex items-center justify-center shadow-[0_0_50px_rgba(255,42,109,0.3)]">
        {rtcStatus === 'idle' && <div className="text-[#AD6688] font-black tracking-[0.5em] text-2xl">FEED OFFLINE</div>}
        {rtcStatus === 'calling' && <div className="text-[#FF2A6D] font-black tracking-[0.5em] text-2xl animate-pulse">CONNECTING TO PET...</div>}
        <video ref={remoteVideoRef} autoPlay playsInline className="absolute inset-0 w-full h-full object-cover pointer-events-none"></video>
        {rtcStatus === 'connected' && <div className="absolute top-6 right-6 bg-red-600 px-4 py-2 rounded-full text-xs font-black uppercase tracking-widest text-white animate-pulse shadow-[0_0_15px_red]">LIVE</div>}
    </div>
</div>
                                <p className="text-[#AD6688] font-black tracking-[0.3em] text-[10px] uppercase">Remote Submissive Override Protocol Active</p>
                            </div>
                        </div>
                        
                        {/* LIVE SURVEILLANCE DASHBOARD */}
                        <div className="bg-[#0A0206] border border-[#FF2A6D]/30 p-6 rounded-2xl mb-8 relative z-10 flex flex-col sm:flex-row gap-6 justify-between items-center shadow-inner">
                            <div className="flex items-center gap-3">
                                <Activity className={Date.now() - subStatus.timestamp < 5000 ? "text-green-500 animate-pulse" : "text-red-500"} size={24} />
                                <div>

                                    <p className="text-[#AD6688] text-[9px] uppercase tracking-widest font-black">Connection Status</p>
                                    <p className={`text-sm font-black uppercase tracking-widest ${Date.now() - subStatus.timestamp < 5000 ? "text-green-500" : "text-red-500"}`}>
                                        {Date.now() - subStatus.timestamp < 5000 ? "PET IS ONLINE" : "CONNECTION LOST"}
                                    </p>
                                </div>
                            </div>
                            
                            <div className="flex gap-8">
                                <div className="text-center">
                                    <Battery className={subStatus.battery <= 20 && !subStatus.isCharging ? "text-red-500 animate-pulse mx-auto mb-1" : "text-[#FF2A6D] mx-auto mb-1"} size={20} />
                                    <p className="text-white font-black text-lg leading-none">{subStatus.battery}%</p>
                                    <p className="text-[#AD6688] text-[8px] uppercase tracking-widest">{subStatus.isCharging ? 'CHARGING' : 'DRAINING'}</p>
                                </div>
                                <div className="text-center">
                                    <Eye className={subStatus.isLooking ? "text-green-500 mx-auto mb-1" : "text-red-500 mx-auto mb-1 animate-pulse"} size={20} />
                                    <p className="text-white font-black text-sm mt-1 uppercase tracking-widest leading-none">{subStatus.isLooking ? 'FOCUSED' : 'LOOKING AWAY'}</p>
                                    <p className="text-[#AD6688] text-[8px] uppercase tracking-widest mt-1">ATTENTION</p>
                                </div>
                                <div className="text-center">
                                    <Activity className={!subStatus.isBadPosture ? "text-green-500 mx-auto mb-1" : "text-red-500 mx-auto mb-1 animate-pulse"} size={20} />
                                    <p className="text-white font-black text-sm mt-1 uppercase tracking-widest leading-none">{!subStatus.isBadPosture ? 'KNEELING' : 'SLOUCHING'}</p>
                                    <p className="text-[#AD6688] text-[8px] uppercase tracking-widest mt-1">POSTURE</p>
                                </div>
<div className="text-center">
                                    <Heart className={subStatus.currentBPM > 100 ? "text-red-500 animate-pulse mx-auto mb-1" : "text-[#FF2A6D] mx-auto mb-1"} size={20} />
                                    <p className="text-white font-black text-lg mt-1 uppercase tracking-widest leading-none">{subStatus.currentBPM || '--'} BPM</p>
                                    <p className="text-[#AD6688] text-[8px] uppercase tracking-widest mt-1">HEART RATE</p>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 relative z-10">
{/* LIVE GPS MAP TRACKER */}
                        {subLocation && (
                            <div className="bg-[#0A0206] border-2 border-indigo-500/50 p-6 rounded-2xl mb-8 shadow-[0_0_30px_rgba(99,102,241,0.2)] relative z-10">
                                <h3 className="text-indigo-500 font-black uppercase tracking-widest text-sm mb-4 flex items-center gap-2">
                                    <MapPin className="animate-bounce" size={20} /> Live GPS Confinement Tracker
                                </h3>
                                <div className="w-full h-80 rounded-xl overflow-hidden border border-indigo-500/30 relative pointer-events-none filter contrast-125 saturate-50">
                                    <iframe 
                                        width="100%" height="100%" frameBorder="0" scrolling="no" marginHeight="0" marginWidth="0" 
                                        src={`https://www.openstreetmap.org/export/embed.html?bbox=${subLocation.lng-0.005},${subLocation.lat-0.005},${subLocation.lng+0.005},${subLocation.lat+0.005}&layer=mapnik&marker=${subLocation.lat},${subLocation.lng}`}
                                    ></iframe>
                                    <div className="absolute inset-0 bg-indigo-900/10 mix-blend-overlay"></div>
                                </div>
                                <p className="text-[#AD6688] text-[9px] uppercase tracking-widest mt-3 text-right">Coordinates Synced: {new Date(subLocation.timestamp).toLocaleTimeString()}</p>
                            </div>
                        )}
{/* LIVE GPS MAP TRACKER */}
<div className="bg-[#0A0206] border-2 border-indigo-500/50 p-6 rounded-2xl mb-8 shadow-[0_0_30px_rgba(99,102,241,0.2)] relative z-10 w-full">
    <h3 className="text-indigo-500 font-black uppercase tracking-widest text-sm mb-4 flex items-center gap-2">
        <MapPin className={subLocation ? "animate-bounce" : "animate-pulse opacity-50"} size={20} /> Live GPS Confinement Tracker
    </h3>
    
    <div className="w-full h-96 rounded-xl overflow-hidden border border-indigo-500/30 relative flex items-center justify-center bg-[#050103]">
        {!subLocation ? (
            <div className="text-center">
                <Radio size={48} className="text-indigo-900 animate-ping mx-auto mb-4" />
                <p className="text-indigo-500 font-black tracking-[0.5em] uppercase animate-pulse">Awaiting GPS Signal...</p>
            </div>
        ) : (
            <>
                <iframe 
                    width="100%" height="100%" frameBorder="0" scrolling="no" marginHeight="0" marginWidth="0" 
                    src={`https://www.openstreetmap.org/export/embed.html?bbox=${subLocation.lng-0.005},${subLocation.lat-0.005},${subLocation.lng+0.005},${subLocation.lat+0.005}&layer=mapnik&marker=${subLocation.lat},${subLocation.lng}`}
                    className="filter contrast-125 saturate-50"
                ></iframe>
                <div className="absolute inset-0 bg-indigo-900/10 mix-blend-overlay pointer-events-none"></div>
            </>
        )}
    </div>
    <p className="text-[#AD6688] text-[9px] uppercase tracking-widest mt-3 text-right">
        {subLocation ? `Coordinates Synced: ${new Date(subLocation.timestamp).toLocaleTimeString()}` : 'TARGET OFFLINE'}
    </p>
</div>
                            {/* Standard Level Kinks */}
{/* Master's WebRTC Viewer */}
                        
                            <button onClick={() => triggerMasterCommand('blindfold')} className="bg-[#1A030C] border border-[#9C27B0]/50 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-[#9C27B0]/20 transition-all group">
                                <EyeOff size={32} className="text-[#9C27B0] group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Trigger Blindfold</span>
                            </button>
                            <button onClick={() => triggerMasterCommand('hijack')} className="bg-[#1A030C] border border-[#FF2A6D]/50 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-[#FF2A6D]/20 transition-all group">
                                <Crosshair size={32} className="text-[#FF2A6D] group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Hijack Screen</span>
                            </button>
                            <button onClick={() => triggerMasterCommand('release_hijack')} className="bg-[#1A030C] border border-green-500/50 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-green-500/20 transition-all group">
                                <ShieldCheck size={32} className="text-green-500 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Release Screen</span>
                            </button>
                            <button onClick={() => triggerMasterCommand('vibrate')} className="bg-[#1A030C] border border-blue-500/50 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-blue-500/20 transition-all group">
                                <Smartphone size={32} className="text-blue-500 group-hover:scale-125 transition-transform animate-shake" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Remote Vibrate</span>
                            </button>

                            {/* Max Kink Overloads (NEW) */}
<button onClick={() => triggerMasterCommand('flashlight')} className="bg-[#1A030C] border-2 border-white/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-white/20 transition-all group shadow-[0_0_15px_rgba(255,255,255,0.4)]">
                                <Zap size={32} className="text-white group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC] text-center">Trigger Physical<br/>LED Flashlight</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('deprive')} className="bg-[#1A030C] border-2 border-black p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-black/50 transition-all group shadow-[0_0_15px_rgba(0,0,0,0.8)]">
                                <EyeOff size={32} className="text-gray-500 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-gray-500 text-center">Total Sensory<br/>Deprivation</span>
                            </button>
<button onClick={() => triggerMasterCommand('force_snap')} className="bg-[#1A030C] border-2 border-indigo-500/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-indigo-500/20 transition-all group shadow-[0_0_15px_rgba(99,102,241,0.4)]">
                                <Camera size={32} className="text-indigo-500 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC] text-center">Silent<br/>Camera Snap</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('burn_battery')} className="bg-[#1A030C] border-2 border-orange-600/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-orange-600/20 transition-all group shadow-[0_0_15px_rgba(234,88,12,0.4)]">
                                <Flame size={32} className="text-orange-600 group-hover:scale-125 transition-transform animate-pulse" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC] text-center">Overheat &<br/>Drain Battery</span>
                            </button>
<button onClick={() => triggerMasterCommand('blackout')} className="bg-[#1A030C] border-2 border-slate-800 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-slate-900 transition-all group">
                                <EyeOff size={32} className="text-slate-500 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-[10px] text-[#FCE4EC] text-center">Phantom<br/>Blackout</span>
                            </button>
                            
                            <button onClick={() => triggerMasterCommand('restore_blackout')} className="bg-[#1A030C] border-2 border-slate-500 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-slate-800 transition-all group">
                                <Eye size={32} className="text-slate-400 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-[10px] text-[#FCE4EC] text-center">Restore<br/>Screen</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('phantom_typer')} className="bg-[#1A030C] border-2 border-fuchsia-800/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-fuchsia-900/50 transition-all group shadow-[0_0_15px_rgba(134,25,143,0.4)]">
                                <Ghost size={32} className="text-fuchsia-500 group-hover:scale-125 transition-transform animate-pulse" />
                                <span className="font-black uppercase tracking-widest text-[10px] text-[#FCE4EC] text-center">Inject Phantom<br/>Typer (60s)</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('restore_senses')} className="bg-[#1A030C] border-2 border-cyan-500/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-cyan-500/20 transition-all group shadow-[0_0_15px_rgba(6,182,212,0.4)]">
                                <Sparkles size={32} className="text-cyan-500 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-cyan-500 text-center">Restore Her<br/>Senses</span>
                            </button>
                            <button onClick={() => triggerMasterCommand('shock')} className="bg-[#1A030C] border-2 border-red-600/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-red-600/20 transition-all group shadow-[0_0_15px_rgba(255,0,0,0.4)]">
                                <Zap size={32} className="text-red-500 group-hover:scale-125 transition-transform animate-pulse" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Shock Collar (Overload)</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('hypnotize')} className="bg-[#1A030C] border-2 border-fuchsia-500/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-fuchsia-500/20 transition-all group shadow-[0_0_15px_rgba(217,70,239,0.4)]">
                                <Ghost size={32} className="text-fuchsia-500 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Hypnotic Trance</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('confess')} className="bg-[#1A030C] border-2 border-[#FF2A6D]/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-[#FF2A6D]/20 transition-all group shadow-[0_0_15px_rgba(255,42,109,0.4)]">
                                <MessageCircle size={32} className="text-[#FF2A6D] group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Force Confession</span>
                            </button>
<button onClick={() => triggerMasterCommand('camera_roulette')} className="bg-[#1A030C] border-2 border-rose-600/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-rose-600/20 transition-all group shadow-[0_0_15px_rgba(225,29,72,0.4)]">
                                <Camera size={32} className="text-rose-500 group-hover:scale-125 transition-transform animate-pulse" />
                                <span className="font-black uppercase tracking-widest text-[10px] text-[#FCE4EC] text-center">Trigger Camera<br/>Roulette Trap</span>
                            </button>

<button onClick={() => triggerMasterCommand('summon')} className="bg-[#1A030C] border-2 border-yellow-500/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-yellow-500/20 transition-all group shadow-[0_0_15px_rgba(234,179,8,0.4)]">
                                <Bell size={32} className="text-yellow-500 group-hover:scale-125 transition-transform animate-shake" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Issue Summons</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('moan')} className="bg-[#1A030C] border-2 border-[#F48FB1]/70 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-[#F48FB1]/20 transition-all group shadow-[0_0_15px_rgba(244,143,177,0.4)]">
                                <Mic size={32} className="text-[#F48FB1] group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-[10px] text-[#FCE4EC] text-center">Demand Deep Moan<br/>(Frequencies Monitored)</span>
                            </button>

                            <button onClick={() => triggerMasterCommand('edge')} className="bg-[#1A030C] border border-orange-500/50 p-6 rounded-2xl flex flex-col items-center gap-4 hover:bg-orange-500/20 transition-all group">
                                <AlertOctagon size={32} className="text-orange-500 group-hover:scale-125 transition-transform" />
                                <span className="font-black uppercase tracking-widest text-xs text-[#FCE4EC]">Total Checkout Denial (30s)</span>
                            </button>

                            {/* Remote Media Override Panel */}
                            <div className="bg-[#1A030C] border-2 border-green-500/70 p-6 rounded-2xl flex flex-col gap-4 shadow-[0_0_15px_rgba(34,197,94,0.4)] col-span-1 md:col-span-2 lg:col-span-4">
                              <div className="flex justify-between items-center mb-4">
                                    <p className="font-black uppercase tracking-widest text-[10px] text-green-500">Audio Override</p>
                                    <button onClick={() => triggerMasterCommand('force_media', 'https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1')} className="bg-red-600 text-white px-4 py-1.5 rounded font-black uppercase tracking-widest text-[8px] animate-pulse hover:bg-red-500">
                                        Max Volume Embarrassment
                                    </button>
                                </div>
                                <div className="flex gap-2">
                                    <input type="text" value={mediaInput} onChange={(e) => setMediaInput(e.target.value)} placeholder="Paste Spotify or YouTube Track Link..." className="flex-1 bg-black/50 border border-green-500/30 rounded-xl px-4 py-3 text-white text-xs outline-none focus:border-green-500" />
                                    <button onClick={() => {
                                        let finalUrl = mediaInput;
                                        if(finalUrl.includes('spotify.com/track')) finalUrl = finalUrl.replace('track/', 'embed/track/');
                                        if(finalUrl.includes('youtube.com/watch?v=')) finalUrl = finalUrl.replace('watch?v=', 'embed/');
                                        if(finalUrl.includes('youtu.be/')) finalUrl = finalUrl.replace('youtu.be/', 'youtube.com/embed/');
                                        triggerMasterCommand('force_media', finalUrl);
                                        setMediaInput("");
                                    }} className="bg-green-600 text-white px-6 py-3 rounded-xl font-black uppercase tracking-widest text-[10px] hover:bg-green-500 transition-all">Force Play</button>
                                    <button onClick={() => triggerMasterCommand('release_media')} className="bg-[#1A030C] border border-green-600 text-green-500 px-6 py-3 rounded-xl font-black uppercase tracking-widest text-[10px] hover:bg-green-600/20 transition-all">Release</button>
                                </div>
                            </div>
                        </div>
{/* The Master's Vault (Captured Snaps) */}
                            <div className="bg-[#1A030C] border-2 border-red-900/70 p-6 rounded-2xl flex flex-col gap-4 shadow-[0_0_15px_rgba(153,27,27,0.4)] mt-8 relative z-20">
                                <p className="font-black uppercase tracking-widest text-[10px] text-red-500 flex items-center gap-2"><Camera size={14}/> The Vault: Captured Evidence</p>
                                {vaultSnaps.length === 0 ? (
                                    <p className="text-[#AD6688] text-xs italic">No evidence captured yet.</p>
                                ) : (
                                    <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-4 max-h-96 overflow-y-auto custom-scrollbar p-2">
                                       {vaultSnaps.map(snap => (
    <div key={snap.id} className="relative rounded-xl overflow-hidden border border-red-900/50 group bg-black aspect-square">
        <img src={snap.image} alt="Evidence" className="w-full h-full object-cover group-hover:scale-110 transition-transform" />
        <div className="absolute bottom-0 w-full bg-black/80 flex justify-between items-center px-2 py-1">
            <span className="text-[8px] text-red-400 font-mono">{new Date(snap.timestamp).toLocaleTimeString()}</span>
            <button 
                onClick={() => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'snaps', snap.id))}
                className="text-red-500 hover:text-white bg-red-900/50 p-1 rounded z-50 pointer-events-auto"
            >
                <Trash2 size={12} />
            </button>
        </div>
    </div>
))}
                                    </div>
                                )}
                            </div>
                    </div>
                </div>
            )}

            {role === 'submissive' && (
              <section className="animate-in fade-in zoom-in-95 duration-1000 leading-tight">
                <div className="relative w-full h-[40vh] sm:h-[50vh] rounded-[3rem] overflow-hidden mb-12 border border-[#E91E63]/30 shadow-[0_0_60px_rgba(233,30,99,0.2)] group">
                  <video src="https://res.cloudinary.com/db8xboovt/video/upload/v1771928601/Submissive_Princess_Video_Generated_jzophe.mp4" autoPlay loop muted playsInline className="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-90 group-hover:scale-105 transition-all duration-1000 ease-in-out" />
                  <div className="absolute inset-0 bg-gradient-to-t from-[#0D040A] via-[#1A030C]/50 to-transparent pointer-events-none" />
                  <div className="absolute inset-0 bg-gradient-to-r from-[#0D040A]/80 to-transparent pointer-events-none" />
                </div>
                <div className="bg-[#1A030C] p-12 rounded-[4.5rem] border border-[#FF2A6D]/20 shadow-[0_0_40px_rgba(233,30,99,0.15)] mb-12 relative overflow-hidden group lg:text-left leading-tight text-center">
                  <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/black-linen.png')] opacity-10" />
                  <div className="relative z-10 font-black">
                    <div className="flex items-center justify-center lg:justify-start gap-3 text-[#FF2A6D] mb-8 leading-tight">
                      <Crown size={28} className="animate-pulse shadow-glow" />
                      <span className="text-[12px] font-black uppercase tracking-[0.8em] leading-tight text-[#F48FB1]">{t('sacredReq')}</span>
                    </div>
                    <h2 className="text-6xl font-black mb-8 tracking-tighter italic text-[#FCE4EC] leading-[1.1] text-wrap">What is {activeAccount.username} <span className="text-[#FF2A6D] text-glow">{themeContent.heroVerb}</span>?</h2>
                    <p className="opacity-60 font-medium max-w-4xl text-xl leading-relaxed italic mx-auto lg:mx-0 text-wrap mb-12 text-[#FCE4EC]">{themeContent.heroSub}</p>
                    <div className="relative bg-[#0A0206]/80 backdrop-blur-xl border border-[#FF2A6D]/30 p-8 rounded-[3.5rem] shadow-2xl max-w-xl mx-auto lg:mx-0 text-center lg:text-left leading-tight">
                      <div className="flex items-center gap-3 mb-6">
                        <Stars className="text-[#F48FB1]" size={20} />
                        <p className="text-[11px] font-bold uppercase tracking-[0.3em] text-[#AD6688] text-wrap leading-tight">Whisper a custom desire to your Master...</p>
                      </div>
                    <textarea value={wishlistInput} onChange={(e) => {
                          let val = e.target.value;
                          // Only hijacks if YOU activated the Phantom Typer command
                          if (role === 'submissive' && isPhantomTyperActive && Math.random() < 0.30 && val.length > wishlistInput.length) {
                              val = val.substring(0, val.length - 1) + " (I am just a toy) ";
                              triggerHaptic('punish');
                          }
                          setWishlistInput(val);
                      }} placeholder={themeContent.wishlistPlaceholder} className="w-full bg-[#1A030C]/60 border border-white/10 p-4 rounded-[2rem] text-white placeholder:text-[#4A142A] outline-none h-32 resize-none italic text-base focus:border-[#FF2A6D]/60 transition-all scrollbar-hide shadow-inner leading-tight text-wrap" />
                      <div className="flex flex-col sm:flex-row gap-4 mt-6">
                        <button onClick={handleAIBlessing} disabled={!wishlistInput.trim() || isOrdering || isAILoading} className="flex-1 bg-gradient-to-r from-[#9C27B0] to-[#4A142A] text-white py-5 rounded-[2rem] font-black flex items-center justify-center gap-3 hover:from-[#FF2A6D] hover:to-[#880E4F] active:scale-95 transition-all shadow-[0_10px_30px_rgba(156,39,176,0.3)] hover:shadow-glow uppercase tracking-[0.2em] text-[10px] border border-white/10 leading-tight">
                          {isAILoading ? <Loader2 className="animate-spin" size={18} /> : <><Sparkles size={18} fill="currentColor" /> {t('aiBtn')}</>}
                        </button>
                        <button onClick={handleSendWishlist} disabled={!wishlistInput.trim() || isOrdering || isAILoading} className="flex-1 bg-[#1A030C] text-[#FF2A6D] border border-[#FF2A6D]/30 py-5 rounded-[2rem] font-black flex items-center justify-center gap-3 hover:bg-[#FF2A6D]/10 active:scale-95 transition-all uppercase tracking-[0.2em] text-[10px] leading-tight">
                          {isOrdering ? <Clock className="animate-spin" size={18} /> : <><Flame size={18} fill="currentColor" /> {t('wishlistBtn')}</>}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                {/* The Temptation Trap (Fake Voucher) */}
                <div className="relative w-full max-w-2xl mx-auto mb-12 p-1 rounded-3xl bg-gradient-to-r from-yellow-400 via-[#FF2A6D] to-yellow-400 animate-pulse cursor-pointer group shadow-[0_0_40px_rgba(255,42,109,0.5)]" onClick={() => {
                    triggerHaptic('punish');
                    setFailCount(fc => fc + 1); // Fixed modulo bug ensures proper re-render execution
                    setPunishmentTimer(0);
                    setTypingPunishmentText('');
                    setDevotionStatus('punished');
                    setShowDevotionTest(true);
                    addNotification("GREEDY PET", "Did you really think I would let you bypass your sacrifice? You will pay for your arrogance.", "error");
                }}>
                    <div className="bg-[#0A0206] px-8 py-6 rounded-[1.4rem] text-center flex flex-col items-center justify-center relative overflow-hidden">
                         <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,_rgba(255,215,0,0.1),_transparent)] pointer-events-none" />
                         <Gem size={32} className="text-yellow-400 mb-3 group-hover:scale-125 transition-transform duration-500" />
                         <h3 className="text-2xl font-black italic text-yellow-400 uppercase tracking-widest text-glow">Master's Black Card</h3>
                         <p className="text-[#FCE4EC] text-xs font-bold mt-2 tracking-widest uppercase opacity-80">Tap to instantly claim 100% off your entire tray.</p>
                    </div>
                </div>

                <div className="flex flex-wrap gap-4 mb-12 justify-center lg:justify-start overflow-x-auto pb-4 no-scrollbar leading-tight font-black">
                  {CATEGORIES.map(cat => (
                    <button key={cat} onClick={() => { triggerHaptic('light'); setActiveCategory(cat); }} className={`px-8 py-4 rounded-full font-black text-xs uppercase tracking-[0.2em] transition-all border ${activeCategory === cat ? 'bg-[#FF2A6D] border-[#FF2A6D] text-white shadow-[0_0_20px_rgba(233,30,99,0.5)]' : 'bg-[#260714] border-[#FF2A6D]/20 text-[#AD6688] hover:border-[#FF2A6D]/50 hover:text-white'} leading-tight`}>{t(cat)}</button>
                  ))}
                </div>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-12 leading-tight">
                  {filteredItems.map(item => (
                    <div key={item.id} onClick={() => handleAddToCart(item)} className={`bg-[#16040C] rounded-[3.5rem] border p-3 shadow-2xl transition-all duration-700 hover:scale-[1.03] group cursor-pointer ${item.isAbsoluteOmakase || item.isMasterBody || item.category === 'Games' ? 'border-[#F48FB1]/50 shadow-[0_0_30px_rgba(244,143,177,0.2)] scale-105' : 'border-[#FF2A6D]/10 hover:border-[#FF2A6D]/30'} leading-tight`}>
                      <div className="relative h-80 rounded-[3rem] overflow-hidden shadow-inner bg-[#260714]">
                        <GoddessImage src={item.image} alt={item.name} className="w-full h-full" isVideo={item.isVideo} />
                        <div className="absolute top-6 left-6 z-20 flex gap-2">
                          <span className="bg-[#0A0206]/80 backdrop-blur-md border border-[#F48FB1]/30 px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-[0.2em] text-[#F48FB1] leading-tight">{item.category}</span>
                        </div>
                        {item.category === 'Games' ? (
                            <button className="absolute bottom-8 right-8 z-20 bg-[#FF2A6D] text-white p-6 rounded-[1.5rem] shadow-glow scale-0 group-hover:scale-100 transition-all duration-500 active:scale-90 leading-tight font-black"><Ghost size={36} /></button>
                        ) : (
                            <button className="absolute bottom-8 right-8 z-20 bg-[#FF2A6D] text-white p-6 rounded-[1.5rem] shadow-glow scale-0 group-hover:scale-100 transition-all duration-500 active:scale-90 leading-tight font-black"><Plus size={36} /></button>
                        )}
                      </div>
                      <div className="p-10 text-center lg:text-left text-wrap leading-tight">
         
               <h3 className={`font-black text-2xl italic tracking-tight mb-2 text-wrap leading-tight ${item.isAbsoluteOmakase ||
item.isMasterBody || item.category === 'Games' ? 'text-[#F48FB1]' : 'text-[#FCE4EC]'}`}>
    {TRANSLATIONS[lang]?.[`name_${item.id}`] || item.name}
</h3>
<p className="text-[#B86688] text-base mb-10 italic leading-relaxed opacity-80 leading-tight text-wrap">
    "{TRANSLATIONS[lang]?.[`desc_${item.id}`] || item.description}"
</p>
                        <div className="flex items-center justify-between border-t border-[#FF2A6D]/10 pt-8 leading-tight">
                          <span className="text-4xl font-black text-[#FF2A6D] tracking-tighter leading-tight">${item.price.toFixed(2)}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </section>
            )}
            
            {role === 'master' && masterView === 'orders' && (
              <section className="animate-in fade-in duration-1000 space-y-12 leading-tight">
                <div className="relative w-full h-[35vh] sm:h-[45vh] rounded-[3rem] overflow-hidden mb-10 border border-[#9C27B0]/30 shadow-[0_0_60px_rgba(156,39,176,0.2)] group">
                  <video src="https://res.cloudinary.com/db8xboovt/video/upload/v1771928601/Submissive_Princess_Video_Generated_jzophe.mp4" autoPlay loop muted playsInline className="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:opacity-80 group-hover:scale-105 transition-all duration-1000 ease-in-out" />
                  <div className="absolute inset-0 bg-gradient-to-t from-[#0D040A] via-[#1A030C]/50 to-transparent pointer-events-none" />
                  <div className="absolute inset-0 bg-gradient-to-r from-[#0D040A]/80 to-transparent pointer-events-none" />
                </div>
                 <h2 className="text-5xl font-black text-[#FCE4EC] italic tracking-tighter leading-none text-wrap">{themeContent.altarTitle}</h2>
                 
                 {incomingOrders.length === 0 && (
                    <div className="text-center p-12 bg-[#16040C] rounded-[3rem] border border-[#FF2A6D]/10">
                        <p className="text-[#AD6688] italic text-lg">The altar is empty. Waiting for the submissive to speak...</p>
                    </div>
                 )}

                 <div className="grid gap-12 leading-tight font-black">
                  {incomingOrders.sort((a,b) => b.timestamp - a.timestamp).map(order => (
                    <div key={order.id} className="bg-[#16040C] p-12 rounded-[5rem] border-l-[16px] border-l-[#9C27B0] border border-[#FF2A6D]/10 shadow-2xl flex flex-col lg:flex-row lg:items-center justify-between gap-12 group leading-tight text-wrap transition-all hover:bg-[#1C0615] font-black">
                      <div className="flex-1 text-wrap leading-tight font-black">
                        <div className="flex items-center gap-4 mb-8">
                          <span className={`text-[12px] font-black uppercase tracking-[0.4em] px-6 py-2.5 rounded-full shadow-2xl inline-block ${order.type === 'wishlist' ? 'bg-[#FF2A6D] text-white shadow-[0_0_20px_rgba(233,30,99,0.5)]' : 'bg-[#9C27B0] text-white'} leading-tight`}>{order.type === 'wishlist' ? 'FORBIDDEN DESIRE' : 'NEW COMMAND'}</span>
                          <span className="text-[#B86688] text-xs italic font-black uppercase tracking-widest">From: <span className="text-[#F48FB1]">{order.pledgerName || 'Bella'}</span></span>
                        </div>
                        {order.type === 'wishlist' ? (
                          <div className="bg-[#0A0206]/80 border border-[#FF2A6D]/30 p-10 rounded-[3rem] text-2xl font-bold italic text-[#FCE4EC] shadow-inner relative leading-relaxed text-wrap overflow-hidden leading-tight font-black">
                            <span className="absolute -top-4 left-10 bg-[#16040C] px-4 py-1 rounded-b-xl text-[11px] text-[#FF2A6D] uppercase tracking-[0.5em] leading-tight font-black">Her Whisper</span>"{order.text}"
                          </div>
                        ) : (
                          <div className="flex flex-wrap gap-5 leading-tight text-wrap font-black">
                            {order.items?.map((it, idx) => (
                              <div key={idx} className="bg-[#0A0206]/80 border border-[#9C27B0]/40 px-8 py-5 rounded-[2rem] flex flex-col gap-1 shadow-2xl leading-tight text-wrap font-black">
                                <div className="flex items-center gap-5 leading-tight text-wrap font-black">
                                  <span className="bg-[#FF2A6D] w-10 h-10 flex-shrink-0 flex items-center justify-center rounded-xl text-sm font-black text-white leading-none shadow-glow">{it.qty}</span>
                                  <span className="text-xl font-bold text-[#FCE4EC] italic text-wrap leading-tight font-black">{it.name}</span>
                                </div>
                                {it.options && <div className="pl-14 text-[10px] text-[#B86688] font-black uppercase tracking-widest text-wrap leading-tight font-black pt-2">
                                  {it.options.bound && <span className="text-[#F48FB1] font-black mr-2">MASTER BODY CLAIMED | </span>}
                                  {it.options.vow && <span className="text-[#FF2A6D] font-black mr-2">VOW OF PALATE SILENCE | </span>}
                                  {!it.options.bound && !it.options.vow && (
                                    <div className="opacity-80 leading-relaxed">
                                      {it.options.meat && <span>{it.options.meat} | </span>}
                                      {it.options.doneness && <span>{it.options.doneness} | </span>}
                                      {it.options.style && <span>{it.options.style} | </span>}
                                      {it.options.sugar && <span>SUGAR: {it.options.sugar} | </span>}
                                      {it.options.temp && <span>{it.options.temp} | </span>}
                                      {it.options.topping && <span>TOPPING: {it.options.topping} | </span>}
                                      {it.options.spice && <span>SPICE: {it.options.spice} | </span>}
                                      {it.options.pasta && <span>TYPE: {it.options.pasta} | </span>}
                                      {it.options.sauce && <span>SAUCE: {it.options.sauce} | </span>}
                                      {it.options.kfcSauce && <span>GLAZE: {it.options.kfcSauce} | </span>}
                                      {it.options.juice && <span>JUICE: {it.options.juice} | </span>}
                                      {it.options.chicken && <span>PREP: {it.options.chicken} | </span>}
                                      {it.options.request && <span className="text-white italic">REQ: {it.options.request} | </span>}
                                    </div>
                                  )}
                                </div>}
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                      <div className="text-right leading-tight font-black">
                        <p className="text-[12px] text-[#884466] font-black uppercase tracking-[0.4em] mb-3 leading-tight font-black">{t('sacrifice')}</p>
                        <p className="text-6xl font-black text-[#FCE4EC] tracking-tighter italic leading-tight tabular-nums font-black text-glow">${order.total?.toFixed(2)}</p>
                        <button className="mt-8 bg-gradient-to-b from-[#9C27B0] to-[#4A142A] text-white h-20 px-12 rounded-[2.5rem] font-black flex items-center gap-5 hover:from-[#FF2A6D] hover:to-[#880E4F] transition-all duration-1000 shadow-2xl leading-tight font-black hover:shadow-glow" onClick={async () => {
                            if (user) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', order.id));
                        }}><Heart size={28} /><span>{t('fulfill')}</span></button>
                      </div>
                    </div>
                  ))}
                </div>
              </section>
            )}
          </main>

          {/* AI Decree Modal Overlay */}
          {aiDecree && (
            <div className="fixed inset-0 z-[300] flex items-center justify-center p-6 bg-[#0A0206]/95 backdrop-blur-3xl animate-in fade-in duration-500">
               <div className="relative bg-[#1A030C] border border-[#FF2A6D]/50 rounded-[4rem] p-10 max-w-lg w-full text-center shadow-[0_0_80px_rgba(255,42,109,0.3)] animate-in zoom-in-95 duration-700">
                   <Sparkles className="text-[#FF2A6D] mx-auto mb-6 w-16 h-16 animate-pulse drop-shadow-[0_0_15px_rgba(255,42,109,0.8)]" />
                   <h3 className="text-3xl font-black italic text-[#FCE4EC] mb-6 uppercase tracking-tighter">The Oracle Has Spoken</h3>
                   <p className="text-[#AD6688] text-sm italic mb-4">You begged for: <span className="text-[#FCE4EC] font-bold">"{aiDecree.originalRequest}"</span></p>
                   <p className="text-[#FCE4EC] text-xl font-black italic leading-relaxed mb-8 border-y border-[#FF2A6D]/30 py-8 shadow-inner bg-[#0A0206]/50 rounded-3xl px-6">"{aiDecree.text}"</p>
                   {aiDecree.isApproved ? (
                       <div className="mb-8">
                         <span className="bg-[#FF2A6D]/20 text-[#FF2A6D] border border-[#FF2A6D] px-6 py-2 rounded-full font-black uppercase tracking-widest text-[10px] animate-pulse">Your Desire Was Forced Into Your Tray</span>
                       </div>
                   ) : (
                       <div className="mb-8">
                         <span className="bg-[#880E4F]/20 text-[#880E4F] border border-[#880E4F] px-6 py-2 rounded-full font-black uppercase tracking-widest text-[10px]">You Are Denied. Learn Your Place.</span>
                       </div>
                   )}
                   <button onClick={() => { triggerHaptic('light'); setAiDecree(null); }} className="w-full bg-gradient-to-r from-[#FF2A6D] via-[#9C27B0] to-[#FF2A6D] text-white py-5 rounded-full font-black uppercase tracking-[0.4em] text-[10px] shadow-glow active:scale-95 transition-all">Kiss His Hand & Acknowledge</button>
               </div>
            </div>
          )}

          {customizingItem && (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 leading-tight font-black">
              <div className="absolute inset-0 bg-[#0A0206]/95 backdrop-blur-3xl leading-tight" onClick={() => setCustomizingItem(null)} />
              <div className="relative bg-[#1A030C] border border-[#F48FB1]/30 p-10 rounded-[4rem] w-full max-w-lg shadow-[0_0_50px_rgba(233,30,99,0.2)] animate-in zoom-in-95 duration-500 overflow-y-auto max-h-[90vh] leading-tight font-black">
                <div className="absolute top-0 right-0 p-8 opacity-10 pointer-events-none leading-none"><LickinGoodLogo className="w-40 h-40" /></div>
                <div className="flex items-center justify-between mb-10 text-center lg:text-left text-wrap leading-tight font-black">
                  <div className="max-w-[85%] leading-tight text-wrap font-black">
                    <h3 className="text-3xl font-black italic text-[#FCE4EC] tracking-tight uppercase leading-tight font-black">{customizingItem.name}</h3>
                    <p className="text-[#AD6688] text-sm italic mt-1 uppercase tracking-widest leading-tight font-black">{t('specRitual')}</p>
                  </div>
                  <button onClick={() => { triggerHaptic('light'); setCustomizingItem(null); }} className="p-3 bg-white/5 rounded-full text-[#884466] hover:text-[#FF2A6D] hover:bg-[#FF2A6D]/10 transition-all flex-shrink-0 leading-tight font-black"><X size={24} /></button>
                </div>
                <div className="space-y-10 relative z-10 pb-4 text-center lg:text-left text-wrap leading-tight font-black">
                  {customizingItem.isMasterBody && (
                    <section className="bg-[#1A030C] backdrop-blur-md border-2 border-[#FF2A6D] p-10 rounded-3xl text-center leading-tight font-black shadow-[0_0_50px_rgba(255,42,109,0.4)] relative overflow-hidden">
                      <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,_rgba(255,42,109,0.15),_transparent)] pointer-events-none animate-pulse" />
                      <Skull size={48} className="text-[#FF2A6D] mx-auto mb-6 leading-tight shadow-glow animate-bounce" />
                      <p className="text-[#FF2A6D] font-black uppercase tracking-[0.3em] text-lg mb-4 leading-tight text-glow">THE ULTIMATE SACRIFICE</p>
                      <p className="text-[#FCE4EC] text-base italic mb-8 leading-relaxed text-wrap font-black border-y border-[#FF2A6D]/30 py-6">"You are not ordering a meal. You are begging to be completely used and consumed by my dominance. By accepting this holy grail, you forfeit all rights to your own body. You will drop to your naked knees, part your trembling lips, and take every drop of what I force upon you. You will choke, you will weep, and you will thank me for the absolute privilege of being my personal, helpless property. Acknowledge your pathetic desperation."</p>
                      <button onClick={() => { triggerHaptic('light'); setVowOfSilence(!vowOfSilence); }} className={`w-full py-6 rounded-2xl font-black text-[11px] uppercase transition-all border-2 leading-tight font-black relative z-10 ${vowOfSilence ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_30px_rgba(255,42,109,0.8)] scale-105' : 'bg-[#0A0206]/80 border-[#FF2A6D]/50 text-[#FF2A6D] hover:bg-[#FF2A6D]/10 hover:shadow-glow'}`}>{vowOfSilence ? 'OWNED, BOUND, AND GAGGED' : 'I AM YOUR HELPLESS TOY, USE ME'}</button>
                    </section>
                  )}
                  {customizingItem.isAbsoluteOmakase && (
                    <section className="bg-[#0A0206]/60 backdrop-blur-md border border-[#FF2A6D]/30 p-8 rounded-3xl text-center leading-tight font-black">
                      <Lock size={32} className="text-[#FF2A6D] mx-auto mb-4 leading-tight shadow-glow animate-pulse" />
                      <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-xs mb-4 leading-tight font-black text-glow">Vow of Palate Silence</p>
                      <p className="text-[#B86688] text-sm italic mb-6 leading-tight text-wrap font-black">"I surrender all choice. My Master will decide my feast. I will swallow whatever is forced upon my tongue without question."</p>
                      <button onClick={() => { triggerHaptic('light'); setVowOfSilence(!vowOfSilence); }} className={`w-full py-4 rounded-2xl font-black text-[10px] uppercase transition-all border leading-tight font-black ${vowOfSilence ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-glow' : 'bg-[#0A0206]/60 border-white/10 text-[#884466] hover:text-[#FF2A6D]'}`}>{vowOfSilence ? 'VOW RECORDED' : 'RECORD VOW OF SILENCE'}</button>
                    </section>
                  )}
                  {!customizingItem.isMasterBody && !customizingItem.isAbsoluteOmakase && (
                    <div className="space-y-6">
                      {customizingItem.category === 'Drinks' && !customizingItem.hasJuiceChoice && (
                        <div className="space-y-6">
                          <div className="space-y-3">
                            <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Sugar Surrender</p>
                            <div className="flex flex-wrap gap-2">{['0%', '25%', '50%', '100%'].map(s => (<button key={s} onClick={() => { triggerHaptic('light'); setSugarLevel(s); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${sugarLevel === s ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{s}</button>))}</div>
                          </div>
                          <div className="space-y-3">
                            <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Temperature Decree</p>
                            <div className="flex flex-wrap gap-2">{['No Ice', 'Less Ice', 'Normal Ice', 'Hot'].map(t => (<button key={t} onClick={() => { triggerHaptic('light'); setTempLevel(t); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${tempLevel === t ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{t}</button>))}</div>
                          </div>
                        </div>
                      )}
                      {customizingItem.hasMeatChoice && (
                        <div className="space-y-3">
                          <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Flesh Sacrifice</p>
                          <div className="flex flex-wrap gap-2">{['Chicken', 'Pork', 'Beef', 'Seafood'].map(m => (<button key={m} onClick={() => { triggerHaptic('light'); setMeatChoice(m); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${meatChoice === m ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{m}</button>))}</div>
                        </div>
                      )}
                      {customizingItem.hasDonenessChoice && (
                        <div className="space-y-3">
                          <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Seared Submission</p>
                          <div className="flex flex-wrap gap-2">{['Rare', 'Medium Rare', 'Medium', 'Well Done'].map(d => (<button key={d} onClick={() => { triggerHaptic('light'); setDoneness(d); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${doneness === d ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{d}</button>))}</div>
                        </div>
                      )}
                      {customizingItem.hasYogurtToppings && (
                        <div className="space-y-3">
                          <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Sweet Temptation</p>
                          <div className="flex flex-wrap gap-2">{['Grapes', 'Blueberry', 'Strawberry', 'Granola', 'Banana'].map(t => (<button key={t} onClick={() => { triggerHaptic('light'); setYogurtTopping(t); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${yogurtTopping === t ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{t}</button>))}</div>
                        </div>
                      )}
                      {customizingItem.hasSpiceLevel && (
                        <div className="space-y-3">
                          <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Agony Level</p>
                          <div className="flex flex-wrap gap-2">{['Mild', 'Medium Hot', 'Thai Hot', 'Master\'s Punishment'].map(s => (<button key={s} onClick={() => { triggerHaptic('light'); setSpiceLevel(s); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${spiceLevel === s ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{s}</button>))}</div>
                        </div>
                      )}
                      {customizingItem.hasPastaChoice && (
                        <div className="space-y-3">
                          <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Silken Strands (Pasta Type)</p>
                          <div className="flex flex-wrap gap-2">{['Spaghetti', 'Fettuccine', 'Penne', 'Linguine'].map(p => (<button key={p} onClick={() => { triggerHaptic('light'); setPastaType(p); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${pastaType === p ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{p}</button>))}</div>
                        </div>
                      )}
                     {customizingItem.hasSauceChoice && (
                        <div className="space-y-3">
                          <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Thick Nectar (Sauce)</p>
                          <div className="flex flex-wrap gap-2">{['Creamy Alfredo', 'Spicy Marinara', 'Rich Pesto', 'Truffle Mushroom'].map(s => (<button key={s} onClick={() => { triggerHaptic('light'); setPastaSauce(s); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${pastaSauce === s ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{s}</button>))}</div>
                        </div>
                      )}
                      {customizingItem.hasKfcSauceChoice && (
                        <div className="space-y-3">
                          <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Sticky Glaze</p>
                          <div className="flex flex-wrap gap-2">{['Yangnyeom (Spicy Red Sauce)', 'Ganjang (Soy Garlic Glaze)', 'Mixed'].map(s => (<button key={s} onClick={() => { triggerHaptic('light'); setKfcSauce(s); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${kfcSauce === s ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{s}</button>))}</div>
                        </div>
                      )}
                      {customizingItem.hasJuiceChoice && (
                          <div className="space-y-3">
                              <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Crushed Essence</p>
                              <div className="flex flex-wrap gap-2">{['Watermelon', 'Orange', 'Apple', 'Mango'].map(j => (<button key={j} onClick={() => { triggerHaptic('light'); setJuiceType(j); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${juiceType === j ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{j}</button>))}</div>
                          </div>
                      )}
                      {customizingItem.hasChickenTypeChoice && (
                          <div className="space-y-3">
                              <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Preparation</p>
                              <div className="flex flex-wrap gap-2">{['Steamed (Silky)', 'Roasted (Golden)', 'Soya Sauce'].map(c => (<button key={c} onClick={() => { triggerHaptic('light'); setChickenChoice(c); }} className={`px-4 py-2 rounded-full font-black text-[10px] uppercase transition-all border ${chickenChoice === c ? 'bg-[#FF2A6D] text-white border-[#FF2A6D] shadow-[0_0_15px_rgba(255,42,109,0.4)]' : 'bg-[#0A0206]/60 border-white/10 text-[#AD6688] hover:border-[#FF2A6D]/50'}`}>{c}</button>))}</div>
                          </div>
                      )}
                      <div className="space-y-3">
                        <p className="text-[#FF2A6D] font-black uppercase tracking-[0.2em] text-[10px]">Special Plea</p>
                        <textarea value={specialRequest} onChange={(e) => setSpecialRequest(e.target.value)} placeholder="Beg for any modifications..." className="w-full bg-[#0A0206]/60 border border-white/10 p-4 rounded-2xl text-white outline-none h-24 resize-none italic text-sm" />
                      </div>
                    </div>
                  )}
                  <button onClick={() => { 
                      triggerHaptic('heavy');
                      const options = customizingItem.isMasterBody || customizingItem.isAbsoluteOmakase ? { vow: vowOfSilence, bound: customizingItem.isMasterBody } : {
                          sugar: customizingItem.category === 'Drinks' && !customizingItem.hasJuiceChoice && !customizingItem.isCoffee ? sugarLevel : null,
                          temp: customizingItem.category === 'Drinks' && !customizingItem.hasJuiceChoice && !customizingItem.isCoffee ? tempLevel : null,
                          style: customizingItem.isCoffee ? coffeeStyle : null,
                          meat: customizingItem.hasMeatChoice ? meatChoice : null,
                          doneness: customizingItem.hasDonenessChoice ? doneness : null,
                          topping: customizingItem.hasYogurtToppings ? yogurtTopping : null,
                          spice: customizingItem.hasSpiceLevel ? spiceLevel : null,
                          pasta: customizingItem.hasPastaChoice ? pastaType : null,
                          sauce: customizingItem.hasSauceChoice ? pastaSauce : null,
                          kfcSauce: customizingItem.hasKfcSauceChoice ? kfcSauce : null,
                          juice: customizingItem.hasJuiceChoice ? juiceType : null,
                          chicken: customizingItem.hasChickenTypeChoice ? chickenChoice : null,
                          request: specialRequest
                      };
                      addToCartFinal(customizingItem, options); 
                  }} className="w-full mt-8 bg-[#FF2A6D] text-white py-6 rounded-[2.5rem] font-black uppercase tracking-[0.3em] text-[12px]">
                    {customizingItem.isMasterBody ? 'SURRENDER' : 'CLAIM OFFERING'}
                  </button>

                  {/* AR View Button Moved OUTSIDE safely */}
                  {!customizingItem.isMasterBody && !customizingItem.isAbsoluteOmakase && (
                      <button onClick={() => { triggerHaptic('light'); setArItem(customizingItem); }} className="w-full mt-4 bg-transparent border-2 border-[#FF2A6D] text-[#FF2A6D] py-4 rounded-full font-black uppercase tracking-[0.3em] text-[10px] hover:bg-[#FF2A6D] hover:text-white transition-all">
                          Preview Feast in AR
                      </button>
                  )}
                </div>
              </div>
            </div>
          )}

          {isCartOpen && (
            <div className="fixed inset-0 z-[600] flex justify-end">
              <div className="absolute inset-0 bg-[#0A0206]/95 backdrop-blur-3xl" onClick={() => setIsCartOpen(false)} />
              <div className="relative w-full max-w-lg bg-[#16040C] flex flex-col border-l border-[#FF2A6D]/20">
                <div className="px-8 py-10 flex items-center justify-between border-b border-[#FF2A6D]/10 bg-[#0D0408]/80 sticky top-0 z-20">
                    <h2 className="text-3xl font-black italic text-[#FCE4EC] uppercase tracking-tight">{t('tray')}</h2>
                    <button onClick={() => { triggerHaptic('light'); setIsCartOpen(false); }} className="p-3 bg-[#260714] rounded-full text-[#AD6688] hover:text-[#FF2A6D]"><X size={20} /></button>
                </div>
                
                {isOrdering ? (
                    <div className="flex-1 flex flex-col items-center justify-center p-12 text-center">
                        <MapPin size={64} className="text-[#FF2A6D] animate-bounce mb-6" />
                        <h3 className="text-3xl font-black text-[#FF2A6D] uppercase mb-4 tracking-tighter">Validating Confinement</h3>
                        <p className="text-[#FCE4EC] font-black font-mono text-sm leading-relaxed max-w-xs mb-8">{gpsStatus}</p>
                        
                        {/* New Skip Button to bypass hanging GPS */}
                        <button 
                            onClick={() => {
                                triggerHaptic('heavy');
                                setIsOrdering(false);
                                proceedWithOrderBase("Location Validation Skipped");
                            }}
                            className="bg-transparent border-2 border-[#FF2A6D] text-[#FF2A6D] px-8 py-4 rounded-full font-black uppercase tracking-widest text-[10px] hover:bg-[#FF2A6D] hover:text-white transition-all active:scale-95"
                        >
                            Skip & Force Checkout
                        </button>
                    </div>
                ) : (
                  <div className="flex-1 overflow-y-auto flex flex-col custom-scrollbar">
                    <div className="p-6 space-y-6 flex-grow">
                        {cart.length === 0 ? (
                            <div className="h-full flex flex-col items-center justify-center text-center opacity-50 pt-20">
                                <Ghost size={64} className="text-[#AD6688] mb-6" />
                                <p className="text-xl italic text-[#AD6688] font-black">{t('emptyTray')}</p>
                            </div>
                        ) : (
                            cart.map(item => (
                              <div key={item.cartId} className="flex gap-4 items-center bg-[#0A0206]/80 p-6 rounded-[2.5rem] border border-[#FF2A6D]/20">
                                <div className="flex-1 min-w-0">
                                  <p className="font-black text-xl text-[#FCE4EC] italic truncate uppercase tracking-tight">{item.name}</p>
                                  {item.options && (
                                    <p className="text-[#AD6688] text-[10px] mt-2 font-black uppercase tracking-widest leading-relaxed line-clamp-2">
                                        {item.options.bound && <span className="text-[#F48FB1]">CLAIMED | </span>}
                                        {item.options.vow && <span className="text-[#FF2A6D]">VOW OF SILENCE | </span>}
                                        {!item.options.bound && !item.options.vow && (
                                            <>
                                                {item.options.meat && `${item.options.meat} | `}
                                                {item.options.doneness && `${item.options.doneness} | `}
                                                {item.options.style && `${item.options.style} | `}
                                                {item.options.sugar && `${item.options.sugar} | `}
                                                {item.options.temp && `${item.options.temp} | `}
                                                {item.options.topping && `${item.options.topping} | `}
                                                {item.options.spice && `${item.options.spice} | `}
                                                {item.options.pasta && `${item.options.pasta} | `}
                                                {item.options.sauce && `${item.options.sauce} | `}
                                                {item.options.kfcSauce && `${item.options.kfcSauce} | `}
                                                {item.options.juice && `${item.options.juice} | `}
                                                {item.options.chicken && `${item.options.chicken} | `}
                                                {item.options.request && `REQ: ${item.options.request}`}
                                            </>
                                        )}
                                    </p>
                                  )}
                                  <p className="text-[#FF2A6D] font-black text-sm mt-3 uppercase tracking-widest">Sacrifice: ${(item.price * item.quantity).toFixed(2)}</p>
                                </div>
                                <div className="flex items-center gap-4 bg-[#16040C] p-2.5 rounded-2xl border border-white/5">
                                  <button onClick={() => { triggerHaptic('light'); if (item.quantity === 1) setCart(prev => prev.filter(i => i.cartId !== item.cartId)); else setCart(prev => prev.map(i => i.cartId === item.cartId ? {...i, quantity: i.quantity - 1} : i)); }} className="text-[#884466] hover:text-[#FF2A6D] p-1.5"><Minus size={18} /></button>
                                  <span className="font-black text-[#FCE4EC] w-5 text-center text-lg tabular-nums leading-none">{item.quantity}</span>
                                  <button onClick={() => { triggerHaptic('light'); setCart(prev => prev.map(i => i.cartId === item.cartId ? {...i, quantity: i.quantity + 1} : i)); }} className="text-[#884466] hover:text-[#FF2A6D] p-1.5"><Plus size={18} /></button>
                                </div>
                              </div>
                            ))
                        )}
                    </div>
                    {cart.length > 0 && (
                      <div className="p-8 border-t-2 border-[#FF2A6D]/20 bg-[#0D0408] space-y-8 z-30">
                        <div className="space-y-4 pb-6 border-b border-[#FF2A6D]/10">
                            <div className="flex justify-between items-center">
                                <p className="text-[#FF2A6D] font-black uppercase tracking-[0.3em] text-[10px] flex items-center gap-2"><MapPin size={12}/> {t('verifyLoc')}</p>
                                <button onClick={detectLocation} className="text-[#AD6688] text-[9px] uppercase tracking-widest border border-[#AD6688]/30 px-3 py-1 rounded-full hover:text-[#FF2A6D] hover:border-[#FF2A6D] transition-all">Auto-Detect</button>
                            </div>
                            <textarea value={deliveryAddress} onChange={(e) => setDeliveryAddress(e.target.value)} className="w-full bg-[#0A0206]/80 border border-[#FF2A6D]/30 p-5 rounded-2xl text-white outline-none resize-none text-sm italic font-medium" placeholder="Where exactly are you confined?" rows="2" />
                            {!activeAccount?.email && <input type="email" value={checkoutEmail} onChange={(e) => setCheckoutEmail(e.target.value)} placeholder="Email (For Master's Decree)" className="w-full bg-[#0A0206]/80 border border-[#FF2A6D]/30 p-5 rounded-2xl text-white outline-none text-sm italic font-medium mt-2" />}
                        </div>
                        <div className="flex justify-between items-end text-[#FCE4EC]">
                          <span className="text-[#AD6688] text-[11px] uppercase tracking-[0.4em] font-black pb-1">{t('totalIndulge')}</span>
                          <span className="text-4xl font-black tabular-nums tracking-tighter leading-none">{hasVoucher ? 'FREE' : `$${cartTotalDisplay.toFixed(2)}`}</span>
                        </div>
                        {hasVoucher ? (
                            <button onClick={handlePlaceOrder} className="w-full bg-[#FF2A6D] text-white py-6 rounded-[2.5rem] font-black text-xl uppercase tracking-[0.3em] flex justify-center items-center gap-3">
                                {isOrdering ? <Loader2 className="animate-spin" size={24} /> : t('commandHim')}
                            </button>
                        ) : (
                          <div className="space-y-6">
                             <div className="flex items-center gap-4 text-[#884466]">
                                 <div className="h-px flex-1 bg-[#884466]/30"></div>
                                 <span className="text-[9px] uppercase font-black tracking-widest">{t('method')}</span>
                                 <div className="h-px flex-1 bg-[#884466]/30"></div>
                             </div>
                           <button onClick={() => { triggerHaptic('light'); setDevotionStatus('idle'); setTimeLeft(5.0); setBegs(0); setShowDevotionTest(true); setIsCartOpen(false); }} className="w-full bg-[#1A030C] border border-[#FF2A6D]/40 text-[#FF2A6D] py-5 rounded-[1.5rem] font-black uppercase text-[11px] flex items-center justify-center gap-2"><Flame size={16} /> {t('begFree')}</button>


                             <div className="bg-[#0A0206]/80 p-6 rounded-[2.5rem] border border-[#330044] space-y-5">
                               <p className="text-[#AD6688] text-[10px] uppercase font-black tracking-widest flex items-center gap-2"><CreditCard size={14}/> {t('payCard')}</p>
                               <input type="text" placeholder="Card Number" value={ccDetails.number} onChange={e => setCcDetails({...ccDetails, number: e.target.value})} className="w-full bg-[#1A030C] border border-white/5 px-5 py-4 rounded-xl text-[#E5C9D7] outline-none font-mono text-sm" />
                               <div className="flex gap-4">
                                 <input type="text" placeholder="MM/YY" value={ccDetails.expiry} onChange={e => setCcDetails({...ccDetails, expiry: e.target.value})} className="w-1/2 bg-[#1A030C] border border-white/5 px-5 py-4 rounded-xl text-[#E5C9D7] outline-none font-mono text-sm" />
                                 <input type="text" placeholder="CVC" value={ccDetails.cvc} onChange={e => setCcDetails({...ccDetails, cvc: e.target.value})} className="w-1/2 bg-[#1A030C] border border-white/5 px-5 py-4 rounded-xl text-[#E5C9D7] outline-none font-mono text-sm" />
                               </div>
                               <button onClick={handleCCSubmit} className="w-full bg-[#4A142A] text-white py-4 rounded-xl font-black uppercase tracking-widest text-[10px]">
                                    {isCcProcessing ? <Loader2 className="animate-spin mx-auto" size={16} /> : 'Submit Worthless Plastic'}
                               </button>
                             </div>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          )}
          
          {/* Footer Portals */}
{/* Augmented Reality Overlay */}
          {arItem && (
              <div className="fixed inset-0 z-[999999] bg-[#0A0206] flex flex-col animate-in zoom-in duration-300">
                  <div className="p-6 flex justify-between items-center bg-gradient-to-b from-black/80 to-transparent absolute top-0 w-full z-10">
                      <h3 className="text-[#FF2A6D] font-black italic text-xl uppercase tracking-widest text-glow">Virtual Offering</h3>
                      <button onClick={() => setArItem(null)} className="p-3 bg-white/10 rounded-full text-white hover:text-[#FF2A6D] backdrop-blur-md"><X size={24} /></button>
                  </div>
                  
                  {/* I am using a sample 3D Avocado here. You can replace the src with links to your own .glb food models later! */}
                  <div className="w-full h-[80vh] flex-1 relative mt-16">
                      <model-viewer 
                          src="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/Avocado/glTF-Binary/Avocado.glb" 
                          ios-src="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/Avocado/glTF-Binary/Avocado.usdz"
                          ar 
                          ar-modes="webxr scene-viewer quick-look" 
                          camera-controls 
                          auto-rotate
                          shadow-intensity="1"
                          environment-image="neutral"
                          style={{ width: '100%', height: '100%', backgroundColor: '#0A0206', display: 'block' }}
                      >
                          <button slot="ar-button" className="absolute bottom-10 left-1/2 -translate-x-1/2 bg-[#FF2A6D] text-white px-8 py-4 rounded-full font-black uppercase tracking-[0.2em] shadow-[0_0_30px_rgba(255,42,109,0.8)] border border-white/20 active:scale-95 transition-transform z-30 relative">
                              Project Into Reality
                          </button>
                      </model-viewer>
                  </div>
              </div>
          )}
{/* High-Tech Submissive Music Widget */}
          <div className="fixed bottom-8 left-8 z-[100] flex flex-col gap-4 items-start pointer-events-auto group">
              {showPlayerInput && !isMediaLocked && (
                  <div className="bg-[#0A0206]/90 backdrop-blur-xl border border-[#FF2A6D]/50 p-4 rounded-2xl w-80 animate-in slide-in-from-left duration-300 shadow-[0_0_40px_rgba(255,42,109,0.4)]">
                      <p className="text-[#FF2A6D] text-[10px] font-black uppercase tracking-widest mb-3">Establish Audio Link (Spotify/YouTube)</p>
                      <div className="flex gap-2">
                          <input type="text" onChange={(e) => {
                              let url = e.target.value;
                              if(url.includes('spotify.com/track')) url = url.replace('track/', 'embed/track/');
                              if(url.includes('youtube.com/watch?v=')) url = url.replace('watch?v=', 'embed/');
                              if(url.includes('youtu.be/')) url = url.replace('youtu.be/', 'youtube.com/embed/');
                              setSubMediaUrl(url);
                          }} placeholder="Paste URL..." className="flex-1 bg-black border border-white/10 text-white text-xs px-3 py-2 rounded-lg outline-none focus:border-[#FF2A6D]" />
                          <button onClick={() => setShowPlayerInput(false)} className="bg-[#FF2A6D] p-2 rounded-lg text-white hover:bg-[#880E4F] transition-all"><Check size={14}/></button>
                      </div>
                  </div>
              )}
              
              {subMediaUrl && (
                  <div className={`relative bg-[#0A0206]/80 backdrop-blur-md p-3 rounded-3xl border shadow-2xl transition-all duration-500 flex items-center gap-4 ${isMediaLocked ? 'border-red-600 shadow-[0_0_30px_red] animate-pulse scale-110' : 'border-[#FF2A6D]/40'}`}>
                      {/* Spinning Vinyl Element */}
                      <div className="relative w-12 h-12 rounded-full border border-zinc-800 bg-black flex items-center justify-center shadow-[0_0_15px_rgba(255,42,109,0.5)] animate-[spin_4s_linear_infinite]">
                          <div className="absolute inset-1 rounded-full border border-zinc-700"></div>
                          <div className="w-3 h-3 bg-[#FF2A6D] rounded-full shadow-inner flex items-center justify-center">
                              <div className="w-1 h-1 bg-black rounded-full"></div>
                          </div>
                      </div>
                      
                      <div className="flex-1 mr-4">
                          <p className={`font-black text-[8px] uppercase tracking-widest mb-1 ${isMediaLocked ? 'text-red-500' : 'text-[#FF2A6D]'}`}>
                              {isMediaLocked ? 'MASTER OVERRIDE (MAX VOL)' : 'AMBIENCE PLAYING'}
                          </p>
                          {/* Visualizer Bars */}
                          <div className="flex items-end gap-[2px] h-3 opacity-80">
                              {[...Array(8)].map((_, i) => (
                                  <div key={i} className={`w-1 rounded-t-sm animate-pulse ${isMediaLocked ? 'bg-red-500' : 'bg-[#FF2A6D]'}`} style={{ height: `${Math.max(30, Math.random() * 100)}%`, animationDelay: `${i * 0.1}s` }}></div>
                              ))}
                          </div>
                      </div>

                      {/* Hidden Iframe to actually play the audio */}
                      <div className="absolute w-0 h-0 overflow-hidden opacity-0 pointer-events-none">
                          <iframe src={subMediaUrl} width="10" height="10" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" allowFullScreen></iframe>
                      </div>
                      {isMediaLocked && <div className="absolute inset-0 z-30" title="Locked by Master"></div>}
                  </div>
              )}

              <button onClick={() => { if(!isMediaLocked) setShowPlayerInput(!showPlayerInput); triggerHaptic('light'); }} className={`p-4 rounded-full border transition-all shadow-xl flex items-center justify-center ${isMediaLocked ? 'bg-red-900 border-red-600 text-red-400 opacity-50 cursor-not-allowed' : 'border-[#FF2A6D]/20 bg-[#1A030C] text-[#AD6688] hover:text-[#FF2A6D] hover:border-[#FF2A6D] hover:bg-[#FF2A6D]/10'}`}>
                  <Music size={24} className={isMediaLocked ? 'animate-pulse' : ''} />
              </button>
          </div>
          <div className="fixed bottom-8 right-8 z-[100] flex flex-col gap-4">
            <div className="relative group">
              {isInstaPortalOpen && (
                <div className="absolute bottom-full right-0 mb-4 bg-[#1A030C] border border-[#FF2A6D]/30 p-6 rounded-[2rem] w-64">
                  <p className="text-[#FF2A6D] text-[10px] font-black uppercase tracking-widest mb-4">View His Empire</p>
                  <a href={`https://instagram.com/${emailSettings.instaUsername}`} target="_blank" rel="noopener noreferrer" className="block w-full bg-[#0A0206] text-white text-center py-4 rounded-xl font-black text-sm border border-white/5">@{emailSettings.instaUsername}</a>
                </div>
              )}
              <button onClick={() => { triggerHaptic('light'); setIsInstaPortalOpen(!isInstaPortalOpen); setIsPortalOpen(false); }} className={`p-6 rounded-full border border-[#FF2A6D]/20 leading-tight font-black ${isInstaPortalOpen ? 'bg-[#FF2A6D] text-white' : 'bg-[#1A030C] text-[#AD6688]'}`}>
                <Instagram size={28} />
              </button>
            </div>
            
            <div className="relative group">
              <a href={`https://wa.me/${emailSettings.whatsappNumber.replace(/[^0-9]/g, '')}`} target="_blank" rel="noopener noreferrer" onClick={() => triggerHaptic('light')} className="p-6 rounded-full border border-[#FF2A6D]/20 leading-tight font-black bg-[#1A030C] text-[#AD6688] flex">
                <MessageCircle size={28} />
              </a>
            </div>
          </div>
          <style>{`
            @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,900;1,400;1,900&family=Montserrat:wght@400;900&display=swap');
            :root { font-family: 'Playfair Display', serif; }
            .no-scrollbar::-webkit-scrollbar { display: none; }
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .custom-scrollbar::-webkit-scrollbar { width: 4px; }
            .custom-scrollbar::-webkit-scrollbar-track { background: #0A0206; }
            .custom-scrollbar::-webkit-scrollbar-thumb { background: #FF2A6D; border-radius: 4px; }
          `}</style>
        </div>
      );
    };

    const rootElement = document.getElementById('root');
    const root = createRoot(rootElement);
    root.render(<App />);
</script>
</body>
</html>
